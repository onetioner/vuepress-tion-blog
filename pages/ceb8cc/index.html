<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Flume | Onetion blog</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/vuepress-tion-blog/img/favicon.ico">
    <meta name="description" content="暂无描述。">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/vuepress-tion-blog/assets/css/0.styles.e8f25b53.css" as="style"><link rel="preload" href="/vuepress-tion-blog/assets/js/app.985e0c44.js" as="script"><link rel="preload" href="/vuepress-tion-blog/assets/js/2.1e9277be.js" as="script"><link rel="preload" href="/vuepress-tion-blog/assets/js/94.99e6ce73.js" as="script"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/10.d8aaa1e2.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/100.573bf337.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/101.d7a8d195.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/102.fbe95517.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/103.9c535674.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/104.32351bcc.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/105.b6592589.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/106.8d41efa5.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/107.81a457e6.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/108.8ec864e5.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/109.51239835.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/11.a042cecb.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/110.cacfe028.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/111.0c6750bc.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/112.10684042.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/113.9f9d8990.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/114.f63027de.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/115.f2a98bd3.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/116.1596b700.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/117.7474ad53.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/118.75dfe374.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/119.69b852f5.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/12.b59eab1d.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/120.21dce642.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/121.6383cf7a.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/122.aecc2d6d.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/123.8e4b47dc.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/124.ebeb3341.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/125.d30e0414.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/126.88154b46.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/127.f11c43ad.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/128.d2af5d75.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/129.4ec987d8.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/13.a5c5a2c7.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/130.852e041a.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/131.a2838818.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/132.e76fcb34.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/133.576684f3.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/134.b610dab9.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/135.6ddc8624.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/136.169f274d.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/137.bc17c8fb.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/138.613e8ec5.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/139.a5f28e09.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/14.d548163d.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/140.6f0e2449.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/141.25fa2479.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/142.dbbf3675.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/143.50d1c2c7.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/144.ba7322be.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/145.9b01e005.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/146.a3b7fa06.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/147.10ebf0da.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/148.f1813bc1.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/149.558a4638.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/15.9cd1a424.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/150.9fb25f94.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/151.7aa93b4c.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/152.532b2a06.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/153.b44e17d2.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/154.22bb2b40.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/155.72912290.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/156.8fb9164a.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/157.2993ac86.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/158.941ffddc.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/159.9949acea.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/16.0c491dca.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/160.b0734e8c.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/161.64295a7b.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/162.af6a1a02.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/163.8a084ab0.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/164.b3a5ce11.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/165.006ba217.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/166.8673b3eb.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/167.174f47d0.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/168.ab558478.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/169.2924afe0.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/17.bc0ce024.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/170.938fb8fd.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/171.dba8105e.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/172.3ed2b9da.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/173.21e26430.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/174.cf558b90.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/175.e2dbf973.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/176.99fdd868.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/177.b749e041.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/178.50873a04.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/179.2b2b20b8.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/18.3daae30f.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/180.e02057f8.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/181.4db698f3.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/182.5f8824c7.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/183.6edf3c7c.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/184.1bd636af.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/185.36ff0829.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/186.5cf6e096.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/187.a5a1b8ff.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/188.afbe2342.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/189.03172795.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/19.3baab1b3.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/190.cdbd5be0.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/191.f0b571be.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/192.b17d8025.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/193.71f932fa.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/194.8c1effb7.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/195.97749178.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/196.1c2212a2.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/197.b11aec90.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/198.c944c329.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/199.89d6fb24.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/20.04915620.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/200.1f73ae03.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/201.a76ba977.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/202.6506ac4e.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/203.58b5a385.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/204.5c93632e.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/205.266be28d.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/206.8351bc41.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/207.6c3f0adc.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/208.98b8311d.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/209.c7197c50.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/21.612e714c.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/210.85568730.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/211.57ca633f.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/22.73e68385.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/23.e2dc9896.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/24.dd12884f.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/25.1657ab7c.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/26.fa7585ce.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/27.a745f91e.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/28.9fd9565c.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/29.4a93ed10.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/3.e80e214b.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/30.48d9f0d9.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/31.d1533b42.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/32.577b9985.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/33.804f824e.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/34.6673d1e7.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/35.467aab87.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/36.1ff1934f.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/37.94917ddd.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/38.267be9e6.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/39.6db92b69.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/4.5c19aee3.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/40.4baf779a.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/41.d1f2437d.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/42.7abdd1fb.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/43.daec0261.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/44.e62a9c60.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/45.2d73beaf.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/46.96498038.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/47.84482418.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/48.ec50c17c.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/49.865f9ad3.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/5.9fe40e58.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/50.6bccd4b4.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/51.2f1f7e9d.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/52.53c5b275.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/53.648f4af7.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/54.a8f675df.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/55.857005bf.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/56.21b8b93d.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/57.4267e8e7.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/58.6f22a666.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/59.7ce4c5d3.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/6.7a1e80d8.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/60.bb4d7708.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/61.3ae45564.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/62.36c8a921.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/63.0cf0550f.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/64.c236b268.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/65.3dd549de.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/66.132faef6.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/67.02c3c837.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/68.38da0121.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/69.cfea652f.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/7.e4a9cefa.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/70.115de5a1.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/71.2c0ab68b.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/72.6150c1bb.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/73.485cff3f.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/74.c0d67eb7.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/75.207d3d40.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/76.c4152b85.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/77.fd3d4523.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/78.fb0e3bfd.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/79.0c70e8a7.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/8.1c6e1779.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/80.8d44c6b0.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/81.3764c177.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/82.43478cb4.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/83.c46fe3ff.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/84.aed40128.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/85.9f8f2508.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/86.d250fe69.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/87.c7dfc942.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/88.0ac96029.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/89.5d8f5e20.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/9.4da03d4f.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/90.054f7950.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/91.e05ad0c1.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/92.52f350fe.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/93.26b6b24e.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/95.ea8c8ea4.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/96.98e7d194.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/97.14c4ed1b.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/98.f5cdc1ab.js"><link rel="prefetch" href="/vuepress-tion-blog/assets/js/99.f92a6d95.js">
    <link rel="stylesheet" href="/vuepress-tion-blog/assets/css/0.styles.e8f25b53.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu only-sidebarItem"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepress-tion-blog/" class="home-link router-link-active"><img src="/vuepress-tion-blog/img/logo.png" alt="Onetion blog" class="logo"> <span class="site-name can-hide">Onetion blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vuepress-tion-blog/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="文档中心" class="dropdown-title"><a href="/vuepress-tion-blog/learn/" class="link-title">文档中心</a> <span class="title" style="display:none;">文档中心</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepress-tion-blog/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepress-tion-blog/note/javase/" class="nav-link">《JavaSE笔记》</a></li><li class="dropdown-subitem"><a href="/vuepress-tion-blog/note/javaweb/" class="nav-link">《JavaWeb》笔记</a></li><li class="dropdown-subitem"><a href="/vuepress-tion-blog/note/maven/" class="nav-link">《Maven》笔记</a></li><li class="dropdown-subitem"><a href="/vuepress-tion-blog/note/git/" class="nav-link">《Git》笔记</a></li><li class="dropdown-subitem"><a href="/vuepress-tion-blog/note/ssm/" class="nav-link">《SSM》笔记</a></li><li class="dropdown-subitem"><a href="/vuepress-tion-blog/note/mybatisplus/" class="nav-link">《MybatisPlus》笔记</a></li><li class="dropdown-subitem"><a href="/vuepress-tion-blog/note/reggietakeout/" class="nav-link">《ReggieTakeOut》笔记</a></li><li class="dropdown-subitem"><a href="/vuepress-tion-blog/note/microservice/" class="nav-link">《MicroService》笔记</a></li><li class="dropdown-subitem"><a href="/vuepress-tion-blog/note/xuechengplus/" class="nav-link">《XueChengPlus》笔记</a></li><li class="dropdown-subitem"><a href="/vuepress-tion-blog/note/flume/" class="nav-link">《Flume》笔记</a></li><li class="dropdown-subitem"><a href="/vuepress-tion-blog/note/python/" class="nav-link">《Python》笔记</a></li><li class="dropdown-subitem"><a href="/vuepress-tion-blog/note/scala/" class="nav-link">《Scala》笔记</a></li><li class="dropdown-subitem"><a href="/vuepress-tion-blog/note/linux/" class="nav-link">《Linux》笔记</a></li><li class="dropdown-subitem"><a href="/vuepress-tion-blog/note/hadoop/" class="nav-link">《Hadoop》笔记</a></li><li class="dropdown-subitem"><a href="/vuepress-tion-blog/note/designpatterns/" class="nav-link">《Java设计模式》笔记</a></li><li class="dropdown-subitem"><a href="/vuepress-tion-blog/note/htmlcssweb/" class="nav-link">《HTML-CSS-WEB》笔记</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="页面" class="dropdown-title"><a href="/vuepress-tion-blog/ui/" class="link-title">页面</a> <span class="title" style="display:none;">页面</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-tion-blog/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/vuepress-tion-blog/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/vuepress-tion-blog/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-tion-blog/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/vuepress-tion-blog/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/vuepress-tion-blog/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/vuepress-tion-blog/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/vuepress-tion-blog/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-tion-blog/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/vuepress-tion-blog/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/vuepress-tion-blog/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/vuepress-tion-blog/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/vuepress-tion-blog/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/vuepress-tion-blog/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/vuepress-tion-blog/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/vuepress-tion-blog/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-tion-blog/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/vuepress-tion-blog/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/vuepress-tion-blog/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://jsd.cdn.zzko.cn/gh/xugaoyi/image_store/blog/20200103123203.jpg"> <div class="blogger-info"><h3>Evan Xu</h3> <span>前端界的小学生</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/vuepress-tion-blog/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="文档中心" class="dropdown-title"><a href="/vuepress-tion-blog/learn/" class="link-title">文档中心</a> <span class="title" style="display:none;">文档中心</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepress-tion-blog/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepress-tion-blog/note/javase/" class="nav-link">《JavaSE笔记》</a></li><li class="dropdown-subitem"><a href="/vuepress-tion-blog/note/javaweb/" class="nav-link">《JavaWeb》笔记</a></li><li class="dropdown-subitem"><a href="/vuepress-tion-blog/note/maven/" class="nav-link">《Maven》笔记</a></li><li class="dropdown-subitem"><a href="/vuepress-tion-blog/note/git/" class="nav-link">《Git》笔记</a></li><li class="dropdown-subitem"><a href="/vuepress-tion-blog/note/ssm/" class="nav-link">《SSM》笔记</a></li><li class="dropdown-subitem"><a href="/vuepress-tion-blog/note/mybatisplus/" class="nav-link">《MybatisPlus》笔记</a></li><li class="dropdown-subitem"><a href="/vuepress-tion-blog/note/reggietakeout/" class="nav-link">《ReggieTakeOut》笔记</a></li><li class="dropdown-subitem"><a href="/vuepress-tion-blog/note/microservice/" class="nav-link">《MicroService》笔记</a></li><li class="dropdown-subitem"><a href="/vuepress-tion-blog/note/xuechengplus/" class="nav-link">《XueChengPlus》笔记</a></li><li class="dropdown-subitem"><a href="/vuepress-tion-blog/note/flume/" class="nav-link">《Flume》笔记</a></li><li class="dropdown-subitem"><a href="/vuepress-tion-blog/note/python/" class="nav-link">《Python》笔记</a></li><li class="dropdown-subitem"><a href="/vuepress-tion-blog/note/scala/" class="nav-link">《Scala》笔记</a></li><li class="dropdown-subitem"><a href="/vuepress-tion-blog/note/linux/" class="nav-link">《Linux》笔记</a></li><li class="dropdown-subitem"><a href="/vuepress-tion-blog/note/hadoop/" class="nav-link">《Hadoop》笔记</a></li><li class="dropdown-subitem"><a href="/vuepress-tion-blog/note/designpatterns/" class="nav-link">《Java设计模式》笔记</a></li><li class="dropdown-subitem"><a href="/vuepress-tion-blog/note/htmlcssweb/" class="nav-link">《HTML-CSS-WEB》笔记</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="页面" class="dropdown-title"><a href="/vuepress-tion-blog/ui/" class="link-title">页面</a> <span class="title" style="display:none;">页面</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-tion-blog/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/vuepress-tion-blog/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/vuepress-tion-blog/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-tion-blog/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/vuepress-tion-blog/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/vuepress-tion-blog/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/vuepress-tion-blog/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/vuepress-tion-blog/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-tion-blog/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/vuepress-tion-blog/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/vuepress-tion-blog/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/vuepress-tion-blog/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/vuepress-tion-blog/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/vuepress-tion-blog/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/vuepress-tion-blog/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/vuepress-tion-blog/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-tion-blog/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/vuepress-tion-blog/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/vuepress-tion-blog/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/vuepress-tion-blog/pages/ceb8cc/" aria-current="page" class="active sidebar-link">Flume</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/vuepress-tion-blog/pages/ceb8cc/#event" class="sidebar-link">Event</a></li><li class="sidebar-sub-header level2"><a href="/vuepress-tion-blog/pages/ceb8cc/#agent" class="sidebar-link">Agent</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/vuepress-tion-blog/pages/ceb8cc/#source" class="sidebar-link">Source</a></li><li class="sidebar-sub-header level3"><a href="/vuepress-tion-blog/pages/ceb8cc/#channel" class="sidebar-link">Channel</a></li><li class="sidebar-sub-header level3"><a href="/vuepress-tion-blog/pages/ceb8cc/#sink" class="sidebar-link">Sink</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/vuepress-tion-blog/pages/ceb8cc/#数据流模型" class="sidebar-link">数据流模型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/vuepress-tion-blog/pages/ceb8cc/#可靠性" class="sidebar-link">可靠性</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/vuepress-tion-blog/pages/ceb8cc/#案例说明" class="sidebar-link">案例说明</a></li><li class="sidebar-sub-header level2"><a href="/vuepress-tion-blog/pages/ceb8cc/#使用组件" class="sidebar-link">使用组件</a></li><li class="sidebar-sub-header level2"><a href="/vuepress-tion-blog/pages/ceb8cc/#添加配置文件" class="sidebar-link">添加配置文件</a></li><li class="sidebar-sub-header level2"><a href="/vuepress-tion-blog/pages/ceb8cc/#启动flume" class="sidebar-link">启动flume</a></li><li class="sidebar-sub-header level2"><a href="/vuepress-tion-blog/pages/ceb8cc/#使用netcat测试" class="sidebar-link">使用Netcat测试</a></li><li class="sidebar-sub-header level2"><a href="/vuepress-tion-blog/pages/ceb8cc/#使用telnet测试" class="sidebar-link">使用telnet测试</a></li><li class="sidebar-sub-header level2"><a href="/vuepress-tion-blog/pages/ceb8cc/#案例说明-2" class="sidebar-link">案例说明</a></li><li class="sidebar-sub-header level2"><a href="/vuepress-tion-blog/pages/ceb8cc/#使用exec-soucre" class="sidebar-link">使用Exec Soucre</a></li><li class="sidebar-sub-header level2"><a href="/vuepress-tion-blog/pages/ceb8cc/#解决重复消费问题" class="sidebar-link">解决重复消费问题</a></li><li class="sidebar-sub-header level2"><a href="/vuepress-tion-blog/pages/ceb8cc/#host-interceptor" class="sidebar-link">Host Interceptor</a></li><li class="sidebar-sub-header level2"><a href="/vuepress-tion-blog/pages/ceb8cc/#timestamp-interceptor" class="sidebar-link">Timestamp Interceptor</a></li><li class="sidebar-sub-header level2"><a href="/vuepress-tion-blog/pages/ceb8cc/#static-interceptor" class="sidebar-link">Static Interceptor</a></li><li class="sidebar-sub-header level2"><a href="/vuepress-tion-blog/pages/ceb8cc/#uuid-interceptor" class="sidebar-link">UUID Interceptor</a></li><li class="sidebar-sub-header level2"><a href="/vuepress-tion-blog/pages/ceb8cc/#search-and-replace-interceptor" class="sidebar-link">Search and Replace Interceptor</a></li><li class="sidebar-sub-header level2"><a href="/vuepress-tion-blog/pages/ceb8cc/#自定义拦截器" class="sidebar-link">自定义拦截器</a></li><li class="sidebar-sub-header level2"><a href="/vuepress-tion-blog/pages/ceb8cc/#replicating-channel-selector" class="sidebar-link">Replicating Channel Selector</a></li><li class="sidebar-sub-header level2"><a href="/vuepress-tion-blog/pages/ceb8cc/#multiplexing-channel-selector" class="sidebar-link">Multiplexing Channel Selector</a></li><li class="sidebar-sub-header level2"><a href="/vuepress-tion-blog/pages/ceb8cc/#default-sink-processor" class="sidebar-link">Default Sink Processor</a></li><li class="sidebar-sub-header level2"><a href="/vuepress-tion-blog/pages/ceb8cc/#failover-sink-processor" class="sidebar-link">Failover Sink Processor</a></li><li class="sidebar-sub-header level2"><a href="/vuepress-tion-blog/pages/ceb8cc/#load-balancing-sink-processor" class="sidebar-link">Load balancing Sink Processor</a></li><li class="sidebar-sub-header level2"><a href="/vuepress-tion-blog/pages/ceb8cc/#自定义source" class="sidebar-link">自定义Source</a></li><li class="sidebar-sub-header level2"><a href="/vuepress-tion-blog/pages/ceb8cc/#自定义sink" class="sidebar-link">自定义Sink</a></li><li class="sidebar-sub-header level2"><a href="/vuepress-tion-blog/pages/ceb8cc/#ganglia安装" class="sidebar-link">Ganglia安装</a></li><li class="sidebar-sub-header level2"><a href="/vuepress-tion-blog/pages/ceb8cc/#ganglia配置" class="sidebar-link">Ganglia配置</a></li><li class="sidebar-sub-header level2"><a href="/vuepress-tion-blog/pages/ceb8cc/#ganglia启动" class="sidebar-link">Ganglia启动</a></li><li class="sidebar-sub-header level2"><a href="/vuepress-tion-blog/pages/ceb8cc/#添加flume监控" class="sidebar-link">添加Flume监控</a></li></ul></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/vuepress-tion-blog/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/vuepress-tion-blog/note/flume/#《Flume》笔记" data-v-06225672>《Flume》笔记</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/onetioner" target="_blank" title="作者" class="beLink" data-v-06225672>onetion</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2025-01-17</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">Flume<!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="flume概述"><a href="#flume概述" class="header-anchor">#</a> Flume概述</h1> <p>Flume是的一个分布式、高可用、高可靠的海量日志采集、聚合和传输的系统，支持在日志系统中定制各类数据发送方，用于收集数据，同时提供了对数据进行简单处理并写到各种数据接收方的能力。</p> <blockquote><p>分布式：部署多个Agent来做分布式</p> <p>高可用：通过Sink的负载均衡（或者说是副本机制）来保证高可用</p> <p>高可靠：是通过Channel事务来保证高可靠</p> <p>定制各类数据：指定各种Source</p> <p>简单处理：通过拦截器实现修改、丢弃</p> <p>各种接收方：指定各种Sink</p></blockquote> <p>Flume的设计原理是基于数据流的，能够将不同数据源的海量日志数据进行高效收集、聚合、移动，最后存储到一个中心化数据存储系统中。 Flume能够做到近似实时的推送，并且可以满足数据量是持续且量级很大的情况。比如它可以收集社交网站日志，并将这些数量庞大的日志数据从网站服务器上汇集起来，存储到HDFS或 HBase分布式数据库中。</p> <p>Flume的应用场景:比如一个电商网站，想从网站访问者中访问一些特定的节点区域来分析消费者的购物意图和行为。为了实现这一点，需要收集到消费者访问的页面以及点击的产品等日志信息，并移交到大数据 Hadoop平台上去分析，可以利用 Flume做到这一点。现在流行的内容推送，比如广告定点投放以及新闻私人定制也是基于这个道理。</p> <h1 id="flume架构"><a href="#flume架构" class="header-anchor">#</a> Flume架构</h1> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706044.png" alt="image-20200327112206283"></p> <h2 id="event"><a href="#event" class="header-anchor">#</a> Event</h2> <p>事件是Flume内部数据传输的最基本单元，将传输的数据进行封装。事件本身是由一个载有数据的字节数组和可选的headers头部信息构成，如下图所示。Flume以事件的形式将数据从源头传输到最终的目的地。</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706046.png" alt="image-20200323103129436"></p> <h2 id="agent"><a href="#agent" class="header-anchor">#</a> Agent</h2> <p>Flume Agent 是一个JVM进程，通过三个组件（source、channel、sink）将事件流从一个外部数据源收集并发送给下一个目的地。</p> <h3 id="source"><a href="#source" class="header-anchor">#</a> Source</h3> <p>从数据发生器接收数据，并将数据以Flume的Event格式传递给一个或多个通道（Channel）</p> <p>支持Source:</p> <ul><li><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#avro-source" target="_blank" rel="noopener noreferrer">Avro Source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#thrift-source" target="_blank" rel="noopener noreferrer">Thrift Source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#exec-source" target="_blank" rel="noopener noreferrer">Exec Source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#jms-source" target="_blank" rel="noopener noreferrer">JMS Source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#spooling-directory-source" target="_blank" rel="noopener noreferrer">Spooling Directory Source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#taildir-source" target="_blank" rel="noopener noreferrer">Taildir Source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#twitter-1-firehose-source-experimental" target="_blank" rel="noopener noreferrer">Twitter 1% firehose Source (experimental)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#kafka-source" target="_blank" rel="noopener noreferrer">Kafka Source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#netcat-tcp-source" target="_blank" rel="noopener noreferrer">NetCat TCP Source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#netcat-udp-source" target="_blank" rel="noopener noreferrer">NetCat UDP Source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#sequence-generator-source" target="_blank" rel="noopener noreferrer">Sequence Generator Source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#syslog-sources" target="_blank" rel="noopener noreferrer">Syslog Sources<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#http-source" target="_blank" rel="noopener noreferrer">HTTP Source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#stress-source" target="_blank" rel="noopener noreferrer">Stress Source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#legacy-sources" target="_blank" rel="noopener noreferrer">Legacy Sources<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#custom-source" target="_blank" rel="noopener noreferrer">Custom Source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="channel"><a href="#channel" class="header-anchor">#</a> Channel</h3> <p>一种短暂的存储容器，位于 Source和Sink之间，起着桥梁的作用。 Channel将从Source处接收到的 Event格式的数据缓存起来，当Sink成功地将 Events发送到下一跳的Channel或最终目的地后， Events从 Channel移除。Channel是一个完整的事务，这一点保证了数据在收发的时候的一致性。可以把 Channel看成一个FIFO（先进先出）队列，当数据的获取速率超过流出速率时，将Event保存到队列中，再从队中一个个出来。</p> <p>有以下几种Channel：</p> <ul><li><strong>Memory Channel</strong> 事件存储在可配置容量的内存队列中，队列容量即为可存储最大事件数量，适用于高吞吐量场景，在agent出现错误时有可能会丢失部分数据</li> <li><strong>File Channel</strong> 基于文件系统的持久化存储</li> <li>Spillable Memory Channel 内存和文件混合Channel，当内存队列满了之后，新的事件会存储在文件系统，目前处于实验阶段，不建议在生产环境中使用</li> <li>JDBC Channe 事件存储在持久化的数据库中，目前只支持Derby</li> <li>Kafka Channel 事件存储在Kafka集群中</li> <li>Pseudo Transaction Channel 伪事务Channel，仅用于测试，不能在生产环境使用</li> <li>Custom Channel 自定义Channel</li></ul> <h3 id="sink"><a href="#sink" class="header-anchor">#</a> Sink</h3> <p>获取Channel暂时保存的数据并进行处理。sink从channel中移除事件，并将其发送到下一个agent（简称下一跳）或者事件的最终目的地，比如HDFS。</p> <p>Sink分类：</p> <ul><li><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#hdfs-sink" target="_blank" rel="noopener noreferrer">HDFS Sink<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#hive-sink" target="_blank" rel="noopener noreferrer">Hive Sink<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#logger-sink" target="_blank" rel="noopener noreferrer">Logger Sink<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#avro-sink" target="_blank" rel="noopener noreferrer">Avro Sink<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#thrift-sink" target="_blank" rel="noopener noreferrer">Thrift Sink<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#irc-sink" target="_blank" rel="noopener noreferrer">IRC Sink<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#file-roll-sink" target="_blank" rel="noopener noreferrer">File Roll Sink<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 将Events保存在本地文件系统</li> <li><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#null-sink" target="_blank" rel="noopener noreferrer">Null Sink<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 抛弃从Channel接收的所有事件</li> <li><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#hbasesinks" target="_blank" rel="noopener noreferrer">HBaseSinks<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#morphlinesolrsink" target="_blank" rel="noopener noreferrer">MorphlineSolrSink<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#elasticsearchsink" target="_blank" rel="noopener noreferrer">ElasticSearchSink<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#kite-dataset-sink" target="_blank" rel="noopener noreferrer">Kite Dataset Sink<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#kafka-sink" target="_blank" rel="noopener noreferrer">Kafka Sink<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#http-sink" target="_blank" rel="noopener noreferrer">HTTP Sink<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#custom-sink" target="_blank" rel="noopener noreferrer">Custom Sink<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="数据流模型"><a href="#数据流模型" class="header-anchor">#</a> 数据流模型</h2> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706047.png" alt="Agent component diagram"></p> <p>过程简要说明如下:
（1）外部数据源（Web Server）将Flume可识别的 Event发送到 Source
（2） Source收到 Event事件后存储到一个或多个Channel通道中。
（3）Channel保留 Event直到Sink将其处理完毕。
（4）Sink从 Channel中取出数据，并将其传输至外部存储（HDFS）。</p> <h3 id="可靠性"><a href="#可靠性" class="header-anchor">#</a> 可靠性</h3> <p>事件在每个agent的channel中短暂存储，然后事件被发送到下一个agent或者最终目的地。事件只有在存储在下一个channel或者最终存储后才从当前的channel中删除。</p> <p>Flume使用事务的办法来保证Events的可靠传递。Source和Sink分别被封装在事务中，事务由保存Event的存储或者Channel提供。这就保证了Event在数据流的点对点传输中是可靠的。在多跳的数据流中，上一跳的sink和下一跳的source均运行事务来保证数据被安全地存储到下一跳的channel中。</p> <h1 id="flume安装"><a href="#flume安装" class="header-anchor">#</a> Flume安装</h1> <p>Flume下载页面：http://flume.apache.org/download.html</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706048.png" alt="image-20200323142300139"></p> <p>将<a href="http://www.apache.org/dyn/closer.lua/flume/1.9.0/apache-flume-1.9.0-bin.tar.gz" target="_blank" rel="noopener noreferrer"> apache-flume-1.9.0-bin.tar.gz<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>下载到CentOS系统中，对其解压</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 解压命令</span>
<span class="token function">tar</span> xzf apache-flume-1.9.0-bin.tar.gz
<span class="token comment"># 进入到apache-flume-1.9.0-bin 目录</span>
<span class="token builtin class-name">cd</span> apache-flume-1.9.0-bin
<span class="token comment"># Flume使用需要依赖JDK1.8以上环境，确保已安装</span>
<span class="token comment"># 将Flume安装目录配置到PATH中，方便在任意目录使用</span>
<span class="token function">vi</span> /etc/profile
<span class="token comment"># 添加以下内容</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/opt/soft/jdk1.8.0_231
<span class="token builtin class-name">export</span> <span class="token assign-left variable">JRE_HOME</span><span class="token operator">=</span>/opt/soft/jdk1.8.0_231/jre
<span class="token builtin class-name">export</span> <span class="token assign-left variable">FLUME_HOME</span><span class="token operator">=</span>/opt/soft/apache-flume-1.9.0-bin
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$JAVA_HOME</span>/bin:<span class="token variable">$JRE_HOME</span>/bin:<span class="token variable">$FLUME_HOME</span>/bin:
<span class="token comment"># 保存成功后刷新</span>
<span class="token builtin class-name">source</span> /etc/profile
<span class="token comment"># 查看是否设置成功</span>
<span class="token builtin class-name">echo</span> <span class="token variable">$FLUME_HOME</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h1 id="入门使用示例"><a href="#入门使用示例" class="header-anchor">#</a> 入门使用示例</h1> <h2 id="案例说明"><a href="#案例说明" class="header-anchor">#</a> 案例说明</h2> <p>使用Flume监听某个端口，使用Netcat向这个端口发送数据，Flume将接收到的数据打印到控制台。</p> <p>Netcat是一款TCP/UDP测试工具，可以通过以下命令安装</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>yum <span class="token function">install</span> <span class="token parameter variable">-y</span> <span class="token function">nc</span>

<span class="token comment"># 开启一个服务端</span>
<span class="token function">nc</span> <span class="token parameter variable">-lk</span> localhost <span class="token number">44444</span>

<span class="token comment"># 新建一个会话，开启一个客户端，连接端口44444</span>
<span class="token function">nc</span> localhost <span class="token number">44444</span>

<span class="token comment"># 客户端发送数据，服务端就能接收数据</span>
hello
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="使用组件"><a href="#使用组件" class="header-anchor">#</a> 使用组件</h2> <ul><li><p><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#netcat-tcp-source" target="_blank" rel="noopener noreferrer">NetCat TCP Source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>必须属性</p> <table><thead><tr><th style="text-align:left;">属性名</th> <th style="text-align:left;">默认值</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;"><strong>channels</strong></td> <td style="text-align:left;">–</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;"><strong>type</strong></td> <td style="text-align:left;">–</td> <td style="text-align:left;"><code>netcat</code></td></tr> <tr><td style="text-align:left;"><strong>bind</strong></td> <td style="text-align:left;">–</td> <td style="text-align:left;">绑定的主机名或者IP地址</td></tr> <tr><td style="text-align:left;"><strong>port</strong></td> <td style="text-align:left;">–</td> <td style="text-align:left;">绑定端口</td></tr></tbody></table></li> <li><p><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#memory-channel" target="_blank" rel="noopener noreferrer">Memory Channel<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>必须属性</p> <table><thead><tr><th style="text-align:left;">属性名</th> <th style="text-align:left;">默认值</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;"><strong>type</strong></td> <td style="text-align:left;">–</td> <td style="text-align:left;"><code>memory</code></td></tr></tbody></table></li> <li><p><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#logger-sink" target="_blank" rel="noopener noreferrer">Logger Sink<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>必须属性</p> <table><thead><tr><th style="text-align:left;">属性名</th> <th style="text-align:left;">默认值</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;"><strong>channel</strong></td> <td style="text-align:left;">–</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;"><strong>type</strong></td> <td style="text-align:left;">–</td> <td style="text-align:left;"><code>logger</code></td></tr></tbody></table></li></ul> <h2 id="添加配置文件"><a href="#添加配置文件" class="header-anchor">#</a> 添加配置文件</h2> <p>在apache-flume-1.9.0-bin/conf目录下添加配置文件example.conf</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment"># example.conf: 单节点Flume配置</span>
<span class="token comment"># 定义agent名称为a1</span>
<span class="token comment"># 设置3个组件的名称</span>
<span class="token key attr-name">a1.sources</span> <span class="token punctuation">=</span> <span class="token value attr-value">r1</span>
<span class="token key attr-name">a1.sinks</span> <span class="token punctuation">=</span> <span class="token value attr-value">k1</span>
<span class="token key attr-name">a1.channels</span> <span class="token punctuation">=</span> <span class="token value attr-value">c1</span>

<span class="token comment"># 配置source类型为NetCat,监听地址为本机，端口为44444</span>
<span class="token key attr-name">a1.sources.r1.type</span> <span class="token punctuation">=</span> <span class="token value attr-value">netcat</span>
<span class="token key attr-name">a1.sources.r1.bind</span> <span class="token punctuation">=</span> <span class="token value attr-value">localhost</span>
<span class="token key attr-name">a1.sources.r1.port</span> <span class="token punctuation">=</span> <span class="token value attr-value">44444</span>

<span class="token comment"># 配置sink类型为Logger</span>
<span class="token key attr-name">a1.sinks.k1.type</span> <span class="token punctuation">=</span> <span class="token value attr-value">logger</span>

<span class="token comment"># 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送给sink的Events数量最大为100</span>
<span class="token key attr-name">a1.channels.c1.type</span> <span class="token punctuation">=</span> <span class="token value attr-value">memory</span>
<span class="token key attr-name">a1.channels.c1.capacity</span> <span class="token punctuation">=</span> <span class="token value attr-value">1000</span>
<span class="token key attr-name">a1.channels.c1.transactionCapacity</span> <span class="token punctuation">=</span> <span class="token value attr-value">100</span>

<span class="token comment"># 将source和sink绑定到channel上</span>
<span class="token key attr-name">a1.sources.r1.channels</span> <span class="token punctuation">=</span> <span class="token value attr-value">c1</span>
<span class="token key attr-name">a1.sinks.k1.channel</span> <span class="token punctuation">=</span> <span class="token value attr-value">c1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h2 id="启动flume"><a href="#启动flume" class="header-anchor">#</a> 启动flume</h2> <p>查看Flume使用命令</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>flume-ng <span class="token builtin class-name">help</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>Usage: /opt/soft/apache-flume-1.9.0-bin/bin/flume-ng <span class="token operator">&lt;</span>command<span class="token operator">&gt;</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span><span class="token punctuation">..</span>.

commands:
  <span class="token builtin class-name">help</span>                      display this <span class="token builtin class-name">help</span> text
  agent                     run a Flume agent
  avro-client               run an avro Flume client
  version                   show Flume version info

global options:
  --conf,-c <span class="token operator">&lt;</span>conf<span class="token operator">&gt;</span>          use configs <span class="token keyword">in</span> <span class="token operator">&lt;</span>conf<span class="token operator">&gt;</span> directory
  --classpath,-C <span class="token operator">&lt;</span>cp<span class="token operator">&gt;</span>       append to the classpath
  --dryrun,-d               <span class="token keyword">do</span> not actually start Flume, just print the <span class="token builtin class-name">command</span>
  --plugins-path <span class="token operator">&lt;</span>dirs<span class="token operator">&gt;</span>     colon-separated list of plugins.d directories. See the
                            plugins.d section <span class="token keyword">in</span> the user guide <span class="token keyword">for</span> <span class="token function">more</span> details.
                            Default: <span class="token variable">$FLUME_HOME</span>/plugins.d
  <span class="token parameter variable">-Dproperty</span><span class="token operator">=</span>value          sets a Java system property value
  <span class="token parameter variable">-Xproperty</span><span class="token operator">=</span>value          sets a Java <span class="token parameter variable">-X</span> option

agent options:
  --name,-n <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>          the name of this agent <span class="token punctuation">(</span>required<span class="token punctuation">)</span>
  --conf-file,-f <span class="token operator">&lt;</span>file<span class="token operator">&gt;</span>     specify a config <span class="token function">file</span> <span class="token punctuation">(</span>required <span class="token keyword">if</span> <span class="token parameter variable">-z</span> missing<span class="token punctuation">)</span>
  --zkConnString,-z <span class="token operator">&lt;</span>str<span class="token operator">&gt;</span>   specify the ZooKeeper connection to use <span class="token punctuation">(</span>required <span class="token keyword">if</span> <span class="token parameter variable">-f</span> missing<span class="token punctuation">)</span>
  --zkBasePath,-p <span class="token operator">&lt;</span>path<span class="token operator">&gt;</span>    specify the base path <span class="token keyword">in</span> ZooKeeper <span class="token keyword">for</span> agent configs
  --no-reload-conf          <span class="token keyword">do</span> not reload config <span class="token function">file</span> <span class="token keyword">if</span> changed
  --help,-h                 display <span class="token builtin class-name">help</span> text

avro-client options:
  --rpcProps,-P <span class="token operator">&lt;</span>file<span class="token operator">&gt;</span>   RPC client properties <span class="token function">file</span> with server connection params
  --host,-H <span class="token operator">&lt;</span>host<span class="token operator">&gt;</span>       <span class="token function">hostname</span> to <span class="token function">which</span> events will be sent
  --port,-p <span class="token operator">&lt;</span>port<span class="token operator">&gt;</span>       port of the avro <span class="token builtin class-name">source</span>
  <span class="token parameter variable">--dirname</span> <span class="token operator">&lt;</span>dir<span class="token operator">&gt;</span>        directory to stream to avro <span class="token builtin class-name">source</span>
  --filename,-F <span class="token operator">&lt;</span>file<span class="token operator">&gt;</span>   text <span class="token function">file</span> to stream to avro <span class="token builtin class-name">source</span> <span class="token punctuation">(</span>default: std input<span class="token punctuation">)</span>
  --headerFile,-R <span class="token operator">&lt;</span>file<span class="token operator">&gt;</span> File containing event headers as key/value pairs on each new line
  --help,-h              display <span class="token builtin class-name">help</span> text

  Either <span class="token parameter variable">--rpcProps</span> or both <span class="token parameter variable">--host</span> and <span class="token parameter variable">--port</span> must be specified.

Note that <span class="token keyword">if</span> <span class="token operator">&lt;</span>conf<span class="token operator">&gt;</span> directory is specified, <span class="token keyword">then</span> it is always included first
<span class="token keyword">in</span> the classpath.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p>启动agent</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>flume-ng agent <span class="token parameter variable">--conf</span> conf --conf-file conf/example.conf <span class="token parameter variable">--name</span> a1 <span class="token parameter variable">-Dflume.root.logger</span><span class="token operator">=</span>INFO,console
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>或者</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>flume-ng agent <span class="token parameter variable">-n</span> a1 <span class="token parameter variable">-c</span> conf <span class="token parameter variable">-f</span> example.conf <span class="token parameter variable">-Dflume.root.logger</span><span class="token operator">=</span>INFO,console
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706049.png" alt="image-20200110174336210"></p> <h2 id="使用netcat测试"><a href="#使用netcat测试" class="header-anchor">#</a> 使用Netcat测试</h2> <p>从另一个终端启动Netcat连接到44444端口，发送一些字符串</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">nc</span> localhost <span class="token number">44444</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706050.png" alt="image-20200323153910638"></p> <p>观察agent控制台</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706051.png" alt="image-20200323154036797"></p> <p>从这里可以看到事件由头部和字节数组组成。</p> <p>在另外一台虚拟机通过Netcat连接，需要更改配置文件</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 将绑定端口配置为IP地址，绑定为localhost或者127.0.0.1在另外一台机器上无法连接</span>
<span class="token comment"># 绑定指定ip不行，绑定0.0.0.0可以</span>
a1.sources.r1.type <span class="token operator">=</span> netcat
a1.sources.r1.bind <span class="token operator">=</span> <span class="token number">192.168</span>.85.132
a1.sources.r1.port <span class="token operator">=</span> <span class="token number">44444</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>如果开启了防火墙，需要添加防火墙规则</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>firewall-cmd <span class="token parameter variable">--zone</span><span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">44444</span>/tcp <span class="token parameter variable">--permanent</span>
firewall-cmd <span class="token parameter variable">--reload</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="使用telnet测试"><a href="#使用telnet测试" class="header-anchor">#</a> 使用telnet测试</h2> <p>如果没有安装telnet，检查源</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>yum list <span class="token operator">|</span> <span class="token function">grep</span> telnet
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706052.png" alt="image-20200110173530605"></p> <p>安装telnet</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>yum <span class="token function">install</span> <span class="token parameter variable">-y</span> telnet.x86_64
yum <span class="token function">install</span> <span class="token parameter variable">-y</span> telnet-server.x86_64
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>启动telnet</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>telnet <span class="token number">127.0</span>.0.1 <span class="token number">44444</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在控制台输入内容</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706053.png" alt="image-20200110174126132"></p> <p>可以在flume窗口查看到消息</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706054.png" alt="image-20200110174514218"></p> <h1 id="数据持久化"><a href="#数据持久化" class="header-anchor">#</a> 数据持久化</h1> <p>使用组件</p> <ul><li><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#file-channel" target="_blank" rel="noopener noreferrer">File Channel<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>属性设置</p> <table><thead><tr><th style="text-align:left;">属性名</th> <th style="text-align:left;">默认值</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;"><strong>type</strong></td> <td style="text-align:left;">–</td> <td style="text-align:left;"><code>file</code></td></tr> <tr><td style="text-align:left;">checkpointDir</td> <td style="text-align:left;">~/.flume/file-channel/checkpoint</td> <td style="text-align:left;">检查点文件存放路径</td></tr> <tr><td style="text-align:left;">dataDirs</td> <td style="text-align:left;">~/.flume/file-channel/data</td> <td style="text-align:left;">日志存储路径，多个路径使用逗号分隔. 使用不同的磁盘上的多个路径能提高file channel的性能</td></tr></tbody></table> <p>添加配置文件file-channel.conf，添加一个FileChannel</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 定义agent名称为a1</span>
<span class="token comment"># 设置3个组件的名称</span>
a1.sources <span class="token operator">=</span> r1
a1.sinks <span class="token operator">=</span> k1
<span class="token comment"># 多个channel使用空格分隔</span>
a1.channels <span class="token operator">=</span> c1 c2

<span class="token comment"># 配置source类型为NetCat,监听地址为本机，端口为44444</span>
a1.sources.r1.type <span class="token operator">=</span> netcat
a1.sources.r1.bind <span class="token operator">=</span> localhost
a1.sources.r1.port <span class="token operator">=</span> <span class="token number">44444</span>

<span class="token comment"># 配置sink类型为Logger</span>
a1.sinks.k1.type <span class="token operator">=</span> logger

<span class="token comment"># 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送给sink的Events数量最大为100</span>
a1.channels.c1.type <span class="token operator">=</span> memory
a1.channels.c1.capacity <span class="token operator">=</span> <span class="token number">1000</span>
a1.channels.c1.transactionCapacity <span class="token operator">=</span> <span class="token number">100</span>

<span class="token comment"># 配置FileChannel,checkpointDir为检查点文件存储目录，dataDirs为日志数据存储目录，</span>
a1.channels.c2.type <span class="token operator">=</span> <span class="token function">file</span>
a1.channels.c2.checkpointDir <span class="token operator">=</span> /opt/soft/flume/checkpoint
a1.channels.c2.dataDirs <span class="token operator">=</span> /opt/soft/flume/data

<span class="token comment"># 将source和sink绑定到channel上</span>
<span class="token comment"># source同时绑定到c1和c2上</span>
a1.sources.r1.channels <span class="token operator">=</span> c1 c2
a1.sinks.k1.channel <span class="token operator">=</span> c1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>为了方便日志打印，可以将<code>-Dflume.root.logger=INFO,console</code>添加在conf的环境配置中，从模板复制一份配置</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">cp</span> flume-env.sh.template flume-env.sh
<span class="token function">vi</span> flume-env.sh
<span class="token comment"># 添加JAVA_OPTS</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_OPTS</span><span class="token operator">=</span><span class="token string">&quot;-Dflume.root.logger=INFO,console&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>启动Flume</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>flume-ng agent <span class="token parameter variable">-n</span> a1 <span class="token parameter variable">-c</span> ./ <span class="token parameter variable">-f</span> file-channnel.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>通过Netcat发送数据，，此时发送到c2的数据没有被消费，关闭Flume，修改配置文件</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 将sink绑定到c2上</span>
a1.sinks.k1.channel <span class="token operator">=</span> c2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>重启Flume，可以看到会<strong>重新消费c2的数据</strong></p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706055.png" alt="image-20200323164045854"></p> <h1 id="日志文件监控"><a href="#日志文件监控" class="header-anchor">#</a> 日志文件监控</h1> <h2 id="案例说明-2"><a href="#案例说明-2" class="header-anchor">#</a> 案例说明</h2> <p>企业中应用程序部署后会将日志写入到文件中，可以使用Flume从各个<strong>日志文件</strong>将日志收集到日志中心以便于查找和分析。</p> <h2 id="使用exec-soucre"><a href="#使用exec-soucre" class="header-anchor">#</a> 使用Exec Soucre</h2> <ul><li><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#exec-source" target="_blank" rel="noopener noreferrer">Exec Source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>Exec Source通过指定命令监控文件的变化，加粗属性为必须设置的。</p> <table><thead><tr><th style="text-align:left;">属性名</th> <th style="text-align:left;">默认值</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;"><strong>channels</strong></td> <td style="text-align:left;">–</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;"><strong>type</strong></td> <td style="text-align:left;">–</td> <td style="text-align:left;"><code>exec</code></td></tr> <tr><td style="text-align:left;"><strong>command</strong></td> <td style="text-align:left;">–</td> <td style="text-align:left;">要执行的命令</td></tr> <tr><td style="text-align:left;">restart</td> <td style="text-align:left;">false</td> <td style="text-align:left;">如果执行命令挂了是否要重启</td></tr> <tr><td style="text-align:left;">batchSize</td> <td style="text-align:left;">20</td> <td style="text-align:left;">同时往channel发送的最大行数</td></tr> <tr><td style="text-align:left;">batchTimeout</td> <td style="text-align:left;">3000</td> <td style="text-align:left;">批量发送超时时间</td></tr> <tr><td style="text-align:left;">selector.type</td> <td style="text-align:left;">replicating</td> <td style="text-align:left;">channel选择器replicating 或者 multiplexing</td></tr> <tr><td style="text-align:left;">selector.*</td> <td style="text-align:left;"></td> <td style="text-align:left;">通道选择器匹配属性</td></tr> <tr><td style="text-align:left;">interceptors</td> <td style="text-align:left;">–</td> <td style="text-align:left;">拦截器</td></tr> <tr><td style="text-align:left;">interceptors.*</td> <td style="text-align:left;"></td> <td style="text-align:left;"></td></tr></tbody></table> <p>添加配置文件exec-log.conf</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 定义agent名称为a1</span>
<span class="token comment"># 设置3个组件的名称</span>
a1.sources <span class="token operator">=</span> r1
a1.sinks <span class="token operator">=</span> k1
a1.channels <span class="token operator">=</span> c1

<span class="token comment"># 配置source类型为exec,命令为 tail -F app.log</span>
a1.sources.r1.type <span class="token operator">=</span> <span class="token builtin class-name">exec</span>
a1.sources.r1.command <span class="token operator">=</span> <span class="token function">tail</span> <span class="token parameter variable">-F</span> app.log  <span class="token comment"># 目前放在同路径下</span>

<span class="token comment"># 配置sink类型为Logger</span>
a1.sinks.k1.type <span class="token operator">=</span> logger

<span class="token comment"># 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送给sink的Events数量最大为100</span>
a1.channels.c1.type <span class="token operator">=</span> memory
a1.channels.c1.capacity <span class="token operator">=</span> <span class="token number">1000</span>
a1.channels.c1.transactionCapacity <span class="token operator">=</span> <span class="token number">100</span>

<span class="token comment"># 将source和sink绑定到channel上</span>
a1.sources.r1.channels <span class="token operator">=</span> c1
a1.sinks.k1.channel <span class="token operator">=</span> c1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>启动Flume</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>flume-ng agent <span class="token parameter variable">-n</span> a1 <span class="token parameter variable">-c</span> ./ <span class="token parameter variable">-f</span> exec-log.conf <span class="token parameter variable">-Dflume.root.logger</span><span class="token operator">=</span>INFO,console
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>通过命令更新app.log文件</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token builtin class-name">echo</span> <span class="token string">&quot;abcdef&quot;</span><span class="token operator">&gt;&gt;</span> app.log
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>可以查看agent控制台接收到了最新的日志</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706056.png" alt="image-20200323184443240"></p> <p>存在问题：重启Flume，会重复消费</p> <h2 id="解决重复消费问题"><a href="#解决重复消费问题" class="header-anchor">#</a> <strong>解决重复消费问题</strong></h2> <ul><li><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#taildir-source" target="_blank" rel="noopener noreferrer">Taildir Source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>（Apache Flume 1.7.0之后才有的）</li></ul> <table><thead><tr><th style="text-align:left;">属性名</th> <th style="text-align:left;">默认值</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;"><strong>channels</strong></td> <td style="text-align:left;">–</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;"><strong>type</strong></td> <td style="text-align:left;">–</td> <td style="text-align:left;"><code>TAILDIR</code>.</td></tr> <tr><td style="text-align:left;"><strong>filegroups</strong></td> <td style="text-align:left;">–</td> <td style="text-align:left;">可以定义多个组. 每个组里包含一序列被监控的文件</td></tr> <tr><td style="text-align:left;"><code>**filegroups.&lt;filegroupName&gt;**</code></td> <td style="text-align:left;">–</td> <td style="text-align:left;">被监控文件的<strong>绝对路径</strong>，文件名支持正则表达式</td></tr> <tr><td style="text-align:left;">positionFile</td> <td style="text-align:left;">~/.flume/taildir_position.json</td> <td style="text-align:left;">记录监控文件的绝对路径、上次读取位置的json文件</td></tr></tbody></table> <p>新增dir-log.conf</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 定义agent名称为a1</span>
<span class="token comment"># 设置3个组件的名称</span>
a1.sources <span class="token operator">=</span> r1
a1.sinks <span class="token operator">=</span> k1
a1.channels <span class="token operator">=</span> c1

<span class="token comment"># 配置source类型为TAILDIR</span>
a1.sources.r1.type <span class="token operator">=</span> TAILDIR
a1.sources.r1.positionFile <span class="token operator">=</span> /opt/soft/flume/position.json
a1.sources.r1.filegroups <span class="token operator">=</span> f1 f2
a1.sources.r1.filegroups.f1 <span class="token operator">=</span> /opt/soft/apache-flume-1.9.0-bin/conf/app.log
a1.sources.r1.filegroups.f2 <span class="token operator">=</span> /opt/soft/apache-flume-1.9.0-bin/conf/applogs/.*log

<span class="token comment"># 配置sink类型为Logger</span>
a1.sinks.k1.type <span class="token operator">=</span> logger

<span class="token comment"># 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送给sink的Events数量最大为100</span>
a1.channels.c1.type <span class="token operator">=</span> memory
a1.channels.c1.capacity <span class="token operator">=</span> <span class="token number">1000</span>
a1.channels.c1.transactionCapacity <span class="token operator">=</span> <span class="token number">100</span>

<span class="token comment"># 将source和sink绑定到channel上</span>
a1.sources.r1.channels <span class="token operator">=</span> c1
a1.sinks.k1.channel <span class="token operator">=</span> c1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>启动Flume（消费了<code>app.log</code>中的数据）</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>flume-ng agent <span class="token parameter variable">-n</span> a1 <span class="token parameter variable">-c</span> ./ <span class="token parameter variable">-f</span> dir-log.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>查看<code>position.json</code>文件，<code>&quot;pos&quot;:28</code></p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706057.png" alt="image-20250107170236134"></p> <p>通过命令更新app.log文件</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token builtin class-name">echo</span> <span class="token string">&quot;123&quot;</span><span class="token operator">&gt;&gt;</span> app.log
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>此时查看<code>position.json</code>文件，<code>&quot;pos&quot;:32</code></p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071711222.png" alt="image-20250107171105143"></p> <p>停掉重启Flume，发现没有出现重复消费问题，可再次通过命令更新app.log文件验证</p> <p>重复消费问题解决是因为这个position.json文件记录了被监控文件最后读取的位置</p> <p><strong>同时Taildir Source还支持目录的监控</strong></p> <p>在applogs目录中新建一个文件</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071719449.png" alt="image-20250107171933366"></p> <p>Flume会话已经监控到这个文件的创建了</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071722017.png" alt="image-20250107172241980"></p> <p>通过命令更新1.log文件</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token builtin class-name">echo</span> <span class="token string">&quot;12345&quot;</span> <span class="token operator">&gt;&gt;</span> <span class="token number">1</span>.log
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>查看position.json文件</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071727368.png" alt="image-20250107172732288"></p> <p>新建2.log文件</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108134554126.png" alt="image-20250108134554126"></p> <p>此时Flume会监控到2.log文件的创建</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108135432383.png" alt="image-20250108135432383"></p> <p>通过命令更新2.log文件</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token builtin class-name">echo</span> <span class="token string">&quot;123&quot;</span> <span class="token operator">&gt;&gt;</span> <span class="token number">2</span>.log
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>此时Flume</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108135121342.png" alt="image-20250108135121342"></p> <p>此时position.json文件</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108135815260.png" alt="image-20250108135815260"></p> <h1 id="多个agent模型"><a href="#多个agent模型" class="header-anchor">#</a> 多个agent模型</h1> <p>可以将多个Flume agent 程序连接在一起，其中一个agent的sink将数据发送到另一个agent的source。Avro文件格式是使用Flume通过网络发送数据的标准方法。</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706058.png" alt="image-20200324142535996"></p> <p>从多个Web服务器收集日志，发送到一个或多个集中处理的agent，之后再发往日志存储中心：</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706059.png" alt="image-20200324151344310"></p> <p>同样的日志发送到不同的目的地：</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706060.png" alt="image-20200324151408108"></p> <p>将前面两个示例组合应用</p> <p>第一个agent从Netcat接收数据，增加一个channel和sink，将这个sink发送到第二个agent</p> <p>第二个agent在监控文件变化的同时监控从sink发送来的事件，最终输出到控制台</p> <p>使用Avro Sink，必须设置以下属性</p> <table><thead><tr><th style="text-align:left;">属性名</th> <th style="text-align:left;">默认值</th> <th style="text-align:left;">Description</th></tr></thead> <tbody><tr><td style="text-align:left;"><strong>channel</strong></td> <td style="text-align:left;">–</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;"><strong>type</strong></td> <td style="text-align:left;">–</td> <td style="text-align:left;"><code>avro</code></td></tr> <tr><td style="text-align:left;"><strong>hostname</strong></td> <td style="text-align:left;">–</td> <td style="text-align:left;">绑定的主机名或者IP地址</td></tr> <tr><td style="text-align:left;"><strong>port</strong></td> <td style="text-align:left;">–</td> <td style="text-align:left;">监听端口</td></tr></tbody></table> <p>使用Avro Source，必须设置以下属性</p> <table><thead><tr><th style="text-align:left;">属性名</th> <th style="text-align:left;">默认值</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;"><strong>channels</strong></td> <td style="text-align:left;">–</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;"><strong>type</strong></td> <td style="text-align:left;">–</td> <td style="text-align:left;"><code>avro</code></td></tr> <tr><td style="text-align:left;"><strong>bind</strong></td> <td style="text-align:left;">–</td> <td style="text-align:left;">绑定的主机名或者IP地址</td></tr> <tr><td style="text-align:left;"><strong>port</strong></td> <td style="text-align:left;">–</td> <td style="text-align:left;">监听端口</td></tr></tbody></table> <p>添加agent1.conf配置文件（拷贝example.conf并修改）（agent1发送agent2）</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># agent.conf1:多个agent使用</span>
<span class="token comment"># 定义agent名称为a1</span>
<span class="token comment"># 设置3个组件的名称，配置两个sink，两个channel</span>
a1.sources <span class="token operator">=</span> r1
a1.sinks <span class="token operator">=</span> k1 k2
a1.channels <span class="token operator">=</span> c1 c2

<span class="token comment"># 配置source类型为NetCat，监听地址为本机，端口为44444</span>
a1.sources.r1.type <span class="token operator">=</span> netcat
a1.sources.r1.bind <span class="token operator">=</span> localhost
a1.sources.r1.port <span class="token operator">=</span> <span class="token number">44444</span>

<span class="token comment"># 配置sink类型为Logger</span>
a1.sinks.k1.type <span class="token operator">=</span> logger
<span class="token comment"># 配置sink类型为Avro</span>
a1.sinks.k2.type <span class="token operator">=</span> avro
a1.sinks.k2.hostname <span class="token operator">=</span> localhost
a1.sinks.k2.port <span class="token operator">=</span> <span class="token number">55555</span>

<span class="token comment"># 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送&gt;给sink的Events数量最大为100</span>
a1.channels.c1.type <span class="token operator">=</span> memory
a1.channels.c1.capacity <span class="token operator">=</span> <span class="token number">1000</span>
a1.channels.c1.transactionCapacity <span class="token operator">=</span> <span class="token number">100</span>
<span class="token comment"># 配置第二个channel</span>
a1.channels.c2.type <span class="token operator">=</span> memory
a1.channels.c2.capacity <span class="token operator">=</span> <span class="token number">1000</span>
a1.channels.c2.transactionCapacity <span class="token operator">=</span> <span class="token number">100</span>

<span class="token comment"># 将source和sink绑定到channel上，c1和c2通道</span>
a1.sources.r1.channels <span class="token operator">=</span> c1 c2
a1.sinks.k1.channel <span class="token operator">=</span> c1
<span class="token comment"># sink绑定到c2</span>
a1.sinks.k2.channel <span class="token operator">=</span> c2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>添加agent2.conf配置文件（拷贝dir-log.conf并修改）</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 定义agent名称为a1</span>
<span class="token comment"># 设置3个组件的名称，添加r2，r1用来监控日志文件，r2用来读取agent1中的sink</span>
a1.sources <span class="token operator">=</span> r1 r2
a1.sinks <span class="token operator">=</span> k1
a1.channels <span class="token operator">=</span> c1

<span class="token comment"># 配置source类型为TAILDIR</span>
a1.sources.r1.type <span class="token operator">=</span> TAILDIR
a1.sources.r1.positionFile <span class="token operator">=</span> /opt/soft/flume/position.json
a1.sources.r1.filegroups <span class="token operator">=</span> f1 f2
a1.sources.r1.filegroups.f1 <span class="token operator">=</span> /opt/soft/apache-flume-1.9.0-bin/conf/app.log
a1.sources.r1.filegroups.f2 <span class="token operator">=</span> /opt/soft/apache-flume-1.9.0-bin/conf/applogs/.*log
<span class="token comment"># 配置source为agent1的sink</span>
a1.sources.r2.type <span class="token operator">=</span> avro
a1.sources.r2.bind <span class="token operator">=</span> localhost
a1.sources.r2.port <span class="token operator">=</span> <span class="token number">55555</span>

<span class="token comment"># 配置sink类型为Logger</span>
a1.sinks.k1.type <span class="token operator">=</span> logger

<span class="token comment"># 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送给sink的Events数量最大为100</span>
a1.channels.c1.type <span class="token operator">=</span> memory
a1.channels.c1.capacity <span class="token operator">=</span> <span class="token number">1000</span>
a1.channels.c1.transactionCapacity <span class="token operator">=</span> <span class="token number">100</span>

<span class="token comment"># 将source和sink绑定到channel上</span>
a1.sources.r1.channels <span class="token operator">=</span> c1
a1.sinks.k1.channel <span class="token operator">=</span> c1
<span class="token comment"># 将source r2 也绑定到 channel c1 上</span>
a1.sources.r2.channels <span class="token operator">=</span> c1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>先启动agent2再启动agent1（可以先读）</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>flume-ng agent <span class="token parameter variable">-n</span> a1 <span class="token parameter variable">-c</span> ./ <span class="token parameter variable">-f</span> agent2.conf
flume-ng agent <span class="token parameter variable">-n</span> a1 <span class="token parameter variable">-c</span> ./ <span class="token parameter variable">-f</span> agent1.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>启动agent2</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108140448412.png" alt="image-20250108140448412"></p> <p>再启动agent1</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108140549152.png" alt="image-20250108140549152"></p> <p>此时agent2，显示已连接指定ip和端口</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108140635411.png" alt="image-20250108140635411"></p> <p>先往app.log中写入日志，可以在agent2看到最新数据</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108140902196.png" alt="image-20250108140902196"></p> <p>打开Netcat连接到44444，发送数据，可以同时在agent1和agent2看到最新数据。</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108141055489.png" alt="image-20250108141055489"></p> <p>agent1</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108141227550.png" alt="image-20250108141227550"></p> <p>agent2</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108141138110.png" alt="image-20250108141138110"></p> <h1 id="拦截器"><a href="#拦截器" class="header-anchor">#</a> 拦截器</h1> <p>拦截器可以<strong>修改或者丢弃</strong>事件，Flume支持链式调用拦截器，拦截器定义在source中</p> <h2 id="host-interceptor"><a href="#host-interceptor" class="header-anchor">#</a> Host Interceptor</h2> <p><a href="https://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#host-interceptor" target="_blank" rel="noopener noreferrer">Host Interceptor<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>这个拦截器将运行agent的hostname 或者 IP地址写入到事件的headers中</p> <table><thead><tr><th style="text-align:left;">属性名</th> <th style="text-align:left;">默认值</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;"><strong>type</strong></td> <td style="text-align:left;">–</td> <td style="text-align:left;"><code>host</code></td></tr> <tr><td style="text-align:left;">preserveExisting</td> <td style="text-align:left;">false</td> <td style="text-align:left;">如果header已经存在host, 是否要保留 - true保留原始的，false写入当前机器</td></tr> <tr><td style="text-align:left;">useIP</td> <td style="text-align:left;">true</td> <td style="text-align:left;">true为IP地址, false为 hostname.</td></tr> <tr><td style="text-align:left;">hostHeader</td> <td style="text-align:left;">host</td> <td style="text-align:left;">header中key的名称</td></tr></tbody></table> <p>添加agent3.conf（拷贝agent1.conf并修改），拦截器是添加在sources上面的（示范拦截器的配置）agent3发送到agent2</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 定义agent名称为a1</span>
<span class="token comment"># 设置3个组件的名称，配置两个sink，两个channel</span>
a1.sources <span class="token operator">=</span> r1
a1.sinks <span class="token operator">=</span> k1 k2
a1.channels <span class="token operator">=</span> c1 c2

<span class="token comment"># 配置source类型为NetCat，监听地址为本机，端口为44444</span>
a1.sources.r1.type <span class="token operator">=</span> netcat
a1.sources.r1.bind <span class="token operator">=</span> localhost
a1.sources.r1.port <span class="token operator">=</span> <span class="token number">44444</span>
<span class="token comment"># 添加拦截器</span>
a1.sources.r1.interceptors <span class="token operator">=</span> i1
al.sources.r1.interceptors.i1.type <span class="token operator">=</span> <span class="token function">host</span>

<span class="token comment"># 配置sink类型为Logger</span>
a1.sinks.k1.type <span class="token operator">=</span> logger
<span class="token comment"># 配置sink类型为Avro</span>
a1.sinks.k2.type <span class="token operator">=</span> avro
a1.sinks.k2.hostname <span class="token operator">=</span> localhost
a1.sinks.k2.port <span class="token operator">=</span> <span class="token number">55555</span> 

<span class="token comment"># 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送给sink的Events数量最大为100</span>
a1.channels.c1.type <span class="token operator">=</span> memory
a1.channels.c1.capacity <span class="token operator">=</span> <span class="token number">1000</span>
a1.channels.c1.transactionCapacity <span class="token operator">=</span> <span class="token number">100</span>
<span class="token comment"># 配置第二个channel</span>
a1.channels.c2.type <span class="token operator">=</span> memory
a1.channels.c2.capacity <span class="token operator">=</span> <span class="token number">1000</span>
a1.channels.c2.transactionCapacity <span class="token operator">=</span> <span class="token number">100</span>

<span class="token comment"># 将source和sink绑定到channel上，c1和c2通道</span>
a1.sources.r1.channels <span class="token operator">=</span> c1 c2
a1.sinks.k1.channel <span class="token operator">=</span> c1 
<span class="token comment"># sink绑定到c2</span>
a1.sinks.k2.channel <span class="token operator">=</span> c2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>启动agent3（启动之前先启动agent2，因为要发送到agent2）</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>flume-ng agent <span class="token parameter variable">-n</span> a1 <span class="token parameter variable">-c</span> ./ <span class="token parameter variable">-f</span> agent2.conf
flume-ng agent <span class="token parameter variable">-n</span> a1 <span class="token parameter variable">-c</span> ./ <span class="token parameter variable">-f</span> agent3.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>可以在agent2控制台看到agent3已经连接成功</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108143000294.png" alt="image-20250108143000294"></p> <p>打开Netcat连接到44444，发送数据</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108143655837.png" alt="image-20250108143655837"></p> <p>agent3和agent2都能看到如下：</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108143616742.png" alt="image-20250108143616742"></p> <p><strong>同时可以使用另一台虚拟机来测试</strong></p> <p>打开另外一台虚拟机，安装好Flume（虚拟机192.168.88.131）（131连130）</p> <p>添加agent_example.conf，将数据发送到虚拟机130（agent2）上（拷贝agent3.conf并修改，相当于上述agent3连agent2）</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 定义agent名称为a1</span>
<span class="token comment"># 设置3个组件的名称，配置两个sink，两个channel</span>
a1.sources <span class="token operator">=</span> r1
a1.sinks <span class="token operator">=</span> k1 k2
a1.channels <span class="token operator">=</span> c1 c2

<span class="token comment"># 配置source类型为NetCat，监听地址为本机(132)，端口为44444</span>
a1.sources.r1.type <span class="token operator">=</span> netcat
a1.sources.r1.bind <span class="token operator">=</span> localhost
a1.sources.r1.port <span class="token operator">=</span> <span class="token number">44444</span>
<span class="token comment"># 添加拦截器</span>
a1.sources.r1.interceptors <span class="token operator">=</span> i1
al.sources.r1.interceptors.i1.type <span class="token operator">=</span> <span class="token function">host</span>

<span class="token comment"># 配置sink类型为Logger</span>
a1.sinks.k1.type <span class="token operator">=</span> logger
<span class="token comment"># 配置sink类型为Avro</span>
a1.sinks.k2.type <span class="token operator">=</span> avro
a1.sinks.k2.hostname <span class="token operator">=</span> <span class="token number">192.168</span>.88.130
a1.sinks.k2.port <span class="token operator">=</span> <span class="token number">55555</span> 

<span class="token comment"># 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送给sink的Events数量最大为100</span>
a1.channels.c1.type <span class="token operator">=</span> memory
a1.channels.c1.capacity <span class="token operator">=</span> <span class="token number">1000</span>
a1.channels.c1.transactionCapacity <span class="token operator">=</span> <span class="token number">100</span>
<span class="token comment"># 配置第二个channel</span>
a1.channels.c2.type <span class="token operator">=</span> memory
a1.channels.c2.capacity <span class="token operator">=</span> <span class="token number">1000</span>
a1.channels.c2.transactionCapacity <span class="token operator">=</span> <span class="token number">100</span>

<span class="token comment"># 将source和sink绑定到channel上，c1和c2通道</span>
a1.sources.r1.channels <span class="token operator">=</span> c1 c2
a1.sinks.k1.channel <span class="token operator">=</span> c1 
<span class="token comment"># sink绑定到c2</span>
a1.sinks.k2.channel <span class="token operator">=</span> c2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>上述配置就是从131中的Netcat收到数据，通过两个chanel，一个直接打印，一个发送给130虚拟机中（暂时不行）</p> <p>这里注意需要在130上开启防火墙端口</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>firewall-cmd <span class="token parameter variable">--zone</span><span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">55555</span>/tcp <span class="token parameter variable">--permanent</span>
firewall-cmd <span class="token parameter variable">--reload</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>启动example（131上的Flume）（发送给130）</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>flume-ng agent <span class="token parameter variable">-n</span> a1 <span class="token parameter variable">-c</span> ./ <span class="token parameter variable">-f</span> agent4.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>可以在130的agent2控制台看到example已经连接成功</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20200324153714003.png" alt="image-20200324153714003"></p> <p>在132上通过Netcat发送数据，发送的是132上的example</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">nc</span> localhost <span class="token number">44444</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>而example会发送到135上的agent2，可以在135上agent2上看到添加了headers</p> <p>因此，使用Host Inteceptor可以把当前主机地址发送过来，从而区分这个日志或者事件从哪个主机发送过来的</p> <h2 id="timestamp-interceptor"><a href="#timestamp-interceptor" class="header-anchor">#</a> Timestamp Interceptor</h2> <p>这个拦截器将<strong>当前时间</strong>写入到事件的headers中</p> <table><thead><tr><th style="text-align:left;">属性名</th> <th style="text-align:left;">默认值</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;"><strong>type</strong></td> <td style="text-align:left;">–</td> <td style="text-align:left;"><code>timestamp</code></td></tr> <tr><td style="text-align:left;">headerName</td> <td style="text-align:left;">timestamp</td> <td style="text-align:left;">header中key的名称</td></tr> <tr><td style="text-align:left;">preserveExisting</td> <td style="text-align:left;">false</td> <td style="text-align:left;">If the timestamp already exists, should it be preserved - true or false</td></tr></tbody></table> <p>再次回到agent3中的配置，修改如下，</p> <p>再添加一个拦截器（直接拷贝来一个agent4.conf）</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>a1.sources.r1.interceptors <span class="token operator">=</span> i1 i2
a1.sources.r1.interceptors.i1.type <span class="token operator">=</span> <span class="token function">host</span>
a1.sources.r1.interceptors.i2.type <span class="token operator">=</span> timestamp
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>启动agent4
flume-ng agent <span class="token parameter variable">-n</span> a1 <span class="token parameter variable">-c</span> ./ <span class="token parameter variable">-f</span> agent4.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>此时agent2控制台显示已连接</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108152342166.png" alt="image-20250108152342166"></p> <p>打开Netcat连接到44444，发送数据</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">nc</span> localhost <span class="token number">44444</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108152527595.png" alt="image-20250108152527595"></p> <p>agent4控制台输出<strong>timestamp</strong>日期</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108152904610.png" alt="image-20250108152904610"></p> <h2 id="static-interceptor"><a href="#static-interceptor" class="header-anchor">#</a> Static Interceptor</h2> <p>运行用户对所有的事件添加<strong>固定的header</strong></p> <table><thead><tr><th style="text-align:left;">属性名</th> <th style="text-align:left;">默认值</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;"><strong>type</strong></td> <td style="text-align:left;">–</td> <td style="text-align:left;"><code>static</code></td></tr> <tr><td style="text-align:left;">preserveExisting</td> <td style="text-align:left;">true</td> <td style="text-align:left;">If configured header already exists, should it be preserved - true or false</td></tr> <tr><td style="text-align:left;">key</td> <td style="text-align:left;">key</td> <td style="text-align:left;">header 中key名称</td></tr> <tr><td style="text-align:left;">value</td> <td style="text-align:left;">value</td> <td style="text-align:left;">header 中value值</td></tr></tbody></table> <p>在agent4.conf中修改即可，<strong>自定义key value</strong></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>a1.sources.r1.interceptors <span class="token operator">=</span> i1 i2 i3
a1.sources.r1.interceptors.i1.type <span class="token operator">=</span> <span class="token function">host</span>
a1.sources.r1.interceptors.i2.type <span class="token operator">=</span> timestamp
a1.sources.r1.interceptors.i3.type <span class="token operator">=</span> static
a1.sources.r1.interceptors.i3.key <span class="token operator">=</span> datacenter
a1.sources.r1.interceptors.i3.value <span class="token operator">=</span> NEW_YORK
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>打开Netcat连接到44444，发送数据</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108154253711.png" alt="image-20250108154253711"></p> <p>agent4控制台输出</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108154633688.png" alt="image-20250108154633688"></p> <h2 id="uuid-interceptor"><a href="#uuid-interceptor" class="header-anchor">#</a> UUID Interceptor</h2> <p><a href="https://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#uuid-interceptor" target="_blank" rel="noopener noreferrer">UUID Interceptor<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>生成唯一ID</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108160309260.png" alt="image-20250108160309260"></p> <p>在agent4.conf中修改</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>a1.sources.r1.interceptors <span class="token operator">=</span> i1 i2 i3 i4
a1.sources.r1.interceptors.i1.type <span class="token operator">=</span> <span class="token function">host</span>
a1.sources.r1.interceptors.i2.type <span class="token operator">=</span> timestamp
a1.sources.r1.interceptors.i3.type <span class="token operator">=</span> static
a1.sources.r1.interceptors.i3.key <span class="token operator">=</span> datacenter
a1.sources.r1.interceptors.i3.value <span class="token operator">=</span> NEW_YORK
a1.sources.r1.interceptors.i4.type <span class="token operator">=</span> org.apache.flume.sink.solr.morphline.UUIDInterceptor<span class="token variable">$Builder</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>打开Netcat连接到44444，发送数据</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108160000856.png" alt="image-20250108160000856"></p> <p>agent4控制台输出</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108160104769.png" alt="image-20250108160104769"></p> <h2 id="search-and-replace-interceptor"><a href="#search-and-replace-interceptor" class="header-anchor">#</a> Search and Replace Interceptor</h2> <p><a href="https://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#search-and-replace-interceptor" target="_blank" rel="noopener noreferrer">Search and Replace Interceptor<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>查找并替换</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108160243230.png" alt="image-20250108160243230"></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>a1.sources.r1.interceptors <span class="token operator">=</span> i1 i2 i3 i4 i5
a1.sources.r1.interceptors.i1.type <span class="token operator">=</span> <span class="token function">host</span>
a1.sources.r1.interceptors.i2.type <span class="token operator">=</span> timestamp
a1.sources.r1.interceptors.i3.type <span class="token operator">=</span> static
a1.sources.r1.interceptors.i3.key <span class="token operator">=</span> datacenter
a1.sources.r1.interceptors.i3.value <span class="token operator">=</span> NEW_YORK
a1.sources.r1.interceptors.i4.type <span class="token operator">=</span> org.apache.flume.sink.solr.morphline.UUIDInterceptor<span class="token variable">$Builder</span>
a1.sources.r1.interceptors.i5.type <span class="token operator">=</span> search_replace
<span class="token comment"># 支持正则表达式，查找并替换，例如手机号脱敏操作（中间几位隐藏）</span>
a1.sources.r1.interceptors.i5.searchPattern <span class="token operator">=</span> <span class="token punctuation">\</span><span class="token punctuation">\</span>d<span class="token punctuation">{</span><span class="token number">6</span><span class="token punctuation">}</span>
a1.sources.r1.interceptors.i5.replaceString <span class="token operator">=</span> ******
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>打开Netcat连接到44444，发送数据</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108160958778.png" alt="image-20250108160958778"></p> <p>agent4控制台输出（并还是headers中，而是消息体里面做了替换）</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108161153572.png" alt="image-20250108161153572"></p> <h2 id="自定义拦截器"><a href="#自定义拦截器" class="header-anchor">#</a> 自定义拦截器</h2> <p>新建工程，添加pom引用</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flume<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flume-ng-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.9.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>添加自定义拦截器</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flume<span class="token punctuation">.</span></span><span class="token class-name">Context</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flume<span class="token punctuation">.</span></span><span class="token class-name">Event</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flume<span class="token punctuation">.</span>interceptor<span class="token punctuation">.</span></span><span class="token class-name">Interceptor</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">Interceptor</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span>
            <span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">MyInterceptor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 拦截单个事件
     * @param event
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Event</span> <span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">Event</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> host <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;host&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;接收到host为：&quot;</span><span class="token operator">+</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>host<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.85.131&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;丢弃事件&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> event<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">&gt;</span></span> <span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">&gt;</span></span> newList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Event</span> event <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            event <span class="token operator">=</span> <span class="token function">intercept</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>event<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                newList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> newList<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Builder</span> <span class="token keyword">implements</span> <span class="token class-name">Interceptor<span class="token punctuation">.</span>Builder</span><span class="token punctuation">{</span>

        <span class="token keyword">public</span> <span class="token class-name">Interceptor</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><p>将项目打成jar包后复制到Flume安装目录的lib目录中</p> <p>修改agent2.conf（因为agent2接收从网络发送过来的数据）</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 配置拦截器</span>
a1.sources.r2.interceptors <span class="token operator">=</span> i1
a1.sources.r2.interceptors.i1.type <span class="token operator">=</span> com.itheima.flume.interceptor.MyInterceptor<span class="token variable">$Builder</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>先开启131机器上的agent4</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>flume-ng agent <span class="token parameter variable">-n</span> a1 <span class="token parameter variable">-c</span> ./ <span class="token parameter variable">-f</span> agent4.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>再开启130机器上的agent2</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>flume-ng agent <span class="token parameter variable">-n</span> a1 <span class="token parameter variable">-c</span> ./ <span class="token parameter variable">-f</span> agent2.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>此时再从131发送数据过来，可以看到数据被拦截了，拦截后的数据不会进入channel，即不会被sink消费</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706068.png" alt="image-20200324182058523"></p> <h1 id="channel选择器"><a href="#channel选择器" class="header-anchor">#</a> Channel选择器</h1> <h2 id="replicating-channel-selector"><a href="#replicating-channel-selector" class="header-anchor">#</a> Replicating Channel Selector</h2> <p><a href="https://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#replicating-channel-selector-default" target="_blank" rel="noopener noreferrer">复制选择器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，如果没有指定，这个为默认选择器</p> <p>可选属性如下</p> <table><thead><tr><th style="text-align:left;">属性名</th> <th style="text-align:left;">默认值</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;">selector.type</td> <td style="text-align:left;">replicating</td> <td style="text-align:left;"><code>replicating</code></td></tr> <tr><td style="text-align:left;">selector.optional</td> <td style="text-align:left;">–</td> <td style="text-align:left;"><code>optional</code></td></tr></tbody></table> <p>使用案例：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>a1.sources <span class="token operator">=</span> r1
a1.channels <span class="token operator">=</span> c1 c2 c3
a1.sources.r1.selector.type <span class="token operator">=</span> replicating
a1.sources.r1.channels <span class="token operator">=</span> c1 c2 c3
a1.sources.r1.selector.optional <span class="token operator">=</span> c3
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>上面的配置中，c3是一个可选的channel，写入c3失败的话会被忽略，</p> <p>而c1和c2没有标记为可选，如果写入c1和c2失败会导致事务的失败。</p> <h2 id="multiplexing-channel-selector"><a href="#multiplexing-channel-selector" class="header-anchor">#</a> Multiplexing Channel Selector</h2> <p><a href="https://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#multiplexing-channel-selector" target="_blank" rel="noopener noreferrer">多路channel选择器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，可选属性如下</p> <table><thead><tr><th style="text-align:left;">属性名</th> <th style="text-align:left;">默认值</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;">selector.type</td> <td style="text-align:left;">replicating</td> <td style="text-align:left;"><code>multiplexing</code></td></tr> <tr><td style="text-align:left;">selector.header</td> <td style="text-align:left;">flume.selector.header</td> <td style="text-align:left;">键值Key</td></tr> <tr><td style="text-align:left;">selector.default</td> <td style="text-align:left;">–</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;">selector.mapping.*</td> <td style="text-align:left;">–</td> <td style="text-align:left;">路由</td></tr></tbody></table> <p>使用案例：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>a1.sources <span class="token operator">=</span> r1
a1.channels <span class="token operator">=</span> c1 c2 c3 c4
a1.sources.r1.selector.type <span class="token operator">=</span> multiplexing
a1.sources.r1.selector.header <span class="token operator">=</span> state
a1.sources.r1.selector.mapping.CZ <span class="token operator">=</span> c1 c2
a1.sources.r1.selector.mapping.US <span class="token operator">=</span> c1 c3
a1.sources.r1.selector.default <span class="token operator">=</span> c1 c4
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>这里通过事件的header值来判断将事件发送到哪个channel，可以配合拦截器一起使用。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 创建multichannel目录</span>
<span class="token function">mkdir</span> multichannel
<span class="token builtin class-name">cd</span> multichannel
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>创建agent5.conf</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 定义agent名称为a1</span>
<span class="token comment"># 设置3个组件的名称</span>
a1.sources <span class="token operator">=</span> r1
a1.sinks <span class="token operator">=</span> k1 k2 k3 k4
a1.channels <span class="token operator">=</span> c1 c2 c3 c4

<span class="token comment"># 配置source类型为NetCat,监听地址为本机，端口为44444</span>
a1.sources.r1.type <span class="token operator">=</span> netcat
a1.sources.r1.bind <span class="token operator">=</span> localhost
a1.sources.r1.port <span class="token operator">=</span> <span class="token number">44444</span>

<span class="token comment"># 配置sink1类型为Logger</span>
a1.sinks.k1.type <span class="token operator">=</span> logger

<span class="token comment"># 配置sink2,3,4类型为Avro</span>
a1.sinks.k2.type <span class="token operator">=</span> avro
a1.sinks.k2.hostname <span class="token operator">=</span> <span class="token number">192.168</span>.88.130
a1.sinks.k2.port <span class="token operator">=</span> <span class="token number">4040</span>

a1.sinks.k3.type <span class="token operator">=</span> avro
a1.sinks.k3.hostname <span class="token operator">=</span> <span class="token number">192.168</span>.88.130
a1.sinks.k3.port <span class="token operator">=</span> <span class="token number">4041</span>

a1.sinks.k4.type <span class="token operator">=</span> avro
a1.sinks.k4.hostname <span class="token operator">=</span> <span class="token number">192.168</span>.88.130
a1.sinks.k4.port <span class="token operator">=</span> <span class="token number">4042</span>

<span class="token comment"># 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送给sink的Events数量最大为100</span>
a1.channels.c1.type <span class="token operator">=</span> memory
a1.channels.c1.capacity <span class="token operator">=</span> <span class="token number">1000</span>
a1.channels.c1.transactionCapacity <span class="token operator">=</span> <span class="token number">100</span>

a1.channels.c2.type <span class="token operator">=</span> memory
a1.channels.c2.capacity <span class="token operator">=</span> <span class="token number">1000</span>
a1.channels.c2.transactionCapacity <span class="token operator">=</span> <span class="token number">100</span>

a1.channels.c3.type <span class="token operator">=</span> memory
a1.channels.c3.capacity <span class="token operator">=</span> <span class="token number">1000</span>
a1.channels.c3.transactionCapacity <span class="token operator">=</span> <span class="token number">100</span>

a1.channels.c4.type <span class="token operator">=</span> memory
a1.channels.c4.capacity <span class="token operator">=</span> <span class="token number">1000</span>
a1.channels.c4.transactionCapacity <span class="token operator">=</span> <span class="token number">100</span>


<span class="token comment"># 将source和sink绑定到channel上</span>
a1.sources.r1.channels <span class="token operator">=</span> c1 c2 c3 c4
a1.sinks.k1.channel <span class="token operator">=</span> c1
a1.sinks.k2.channel <span class="token operator">=</span> c2
a1.sinks.k3.channel <span class="token operator">=</span> c3
a1.sinks.k4.channel <span class="token operator">=</span> c4
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><p>添加agent6.conf</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 定义agent名称为a2</span>
<span class="token comment"># 设置3个组件的名称</span>
a2.sources <span class="token operator">=</span> r1
a2.sinks <span class="token operator">=</span> k1
a2.channels <span class="token operator">=</span> c1

<span class="token comment"># 配置source类型为avro</span>
a2.sources.r1.type <span class="token operator">=</span> avro
a2.sources.r1.bind <span class="token operator">=</span> <span class="token number">192.168</span>.88.130
a2.sources.r1.port <span class="token operator">=</span> <span class="token number">4040</span>


<span class="token comment"># 配置sink类型为logger</span>
a2.sinks.k1.type <span class="token operator">=</span> logger

<span class="token comment"># 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送给sink的Events数量最大为100</span>
a2.channels.c1.type <span class="token operator">=</span> memory
a2.channels.c1.capacity <span class="token operator">=</span> <span class="token number">1000</span>
a2.channels.c1.transactionCapacity <span class="token operator">=</span> <span class="token number">100</span>

<span class="token comment"># 将source和sink绑定到channel上</span>
a2.sources.r1.channels <span class="token operator">=</span> c1
a2.sinks.k1.channel <span class="token operator">=</span> c1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>添加agent7.conf</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 定义agent名称为a3</span>
<span class="token comment"># 设置3个组件的名称</span>
a3.sources <span class="token operator">=</span> r1
a3.sinks <span class="token operator">=</span> k1
a3.channels <span class="token operator">=</span> c1

<span class="token comment"># 配置source类型为avro</span>
a3.sources.r1.type <span class="token operator">=</span> avro
a3.sources.r1.bind <span class="token operator">=</span> <span class="token number">192.168</span>.88.130
a3.sources.r1.port <span class="token operator">=</span> <span class="token number">4041</span>


<span class="token comment"># 配置sink类型为logger</span>
a3.sinks.k1.type <span class="token operator">=</span> logger

<span class="token comment"># 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送给sink的Events数量最大为100</span>
a3.channels.c1.type <span class="token operator">=</span> memory
a3.channels.c1.capacity <span class="token operator">=</span> <span class="token number">1000</span>
a3.channels.c1.transactionCapacity <span class="token operator">=</span> <span class="token number">100</span>

<span class="token comment"># 将source和sink绑定到channel上</span>
a3.sources.r1.channels <span class="token operator">=</span> c1
a3.sinks.k1.channel <span class="token operator">=</span> c1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>添加agent8.conf</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 定义agent名称为a4</span>
<span class="token comment"># 设置3个组件的名称</span>
a4.sources <span class="token operator">=</span> r1
a4.sinks <span class="token operator">=</span> k1
a4.channels <span class="token operator">=</span> c1

<span class="token comment"># 配置source类型为avro</span>
a4.sources.r1.type <span class="token operator">=</span> avro
a4.sources.r1.bind <span class="token operator">=</span> <span class="token number">192.168</span>.88.130
a4.sources.r1.port <span class="token operator">=</span> <span class="token number">4042</span>


<span class="token comment"># 配置sink类型为logger</span>
a4.sinks.k1.type <span class="token operator">=</span> logger

<span class="token comment"># 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送给sink的Events数量最大为100</span>
a4.channels.c1.type <span class="token operator">=</span> memory
a4.channels.c1.capacity <span class="token operator">=</span> <span class="token number">1000</span>
a4.channels.c1.transactionCapacity <span class="token operator">=</span> <span class="token number">100</span>

<span class="token comment"># 将source和sink绑定到channel上</span>
a4.sources.r1.channels <span class="token operator">=</span> c1
a4.sinks.k1.channel <span class="token operator">=</span> c1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>启动agent6、agent7、agent8和agent5</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>flume-ng agent <span class="token parameter variable">-n</span> a2 <span class="token parameter variable">-c</span> ./ <span class="token parameter variable">-f</span> agent6.conf
flume-ng agent <span class="token parameter variable">-n</span> a3 <span class="token parameter variable">-c</span> ./ <span class="token parameter variable">-f</span> agent7.conf
flume-ng agent <span class="token parameter variable">-n</span> a4 <span class="token parameter variable">-c</span> ./ <span class="token parameter variable">-f</span> agent8.conf
flume-ng agent <span class="token parameter variable">-n</span> a1 <span class="token parameter variable">-c</span> ./ <span class="token parameter variable">-f</span> agent5.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>使用Netcat往agent1发送消息，可以在agent2\3\4上看到消息</p> <p>修改agent5.conf，配置通道选择器</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 配置拦截器</span>
a1.sources.r1.interceptors <span class="token operator">=</span> i1
a1.sources.r1.interceptors.i1.type <span class="token operator">=</span> static
a1.sources.r1.interceptors.i1.key <span class="token operator">=</span> state
a1.sources.r1.interceptors.i1.value <span class="token operator">=</span> CZ
<span class="token comment"># 配置通道选择器，如果匹配不上就走default</span>
a1.sources.r1.selector.type <span class="token operator">=</span> multiplexing
a1.sources.r1.selector.header <span class="token operator">=</span> state
a1.sources.r1.selector.mapping.CZ <span class="token operator">=</span> c1 c2
a1.sources.r1.selector.mapping.US <span class="token operator">=</span> c1 c3
a1.sources.r1.selector.default <span class="token operator">=</span> c1 c4
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>运行所有agent，发送数据到agent1，可以看到只有agent2收到了数据，</p> <p>修改拦截器的值为US，结果是agent3收到数据。</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250109194557859.png" alt="image-20250109194557859"></p> <h1 id="sink处理器"><a href="#sink处理器" class="header-anchor">#</a> Sink处理器</h1> <p>通过sink来消费，如果消费端出现宕机，就会造成消息的积压，可能内存就不够了或者文件很大，那如何出现消息积压问题呢？Sink处理器</p> <p>可以将多个sink放入到一个组中，Sink处理器能够对一个组中所有的sink进行负载均衡，在一个sink出现临时错误时进行故障转移。</p> <p>必须设置属性：</p> <table><thead><tr><th style="text-align:left;">属性名</th> <th style="text-align:left;">默认值</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;"><strong>sinks</strong></td> <td style="text-align:left;">–</td> <td style="text-align:left;">组中多个sink使用空格分隔</td></tr> <tr><td style="text-align:left;"><strong>processor.type</strong></td> <td style="text-align:left;"><code>default</code></td> <td style="text-align:left;"><code>default</code>, <code>failover</code> 或<code>load_balance</code></td></tr></tbody></table> <p>举例：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>a1.sinkgroups <span class="token operator">=</span> g1
a1.sinkgroups.g1.sinks <span class="token operator">=</span> k1 k2
a1.sinkgroups.g1.processor.type <span class="token operator">=</span> failover
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="default-sink-processor"><a href="#default-sink-processor" class="header-anchor">#</a> Default Sink Processor</h2> <p>默认的Sink处理器只支持单个Sink</p> <h2 id="failover-sink-processor"><a href="#failover-sink-processor" class="header-anchor">#</a> Failover Sink Processor</h2> <p><strong>故障转移处理器</strong>维护了一个带有优先级的sink列表，故障转移机制将失败的sink放入到一个冷却池中，如果sink成功发送了事件，将其放入到活跃池中，sink可以设置优先级，数字越高，优先级越高，如果一个sink发送事件失败，下一个有更高优先级的sink将被用来发送事件，比如，优先级100的比优先级80的先被使用，如果没有设置优先级，按配置文件中配置的顺序决定。设置属性如下：</p> <table><thead><tr><th style="text-align:left;">属性名</th> <th style="text-align:left;">默认值</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;"><strong>sinks</strong></td> <td style="text-align:left;">–</td> <td style="text-align:left;">组内多个sinks空格分隔</td></tr> <tr><td style="text-align:left;"><strong>processor.type</strong></td> <td style="text-align:left;"><code>default</code></td> <td style="text-align:left;"><code>failover</code></td></tr> <tr><td style="text-align:left;"><strong>processor.priority.</strong></td> <td style="text-align:left;">–</td> <td style="text-align:left;">优先级</td></tr> <tr><td style="text-align:left;">processor.maxpenalty</td> <td style="text-align:left;">30000</td> <td style="text-align:left;">失败sink的最大冷却时间</td></tr></tbody></table> <p>示例如下：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>a1.sinkgroups <span class="token operator">=</span> g1
a1.sinkgroups.g1.sinks <span class="token operator">=</span> k1 k2
a1.sinkgroups.g1.processor.type <span class="token operator">=</span> failover
a1.sinkgroups.g1.processor.priority.k1 <span class="token operator">=</span> <span class="token number">5</span>
a1.sinkgroups.g1.processor.priority.k2 <span class="token operator">=</span> <span class="token number">10</span>
a1.sinkgroups.g1.processor.maxpenalty <span class="token operator">=</span> <span class="token number">10000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>修改以上agent5.conf，直接agent9.conf</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 定义agent名称为a1</span>
<span class="token comment"># 设置3个组件的名称</span>
a1.sources <span class="token operator">=</span> r1
a1.sinks <span class="token operator">=</span> k1 k2 k3 k4
a1.channels <span class="token operator">=</span> c1

<span class="token comment"># 配置source类型为NetCat,监听地址为本机，端口为44444</span>
a1.sources.r1.type <span class="token operator">=</span> netcat
a1.sources.r1.bind <span class="token operator">=</span> localhost
a1.sources.r1.port <span class="token operator">=</span> <span class="token number">44444</span>

<span class="token comment"># 配置sink组</span>
a1.sinkgroups <span class="token operator">=</span> g1
a1.sinkgroups.g1.sinks <span class="token operator">=</span> k1 k2 k3 k4
a1.sinkgroups.g1.processor.type <span class="token operator">=</span> failover
a1.sinkgroups.g1.processor.priority.k1 <span class="token operator">=</span> <span class="token number">5</span>
a1.sinkgroups.g1.processor.priority.k2 <span class="token operator">=</span> <span class="token number">10</span>
a1.sinkgroups.g1.processor.priority.k3 <span class="token operator">=</span> <span class="token number">15</span>
a1.sinkgroups.g1.processor.priority.k4 <span class="token operator">=</span> <span class="token number">20</span>
a1.sinkgroups.g1.processor.maxpenalty <span class="token operator">=</span> <span class="token number">10000</span>

<span class="token comment"># 配置sink1类型为Logger</span>
a1.sinks.k1.type <span class="token operator">=</span> logger

<span class="token comment"># 配置sink2,3,4类型为Avro</span>
a1.sinks.k2.type <span class="token operator">=</span> avro
a1.sinks.k2.hostname <span class="token operator">=</span> <span class="token number">192.168</span>.88.130
a1.sinks.k2.port <span class="token operator">=</span> <span class="token number">4040</span>

a1.sinks.k3.type <span class="token operator">=</span> avro
a1.sinks.k3.hostname <span class="token operator">=</span> <span class="token number">192.168</span>.88.130
a1.sinks.k3.port <span class="token operator">=</span> <span class="token number">4041</span>

a1.sinks.k4.type <span class="token operator">=</span> avro
a1.sinks.k4.hostname <span class="token operator">=</span> <span class="token number">192.168</span>.88.130
a1.sinks.k4.port <span class="token operator">=</span> <span class="token number">4042</span>

<span class="token comment"># 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送给sink的Events数量最大为100</span>
a1.channels.c1.type <span class="token operator">=</span> memory
a1.channels.c1.capacity <span class="token operator">=</span> <span class="token number">1000</span>
a1.channels.c1.transactionCapacity <span class="token operator">=</span> <span class="token number">100</span>

<span class="token comment"># 将source和sink绑定到channel上</span>
a1.sources.r1.channels <span class="token operator">=</span> c1
a1.sinks.k1.channel <span class="token operator">=</span> c1
a1.sinks.k2.channel <span class="token operator">=</span> c1
a1.sinks.k3.channel <span class="token operator">=</span> c1
a1.sinks.k4.channel <span class="token operator">=</span> c1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><p>启动agent6\7\8和agent9，通过Netcat发送消息到agent9，可以看到消息一直发送给其中一个agent（agent8优先级最高），将这个agent关闭后，消息会发送到其他agent（优先级次高）。</p> <h2 id="load-balancing-sink-processor"><a href="#load-balancing-sink-processor" class="header-anchor">#</a> Load balancing Sink Processor</h2> <p><strong>负载均衡处理器</strong>，可以通过<strong>轮询或者随机</strong>的方式进行负载均衡，也可以通过继承AbstractSinkSelector 自定义负载均衡，设置属性如下：</p> <table><thead><tr><th style="text-align:left;">属性名</th> <th style="text-align:left;">默认值</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;"><strong>processor.sinks</strong></td> <td style="text-align:left;">–</td> <td style="text-align:left;">组内多个sinks空格分隔</td></tr> <tr><td style="text-align:left;"><strong>processor.type</strong></td> <td style="text-align:left;"><code>default</code></td> <td style="text-align:left;"><code>load_balance</code></td></tr> <tr><td style="text-align:left;">processor.backoff</td> <td style="text-align:left;">false</td> <td style="text-align:left;">是否将失败的sink加入黑名单</td></tr> <tr><td style="text-align:left;">processor.selector</td> <td style="text-align:left;"><code>round_robin</code></td> <td style="text-align:left;">轮询机制:<code>round_robin</code>, <code>random</code> 或者自定义</td></tr> <tr><td style="text-align:left;">processor.selector.maxTimeOut</td> <td style="text-align:left;">30000</td> <td style="text-align:left;">黑名单有效时间（单位毫秒）</td></tr></tbody></table> <p>示例如下：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>a1.sinkgroups <span class="token operator">=</span> g1
a1.sinkgroups.g1.sinks <span class="token operator">=</span> k1 k2
a1.sinkgroups.g1.processor.type <span class="token operator">=</span> load_balance
a1.sinkgroups.g1.processor.backoff <span class="token operator">=</span> <span class="token boolean">true</span>
a1.sinkgroups.g1.processor.selector <span class="token operator">=</span> round_robin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>修改上面的agent9.conf，直接agent10.conf，将所有的sink都绑定到c1上</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 定义agent名称为a1</span>
<span class="token comment"># 设置3个组件的名称</span>
a1.sources <span class="token operator">=</span> r1
a1.sinks <span class="token operator">=</span> k1 k2 k3 k4
a1.channels <span class="token operator">=</span> c1

<span class="token comment"># 配置source类型为NetCat,监听地址为本机，端口为44444</span>
a1.sources.r1.type <span class="token operator">=</span> netcat
a1.sources.r1.bind <span class="token operator">=</span> localhost
a1.sources.r1.port <span class="token operator">=</span> <span class="token number">44444</span>

<span class="token comment"># 配置sink组</span>
a1.sinkgroups <span class="token operator">=</span> g1
a1.sinkgroups.g1.sinks <span class="token operator">=</span> k1 k2 k3 k4
a1.sinkgroups.g1.processor.type <span class="token operator">=</span> load_balance
a1.sinkgroups.g1.processor.backoff <span class="token operator">=</span> <span class="token boolean">true</span>
a1.sinkgroups.g1.processor.selector <span class="token operator">=</span> round_robin

<span class="token comment"># 配置sink1类型为Logger</span>
a1.sinks.k1.type <span class="token operator">=</span> logger

<span class="token comment"># 配置sink2,3,4类型为Avro</span>
a1.sinks.k2.type <span class="token operator">=</span> avro
a1.sinks.k2.hostname <span class="token operator">=</span> <span class="token number">192.168</span>.88.130
a1.sinks.k2.port <span class="token operator">=</span> <span class="token number">4040</span>

a1.sinks.k3.type <span class="token operator">=</span> avro
a1.sinks.k3.hostname <span class="token operator">=</span> <span class="token number">192.168</span>.88.130
a1.sinks.k3.port <span class="token operator">=</span> <span class="token number">4041</span>

a1.sinks.k4.type <span class="token operator">=</span> avro
a1.sinks.k4.hostname <span class="token operator">=</span> <span class="token number">192.168</span>.88.130
a1.sinks.k4.port <span class="token operator">=</span> <span class="token number">4042</span>

<span class="token comment"># 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送给sink的Events数量最大为100</span>
a1.channels.c1.type <span class="token operator">=</span> memory
a1.channels.c1.capacity <span class="token operator">=</span> <span class="token number">1000</span>
a1.channels.c1.transactionCapacity <span class="token operator">=</span> <span class="token number">100</span>

<span class="token comment"># 将source和sink绑定到channel上</span>
a1.sources.r1.channels <span class="token operator">=</span> c1
a1.sinks.k1.channel <span class="token operator">=</span> c1
a1.sinks.k2.channel <span class="token operator">=</span> c1
a1.sinks.k3.channel <span class="token operator">=</span> c1
a1.sinks.k4.channel <span class="token operator">=</span> c1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><p>也可以修改成随机·<code>random</code>，试下效果</p> <h1 id="使用flume导入数据到hdfs"><a href="#使用flume导入数据到hdfs" class="header-anchor">#</a> 使用Flume导入数据到HDFS</h1> <p>在这里安装了hadoop集群，用户名为hadoop</p> <p>数据导出到HDFS需要使用HDFS Sink，需要配置属性如下：</p> <table><thead><tr><th style="text-align:left;">属性名</th> <th style="text-align:left;">默认值</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;"><strong>channel</strong></td> <td style="text-align:left;">–</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;"><strong>type</strong></td> <td style="text-align:left;">–</td> <td style="text-align:left;"><code>hdfs</code></td></tr> <tr><td style="text-align:left;"><strong>hdfs.path</strong></td> <td style="text-align:left;">–</td> <td style="text-align:left;">HDFS 文件路径 (例如 hdfs://namenode/flume/webdata/)</td></tr> <tr><td style="text-align:left;">hdfs.fileType</td> <td style="text-align:left;">SequenceFile</td> <td style="text-align:left;">文件格式:  <code>SequenceFile</code>, <code>DataStream</code> or <code>CompressedStream</code> (1)DataStream 不会压缩输出文件且不用设置 codeC (2)CompressedStream 需要设置 hdfs.codeC</td></tr> <tr><td style="text-align:left;">hdfs.codeC</td> <td style="text-align:left;"></td> <td style="text-align:left;">压缩格式 : gzip, bzip2, lzo, lzop, snappy</td></tr></tbody></table> <p>注：使用HDFS Sink需要用到Hadoop的多个包，可以在装有Hadoop的主机上运行Flume，</p> <p>如果是单独部署的Flume，可以通过多个Agent的形式将单独部署的Flume Agent 日志数据发送到装有Hadoop的Flume Agent上。</p> <p>创建hdfs.conf</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment"># agent名称为a1</span>
<span class="token comment"># 设置3个组件的名称</span>
<span class="token key attr-name">a1.sources</span> <span class="token punctuation">=</span> <span class="token value attr-value">r1</span>
<span class="token key attr-name">a1.sinks</span> <span class="token punctuation">=</span> <span class="token value attr-value">k1</span>
<span class="token key attr-name">a1.channels</span> <span class="token punctuation">=</span> <span class="token value attr-value">c1</span>

<span class="token comment"># 配置source类型为NetCat,监听地址为本机，端口为44444</span>
<span class="token key attr-name">a1.sources.r1.type</span> <span class="token punctuation">=</span> <span class="token value attr-value">netcat</span>
<span class="token key attr-name">a1.sources.r1.bind</span> <span class="token punctuation">=</span> <span class="token value attr-value">localhost</span>
<span class="token key attr-name">a1.sources.r1.port</span> <span class="token punctuation">=</span> <span class="token value attr-value">44444</span>

<span class="token comment"># 配置sink类型为hdfs</span>
<span class="token key attr-name">a1.sinks.k1.type</span> <span class="token punctuation">=</span> <span class="token value attr-value">hdfs</span>
<span class="token key attr-name">a1.sinks.k1.hdfs.path</span> <span class="token punctuation">=</span> <span class="token value attr-value">hdfs://node:8020/user/flume/logs</span>
<span class="token key attr-name">a1.sinks.k1.hdfs.fileType</span> <span class="token punctuation">=</span> <span class="token value attr-value">DataStream</span>

<span class="token comment"># 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送给sink的Events数量最大为100</span>
<span class="token key attr-name">a1.channels.c1.type</span> <span class="token punctuation">=</span> <span class="token value attr-value">memory</span>
<span class="token key attr-name">a1.channels.c1.capacity</span> <span class="token punctuation">=</span> <span class="token value attr-value">1000</span>
<span class="token key attr-name">a1.channels.c1.transactionCapacity</span> <span class="token punctuation">=</span> <span class="token value attr-value">100</span>

<span class="token comment"># 将source和sink绑定到channel上</span>
<span class="token key attr-name">a1.sources.r1.channels</span> <span class="token punctuation">=</span> <span class="token value attr-value">c1</span>
<span class="token key attr-name">a1.sinks.k1.channel</span> <span class="token punctuation">=</span> <span class="token value attr-value">c1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>启动flume</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>flume-ng agent <span class="token parameter variable">-n</span> a1 <span class="token parameter variable">-c</span> ./ <span class="token parameter variable">-f</span> hdfs.conf

bin/flume-ng agent <span class="token parameter variable">--conf</span> conf/ --conf-file conf/hdfs.conf <span class="token parameter variable">-Dfile.root.logger</span><span class="token operator">=</span>debug,info,console <span class="token parameter variable">--name</span> hdfs
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>注：如果出现<code>com.google.common.base.Preconditions.checkArgument</code> 查看下<code>flume/lib</code>目录下</p> <p>的<code>guava.jar</code>版本是否与<code>hadoop/share/hadoop/common/lib</code>中的版本是否一致，不一致拷贝新版</p> <p>重新运行</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250110105658916.png" alt="image-20250110105658916"></p> <p>从另一个终端启动Netcat连接到44444端口，发送一些字符串</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250110105949785.png" alt="image-20250110105949785"></p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706069.png" alt="image-20200112212041558"></p> <p>在后台查看</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>hadoop fs <span class="token parameter variable">-cat</span> /user/flume/messages/flume-.1578835130630
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706070.png" alt="image-20200112212150353"></p> <h1 id="使用多个agent导出数据到hdfs"><a href="#使用多个agent导出数据到hdfs" class="header-anchor">#</a> 使用多个Agent导出数据到HDFS</h1> <p>130-&gt;131</p> <p>agent11.conf（130机器上）</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 定义agent名称为a1</span>
<span class="token comment"># 设置3个组件的名称</span>
a1.sources <span class="token operator">=</span> r1
a1.sinks <span class="token operator">=</span> k1
a1.channels <span class="token operator">=</span> c1

<span class="token comment"># 配置source类型为NetCat，监听地址为本机，端口为44444</span>
a1.sources.r1.type <span class="token operator">=</span> netcat
a1.sources.r1.bind <span class="token operator">=</span> localhost
a1.sources.r1.port <span class="token operator">=</span> <span class="token number">44444</span>

<span class="token comment"># 配置sink类型为Avro</span>
a1.sinks.k1.type <span class="token operator">=</span> avro
a1.sinks.k1.hostname <span class="token operator">=</span> <span class="token number">192.168</span>.88.131
a1.sinks.k1.port <span class="token operator">=</span> <span class="token number">4040</span>

<span class="token comment"># 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送给sink的Events数量最大为100</span>
a1.channels.c1.type <span class="token operator">=</span> memory
a1.channels.c1.capacity <span class="token operator">=</span> <span class="token number">1000</span>
a1.channels.c1.transactionCapacity <span class="token operator">=</span> <span class="token number">100</span>

<span class="token comment"># 将source和sink绑定到channel上</span>
a1.sources.r1.channels <span class="token operator">=</span> c1
a1.sinks.k1.channel <span class="token operator">=</span> c1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>multi-agent.conf（131机器上）</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># agent名称为a1</span>
<span class="token comment"># 设置3个组件的名称</span>
a1.sources <span class="token operator">=</span> r1
a1.sinks <span class="token operator">=</span> k1
a1.channels <span class="token operator">=</span> c1

<span class="token comment"># 配置source类型为avro</span>
a1.sources.r1.type <span class="token operator">=</span> avro
a1.sources.r1.bind <span class="token operator">=</span> <span class="token number">192.168</span>.88.131
a1.sources.r1.port <span class="token operator">=</span> <span class="token number">4040</span>

<span class="token comment"># 配置sink类型为hdfs</span>
a1.sinks.k1.type <span class="token operator">=</span> hdfs
a1.sinks.k1.hdfs.path <span class="token operator">=</span> hdfs://node:8020/user/flume/logs
a1.sinks.k1.hdfs.fileType <span class="token operator">=</span> DataStream

<span class="token comment"># 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送</span>
给sink的Events数量最大为100
a1.channels.c1.type <span class="token operator">=</span> memory
a1.channels.c1.capacity <span class="token operator">=</span> <span class="token number">1000</span>
a1.channels.c1.transactionCapacity <span class="token operator">=</span> <span class="token number">100</span>

<span class="token comment"># 将source和sink绑定到channel上</span>
a1.sources.r1.channels <span class="token operator">=</span> c1
a1.sinks.k1.channel <span class="token operator">=</span> c1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>启动agent</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>flume-ng agent <span class="token parameter variable">-n</span> a1 <span class="token parameter variable">-c</span> ./ <span class="token parameter variable">-f</span> multi-agent.conf

flume-ng agent <span class="token parameter variable">-n</span> a1 <span class="token parameter variable">-c</span> ./ <span class="token parameter variable">-f</span> agent11.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>从130机器另一个终端启动Netcat连接到44444端口，发送一些字符串</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250113114845680.png" alt="image-20250113114845680"></p> <p>在131机器上可以看到</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250113114959939.png" alt="image-20250113114959939"></p> <p>浏览器访问http://node:9870/，点击Utilities中的Browse the file system</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250113115334039.png" alt="image-20250113115334039"></p> <p><code>hadoop</code>中查看</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250113130802139.png" alt="image-20250113130802139"></p> <h1 id="flume-sdk"><a href="#flume-sdk" class="header-anchor">#</a> Flume SDK</h1> <h2 id="自定义source"><a href="#自定义source" class="header-anchor">#</a> 自定义Source</h2> <blockquote><p>想去哪里获取数据就可以自定义</p></blockquote> <p><a href="https://flume.apache.org/releases/content/1.11.0/FlumeDeveloperGuide.html#source" target="_blank" rel="noopener noreferrer">自定义Source示例<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MySource</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractSource</span> <span class="token keyword">implements</span> <span class="token class-name">Configurable</span><span class="token punctuation">,</span> <span class="token class-name">PollableSource</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> myProp<span class="token punctuation">;</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> myProp <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;myProp&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;defaultValue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Process the myProp value (e.g. validation, convert to another type, ...)</span>

    <span class="token comment">// Store myProp for later retrieval by process() method</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>myProp <span class="token operator">=</span> myProp<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Initialize the connection to the external client</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> stop <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Disconnect from external client and do any additional cleanup</span>
    <span class="token comment">// (e.g. releasing resources or nulling-out field values) ..</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token class-name">Status</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">EventDeliveryException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Status</span> status <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">// This try clause includes whatever Channel/Event operations you want to do</span>

      <span class="token comment">// Receive new data</span>
      <span class="token class-name">Event</span> e <span class="token operator">=</span> <span class="token function">getSomeData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// Store the Event into this Source's associated Channel(s)</span>
      <span class="token function">getChannelProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">processEvent</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>

      status <span class="token operator">=</span> <span class="token class-name">Status</span><span class="token punctuation">.</span><span class="token constant">READY</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Log exception, handle individual exceptions as needed</span>

      status <span class="token operator">=</span> <span class="token class-name">Status</span><span class="token punctuation">.</span><span class="token constant">BACKOFF</span><span class="token punctuation">;</span>

      <span class="token comment">// re-throw all Errors</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token keyword">instanceof</span> <span class="token class-name">Error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token punctuation">(</span><span class="token class-name">Error</span><span class="token punctuation">)</span>t<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
      txn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> status<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><p>添加MySource</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>example<span class="token punctuation">.</span>flumedemo<span class="token punctuation">.</span>source</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flume<span class="token punctuation">.</span></span><span class="token class-name">Context</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flume<span class="token punctuation">.</span></span><span class="token class-name">Event</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flume<span class="token punctuation">.</span></span><span class="token class-name">EventDeliveryException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flume<span class="token punctuation">.</span></span><span class="token class-name">PollableSource</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flume<span class="token punctuation">.</span>conf<span class="token punctuation">.</span></span><span class="token class-name">Configurable</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flume<span class="token punctuation">.</span>event<span class="token punctuation">.</span></span><span class="token class-name">SimpleEvent</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flume<span class="token punctuation">.</span>source<span class="token punctuation">.</span></span><span class="token class-name">AbstractSource</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 自定义Source
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MySource</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractSource</span> <span class="token keyword">implements</span> <span class="token class-name">Configurable</span><span class="token punctuation">,</span> <span class="token class-name">PollableSource</span> <span class="token punctuation">{</span>

    <span class="token comment">// 处理数据</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Status</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">EventDeliveryException</span> <span class="token punctuation">{</span>

        <span class="token class-name">Status</span> status <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 自己模拟数据来发送</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Event</span> event <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                event<span class="token punctuation">.</span><span class="token function">setBody</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;data:&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 将数据存储到与Source关联的Channel中</span>
                <span class="token function">getChannelProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">processEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 数据准备消费</span>
                status <span class="token operator">=</span> <span class="token class-name">Status</span><span class="token punctuation">.</span><span class="token constant">READY</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// 休眠5秒</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 打印日志</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            status <span class="token operator">=</span> <span class="token class-name">Status</span><span class="token punctuation">.</span><span class="token constant">BACKOFF</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> status<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getBackOffSleepIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getMaxBackOffSleepInterval</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><p>添加完自定义Source后，然后package打包一下，复制上传到/opt/soft/flume/lib/下</p> <p>添加mySourceAgent.conf</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 定义agent名称为a1</span>
<span class="token comment"># 设置3个组件的名称</span>
a1.sources <span class="token operator">=</span> r1
a1.sinks <span class="token operator">=</span> k1
a1.channels <span class="token operator">=</span> c1

<span class="token comment"># 配置source类型为mysource</span>
a1.sources.r1.type <span class="token operator">=</span> org.example.flumedemo.source.MySource

<span class="token comment"># 配置sink类型为Logger</span>
a1.sinks.k1.type <span class="token operator">=</span> logger

<span class="token comment"># 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送给sink的Events数量最大为100</span>
a1.channels.c1.type <span class="token operator">=</span> memory
a1.channels.c1.capacity <span class="token operator">=</span> <span class="token number">1000</span>
a1.channels.c1.transactionCapacity <span class="token operator">=</span> <span class="token number">100</span>

<span class="token comment"># 将source和sink绑定到channel上</span>
a1.sources.r1.channels <span class="token operator">=</span> c1
a1.sinks.k1.channel <span class="token operator">=</span> c1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>启动Flume</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>flume-ng agent <span class="token parameter variable">-n</span> a1 <span class="token parameter variable">-c</span> ./ <span class="token parameter variable">-f</span> mySourceAgent.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>输出结果</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250113140244503.png" alt="image-20250113140244503"></p> <h2 id="自定义sink"><a href="#自定义sink" class="header-anchor">#</a> 自定义Sink</h2> <p><a href="https://flume.apache.org/releases/content/1.11.0/FlumeDeveloperGuide.html#sink" target="_blank" rel="noopener noreferrer">自定义Sinkf示例<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MySink</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractSink</span> <span class="token keyword">implements</span> <span class="token class-name">Configurable</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> myProp<span class="token punctuation">;</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> myProp <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;myProp&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;defaultValue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Process the myProp value (e.g. validation)</span>

    <span class="token comment">// Store myProp for later retrieval by process() method</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>myProp <span class="token operator">=</span> myProp<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Initialize the connection to the external repository (e.g. HDFS) that</span>
    <span class="token comment">// this Sink will forward Events to ..</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> stop <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Disconnect from the external respository and do any</span>
    <span class="token comment">// additional cleanup (e.g. releasing resources or nulling-out</span>
    <span class="token comment">// field values) ..</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token class-name">Status</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">EventDeliveryException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Status</span> status <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token comment">// Start transaction</span>
    <span class="token class-name">Channel</span> ch <span class="token operator">=</span> <span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Transaction</span> txn <span class="token operator">=</span> ch<span class="token punctuation">.</span><span class="token function">getTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    txn<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">// This try clause includes whatever Channel operations you want to do</span>

      <span class="token class-name">Event</span> event <span class="token operator">=</span> ch<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// Send the Event to the external repository.</span>
      <span class="token comment">// storeSomeData(e);</span>

      txn<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      status <span class="token operator">=</span> <span class="token class-name">Status</span><span class="token punctuation">.</span><span class="token constant">READY</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      txn<span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// Log exception, handle individual exceptions as needed</span>

      status <span class="token operator">=</span> <span class="token class-name">Status</span><span class="token punctuation">.</span><span class="token constant">BACKOFF</span><span class="token punctuation">;</span>

      <span class="token comment">// re-throw all Errors</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token keyword">instanceof</span> <span class="token class-name">Error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token punctuation">(</span><span class="token class-name">Error</span><span class="token punctuation">)</span>t<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> status<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><p>添加MySink，可以参考LoggerSink</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>example<span class="token punctuation">.</span>flumedemo<span class="token punctuation">.</span>sink</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flume<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flume<span class="token punctuation">.</span>conf<span class="token punctuation">.</span></span><span class="token class-name">Configurable</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flume<span class="token punctuation">.</span>sink<span class="token punctuation">.</span></span><span class="token class-name">AbstractSink</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MySink</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractSink</span> <span class="token keyword">implements</span> <span class="token class-name">Configurable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> <span class="token constant">LOGGER</span> <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">MySink</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 处理数据</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Status</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">EventDeliveryException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Status</span> status <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取跟Sink绑定的Channel</span>
        <span class="token class-name">Channel</span> ch <span class="token operator">=</span> <span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取事务</span>
        <span class="token class-name">Transaction</span> transaction <span class="token operator">=</span> ch<span class="token punctuation">.</span><span class="token function">getTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 开启事务</span>
            transaction<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 从channel中接收数据</span>
            <span class="token class-name">Event</span> event <span class="token operator">=</span> ch<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>event <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                status <span class="token operator">=</span> <span class="token class-name">Status</span><span class="token punctuation">.</span><span class="token constant">BACKOFF</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// 可以将数据发送到外部存储</span>
                <span class="token comment">// storeSomeData(e);</span>
                <span class="token comment">// 模拟实现LoggerSink的功能</span>
                <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                status <span class="token operator">=</span> <span class="token class-name">Status</span><span class="token punctuation">.</span><span class="token constant">READY</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//提交事务</span>
            transaction<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 事务回滚</span>
            transaction<span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 打印异常</span>
            <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 返回失败状态</span>
            status <span class="token operator">=</span> <span class="token class-name">Status</span><span class="token punctuation">.</span><span class="token constant">BACKOFF</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token comment">// 关闭事务</span>
            transaction<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> status<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><p>重新package打包，上传到opt/soft/flume/lib/</p> <p>修改上面的mySourceAgent.conf</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 定义agent名称为a1</span>
<span class="token comment"># 设置3个组件的名称</span>
a1.sources <span class="token operator">=</span> r1
a1.sinks <span class="token operator">=</span> k1
a1.channels <span class="token operator">=</span> c1

<span class="token comment"># 配置source类型为mysource</span>
a1.sources.r1.type <span class="token operator">=</span> com.itheima.flume.source.MySource

<span class="token comment"># 配置sink类型为MySink</span>
a1.sinks.k1.type <span class="token operator">=</span> com.itheima.flume.sink.MySink

<span class="token comment"># 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送给sink的Events数量最大为100</span>
a1.channels.c1.type <span class="token operator">=</span> memory
a1.channels.c1.capacity <span class="token operator">=</span> <span class="token number">1000</span>
a1.channels.c1.transactionCapacity <span class="token operator">=</span> <span class="token number">100</span>

<span class="token comment"># 将source和sink绑定到channel上</span>
a1.sources.r1.channels <span class="token operator">=</span> c1
a1.sinks.k1.channel <span class="token operator">=</span> c1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>启动Flume</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>flume-ng agent <span class="token parameter variable">-n</span> a1 <span class="token parameter variable">-c</span> ./ <span class="token parameter variable">-f</span> mySourceAgent.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>输出结果（相当于自己实现logger）</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250113143840898.png" alt="image-20250113143840898"></p> <h1 id="flume监控"><a href="#flume监控" class="header-anchor">#</a> Flume监控</h1> <p>Ganglia是UC Berkeley发起的一个开源集群监视项目，设计用于测量数以千计的节点。</p> <p>Ganglia的核心包含<strong>gmond（监控守护进程）、gmetad（元数据守护进程）以及一个Web前端。</strong></p> <p>主要是用来<strong>监控系统性能</strong>，如：cpu 、mem、硬盘利用率， I/O负载、网络流量情况等，通过曲线很容易见到每个节点的工作状态，对合理调整、分配系统资源，提高系统整体性能起到重要作用。</p> <h2 id="ganglia安装"><a href="#ganglia安装" class="header-anchor">#</a> Ganglia安装</h2> <p>**中心节点的安装 **</p> <ul><li>epel包的安装：yum install -y epel-release(解决不能yum安装某些安装包的问题)</li> <li>gmetad的安装：yum install -y ganglia-gmetad</li> <li>gmond的安装：yum install -y ganglia-gmond（监控守护进程会使用到下面的工具rrdtool）</li> <li>rrdtool的安装：yum install -y rrdtool</li> <li>httpd服务器的安装：yum install -y httpd（Web前端需要部署在httpd上）</li> <li>ganglia-web及php安装：yum install -y ganglia-web php（ganglia前端是php写的）</li></ul> <p><strong>被监测节点的安装</strong></p> <ul><li>epel包的安装：yum install -y epel-release(解决不能yum安装某些安装包的问题)</li> <li>gmond的安装：yum install -y gmond(提示找不到，感觉应该换成上面那个yum install -y ganglia-gmond)</li></ul> <h2 id="ganglia配置"><a href="#ganglia配置" class="header-anchor">#</a> Ganglia配置</h2> <p><strong>中心节点的配置</strong>
安装目录说明</p> <ul><li>ganglia配置文件目录：/etc/ganglia</li> <li>rrd数据库存放目录：/var/lib/ganglia/rrds</li> <li>ganglia-web安装目录：/usr/share/ganglia</li> <li>ganglia-web配置目录：/etc/httpd/conf.d/ganglia.conf</li></ul> <p>相关配置文件修改
将ganglia-web的站点目录连接到httpd主站点目录</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 把 /usr/share/ganglia 链接到 /var/www/html/ 下，默认以ganglia命令</span>
$  <span class="token function">ln</span> <span class="token parameter variable">-s</span> /usr/share/ganglia /var/www/html
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>修改httpd主站点目录下ganglia站点目录的访问权限
将ganglia站点目录访问权限改为apache:apache，否则会报错</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$  <span class="token function">chown</span> <span class="token parameter variable">-R</span> apache:apache /var/www/html/ganglia
$  <span class="token function">chmod</span> <span class="token parameter variable">-R</span> <span class="token number">755</span> /var/www/html/ganglia
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>修改rrd数据库存放目录访问权限
将rrd数据库存放目录访问权限改为nobody:nobody,否则会报错</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$  <span class="token function">chown</span> <span class="token parameter variable">-R</span> nobody:nobody /var/lib/ganglia/rrds
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>修改ganglia-web的访问权限：
修改/etc/httpd/conf.d/ganglia.conf</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>Alias /ganglia /usr/share/ganglia
<span class="token operator">&lt;</span>Location /ganglia<span class="token operator">&gt;</span> 
 Require all granted
 <span class="token comment">#Require ip 10.1.2.3</span>
 <span class="token comment">#Require host example.org</span>
<span class="token operator">&lt;</span>/Location<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>修改dwoo下面的权限</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">chmod</span> <span class="token number">777</span> /var/lib/ganglia/dwoo/compiled
<span class="token function">chmod</span> <span class="token number">777</span> /var/lib/ganglia/dwoo/cache
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>配置/etc/ganglia/gmetad.conf</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>data_source  <span class="token string">&quot;my cluster&quot;</span> <span class="token number">192.168</span>.88.130:8649<span class="token punctuation">(</span>注意是所有节点都加上，如master:8649 slave0x:8649<span class="token punctuation">)</span>
 
setuid_username nobody
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>配置/etc/ganglia/gmond.conf</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>cluster <span class="token punctuation">{</span> 
  name <span class="token operator">=</span> <span class="token string">&quot;my cluster&quot;</span>
  <span class="token punctuation">..</span>. 
<span class="token punctuation">}</span> 
udp_send_channel <span class="token punctuation">{</span> 
  <span class="token comment"># the host who gather this cluster's monitoring data and send these data   to gmetad node</span>
  <span class="token comment">#注释掉多播模式的,以下出现这个都要注释掉</span>
 <span class="token comment">#mcast_join = 239.2.11.71</span>
 <span class="token comment">#添加单播模式的</span>
 <span class="token function">host</span> <span class="token operator">=</span> <span class="token number">192.168</span>.88.130
 port <span class="token operator">=</span> <span class="token number">8649</span> 
<span class="token punctuation">}</span> 
udp_recv_channel <span class="token punctuation">{</span> 
  <span class="token comment"># 0.0.0.0</span>
  <span class="token builtin class-name">bind</span> <span class="token operator">=</span> <span class="token number">0.0</span>.0.0
  port <span class="token operator">=</span> <span class="token number">8649</span> 
<span class="token punctuation">}</span> 
tcp_accept_channel <span class="token punctuation">{</span> 
  port <span class="token operator">=</span> <span class="token number">8649</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><strong>被监测节点的配置</strong>
配置/etc/ganglia/gmond.conf</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>cluster <span class="token punctuation">{</span> 
  name <span class="token operator">=</span> <span class="token string">&quot;hadoop cluster&quot;</span>
  <span class="token punctuation">..</span>. 
<span class="token punctuation">}</span> 
udp_send_channel <span class="token punctuation">{</span> 
  <span class="token comment"># the host who gather this cluster's monitoring data and send these data   to gmetad node</span>
 <span class="token function">host</span> <span class="token operator">=</span> <span class="token number">192.168</span>.26.139  
 port <span class="token operator">=</span> <span class="token number">8649</span> 
<span class="token punctuation">}</span> 
udp_recv_channel <span class="token punctuation">{</span> 
  port <span class="token operator">=</span> <span class="token number">8649</span> 
<span class="token punctuation">}</span> 
tcp_accept_channel <span class="token punctuation">{</span> 
  port <span class="token operator">=</span> <span class="token number">8649</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="ganglia启动"><a href="#ganglia启动" class="header-anchor">#</a> Ganglia启动</h2> <p><strong>中心节点的启动</strong>
start httpd, gmetad, gmond</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ systemctl start httpd.service
$ systemctl start gmetad.service
$ systemctl start gmond.service
$ systemctl <span class="token builtin class-name">enable</span> httpd.service
$ systemctl <span class="token builtin class-name">enable</span> gmetad.service
$ systemctl <span class="token builtin class-name">enable</span> gmond.service


<span class="token comment"># 也可以使用</span>
sevice httpd start
servie httpd status

sevice gmetad start
servie gmetad status

sevice gmond start
servie gmond status
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p><strong>被监测节点的启动</strong>
start gmond</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ systemctl start gmond.service
$ systemctl <span class="token builtin class-name">enable</span> gmond.service
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>关闭selinux</strong></p> <p>vi /etc/selinux/config，把SELINUX=enforcing改成SELINUX=disable；该方法需要重启机器。
可以使用命令setenforce 0来关闭selinux而不需要重启，刷新页面，即可访问；不过此法只是权宜之计，如果想永久修改selinux设置，还是要使用第一种方法</p> <p><strong>开启防火墙</strong>（外网访问需要开启端口，默认80。目前机器防火墙是关闭的）</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>firewall-cmd <span class="token parameter variable">--zone</span><span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">80</span>/tcp <span class="token parameter variable">--permanent</span>
firewall-cmd <span class="token parameter variable">--reload</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>访问网页</strong>
浏览器访问 {namenode的ip}/ganglia即可</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706071.png" alt="image-20200326103901392"></p> <h2 id="添加flume监控"><a href="#添加flume监控" class="header-anchor">#</a> 添加Flume监控</h2> <p>修改flume-env.sh配置，添加虚拟机选项</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token assign-left variable">JAVA_OPTS</span><span class="token operator">=</span><span class="token string">&quot;-Dflume.monitoring.type=ganglia -Dflume.monitoring.hosts=192.168.88.130:8649 -Xms100m -Xmx200m&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501171510906.png" alt="image-20250117151019808"></p> <p>启动flume</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>flume-ng agent <span class="token parameter variable">-n</span> a1 <span class="token parameter variable">-c</span> ./ <span class="token parameter variable">-f</span> mySourceAgent.conf <span class="token parameter variable">-Dflume.monitoring.type</span><span class="token operator">=</span>ganglia <span class="token parameter variable">-Dflume.monitoring.hosts</span><span class="token operator">=</span><span class="token number">192.168</span>.88.130:8649
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>查看ganglia页面</p> <p><img src="https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501171507683.png" alt="image-20250117150708576"></p> <table><thead><tr><th>字段（图表名称）</th> <th>字段含义</th></tr></thead> <tbody><tr><td>EventPutAttemptCount</td> <td>source尝试写入channel的事件总数量</td></tr> <tr><td>EventPutSuccessCount</td> <td>成功写入channel且提交的事件总数量</td></tr> <tr><td>EventTakeAttemptCount</td> <td>sink尝试从channel拉取事件的总数量。这不意味着每次事件都被返回，因为sink拉取的时候channel可能没有任何数据。</td></tr> <tr><td>EventTakeSuccessCount</td> <td>sink成功读取的事件的总数量</td></tr> <tr><td>StartTime</td> <td>channel启动的时间（毫秒）</td></tr> <tr><td>StopTime</td> <td>channel停止的时间（毫秒）</td></tr> <tr><td>ChannelSize</td> <td>目前channel中事件的总数量</td></tr> <tr><td>ChannelFillPercentage</td> <td>channel占用百分比</td></tr> <tr><td>ChannelCapacity</td> <td>channel的容量</td></tr></tbody></table> <p>目前mySourceAgent.conf配置文件中</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># channel的容量为1000</span>
a1.channels.c1.capacity <span class="token operator">=</span> <span class="token number">1000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>每张图片可点击查看具体情况</p></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/xugaoyi/vuepress-theme-vdoing/edit/master/docs/《Flume》笔记/01.Flume.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2025/01/17, 15:51:58</span></div></div> <div class="page-nav-wapper"><!----> <!----></div></div> <div class="article-list"><div class="article-title"><a href="/vuepress-tion-blog/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/vuepress-tion-blog/pages/31d7dd/"><div>
            05-大数据技术之Hadoop（Yarn）V3.3
            <!----></div></a> <span class="date">02-24</span></dt></dl><dl><dd>02</dd> <dt><a href="/vuepress-tion-blog/pages/fc670b/"><div>
            Linux实用操作
            <!----></div></a> <span class="date">02-22</span></dt></dl><dl><dd>03</dd> <dt><a href="/vuepress-tion-blog/pages/bdd22a/"><div>
            用户和权限
            <!----></div></a> <span class="date">02-22</span></dt></dl> <dl><dd></dd> <dt><a href="/vuepress-tion-blog/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:894072666@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/xugaoyi" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2025
    <span>Evan Xu | <a href="https://github.com/xugaoyi/vuepress-theme-vdoing/blob/master/LICENSE" target="_blank">MIT License</a> | <a href="http://beian.miit.gov.cn/" target="_blank">桂ICP备2024034950号</a> | <img src="/img/beian.png" style="width: 15px; margin-bottom: -3px;" /> <a href="https://beian.mps.gov.cn/#/query/webSearch?code=45142202000030" rel="noreferrer" target="_blank">桂公网安备45142202000030</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/vuepress-tion-blog/assets/js/app.985e0c44.js" defer></script><script src="/vuepress-tion-blog/assets/js/2.1e9277be.js" defer></script><script src="/vuepress-tion-blog/assets/js/94.99e6ce73.js" defer></script>
  </body>
</html>
