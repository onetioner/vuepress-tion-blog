(window.webpackJsonp=window.webpackJsonp||[]).push([[94],{451:function(s,t,a){"use strict";a.r(t);var n=a(7),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"flume概述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#flume概述"}},[s._v("#")]),s._v(" Flume概述")]),s._v(" "),t("p",[s._v("Flume是的一个分布式、高可用、高可靠的海量日志采集、聚合和传输的系统，支持在日志系统中定制各类数据发送方，用于收集数据，同时提供了对数据进行简单处理并写到各种数据接收方的能力。")]),s._v(" "),t("blockquote",[t("p",[s._v("分布式：部署多个Agent来做分布式")]),s._v(" "),t("p",[s._v("高可用：通过Sink的负载均衡（或者说是副本机制）来保证高可用")]),s._v(" "),t("p",[s._v("高可靠：是通过Channel事务来保证高可靠")]),s._v(" "),t("p",[s._v("定制各类数据：指定各种Source")]),s._v(" "),t("p",[s._v("简单处理：通过拦截器实现修改、丢弃")]),s._v(" "),t("p",[s._v("各种接收方：指定各种Sink")])]),s._v(" "),t("p",[s._v("Flume的设计原理是基于数据流的，能够将不同数据源的海量日志数据进行高效收集、聚合、移动，最后存储到一个中心化数据存储系统中。 Flume能够做到近似实时的推送，并且可以满足数据量是持续且量级很大的情况。比如它可以收集社交网站日志，并将这些数量庞大的日志数据从网站服务器上汇集起来，存储到HDFS或 HBase分布式数据库中。")]),s._v(" "),t("p",[s._v("Flume的应用场景:比如一个电商网站，想从网站访问者中访问一些特定的节点区域来分析消费者的购物意图和行为。为了实现这一点，需要收集到消费者访问的页面以及点击的产品等日志信息，并移交到大数据 Hadoop平台上去分析，可以利用 Flume做到这一点。现在流行的内容推送，比如广告定点投放以及新闻私人定制也是基于这个道理。")]),s._v(" "),t("h1",{attrs:{id:"flume架构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#flume架构"}},[s._v("#")]),s._v(" Flume架构")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706044.png",alt:"image-20200327112206283"}})]),s._v(" "),t("h2",{attrs:{id:"event"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#event"}},[s._v("#")]),s._v(" Event")]),s._v(" "),t("p",[s._v("事件是Flume内部数据传输的最基本单元，将传输的数据进行封装。事件本身是由一个载有数据的字节数组和可选的headers头部信息构成，如下图所示。Flume以事件的形式将数据从源头传输到最终的目的地。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706046.png",alt:"image-20200323103129436"}})]),s._v(" "),t("h2",{attrs:{id:"agent"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#agent"}},[s._v("#")]),s._v(" Agent")]),s._v(" "),t("p",[s._v("Flume Agent 是一个JVM进程，通过三个组件（source、channel、sink）将事件流从一个外部数据源收集并发送给下一个目的地。")]),s._v(" "),t("h3",{attrs:{id:"source"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#source"}},[s._v("#")]),s._v(" Source")]),s._v(" "),t("p",[s._v("从数据发生器接收数据，并将数据以Flume的Event格式传递给一个或多个通道（Channel）")]),s._v(" "),t("p",[s._v("支持Source:")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#avro-source",target:"_blank",rel:"noopener noreferrer"}},[s._v("Avro Source"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#thrift-source",target:"_blank",rel:"noopener noreferrer"}},[s._v("Thrift Source"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#exec-source",target:"_blank",rel:"noopener noreferrer"}},[s._v("Exec Source"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#jms-source",target:"_blank",rel:"noopener noreferrer"}},[s._v("JMS Source"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#spooling-directory-source",target:"_blank",rel:"noopener noreferrer"}},[s._v("Spooling Directory Source"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#taildir-source",target:"_blank",rel:"noopener noreferrer"}},[s._v("Taildir Source"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#twitter-1-firehose-source-experimental",target:"_blank",rel:"noopener noreferrer"}},[s._v("Twitter 1% firehose Source (experimental)"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#kafka-source",target:"_blank",rel:"noopener noreferrer"}},[s._v("Kafka Source"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#netcat-tcp-source",target:"_blank",rel:"noopener noreferrer"}},[s._v("NetCat TCP Source"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#netcat-udp-source",target:"_blank",rel:"noopener noreferrer"}},[s._v("NetCat UDP Source"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#sequence-generator-source",target:"_blank",rel:"noopener noreferrer"}},[s._v("Sequence Generator Source"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#syslog-sources",target:"_blank",rel:"noopener noreferrer"}},[s._v("Syslog Sources"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#http-source",target:"_blank",rel:"noopener noreferrer"}},[s._v("HTTP Source"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#stress-source",target:"_blank",rel:"noopener noreferrer"}},[s._v("Stress Source"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#legacy-sources",target:"_blank",rel:"noopener noreferrer"}},[s._v("Legacy Sources"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#custom-source",target:"_blank",rel:"noopener noreferrer"}},[s._v("Custom Source"),t("OutboundLink")],1)])]),s._v(" "),t("h3",{attrs:{id:"channel"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#channel"}},[s._v("#")]),s._v(" Channel")]),s._v(" "),t("p",[s._v("一种短暂的存储容器，位于 Source和Sink之间，起着桥梁的作用。 Channel将从Source处接收到的 Event格式的数据缓存起来，当Sink成功地将 Events发送到下一跳的Channel或最终目的地后， Events从 Channel移除。Channel是一个完整的事务，这一点保证了数据在收发的时候的一致性。可以把 Channel看成一个FIFO（先进先出）队列，当数据的获取速率超过流出速率时，将Event保存到队列中，再从队中一个个出来。")]),s._v(" "),t("p",[s._v("有以下几种Channel：")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("Memory Channel")]),s._v(" 事件存储在可配置容量的内存队列中，队列容量即为可存储最大事件数量，适用于高吞吐量场景，在agent出现错误时有可能会丢失部分数据")]),s._v(" "),t("li",[t("strong",[s._v("File Channel")]),s._v(" 基于文件系统的持久化存储")]),s._v(" "),t("li",[s._v("Spillable Memory Channel 内存和文件混合Channel，当内存队列满了之后，新的事件会存储在文件系统，目前处于实验阶段，不建议在生产环境中使用")]),s._v(" "),t("li",[s._v("JDBC Channe 事件存储在持久化的数据库中，目前只支持Derby")]),s._v(" "),t("li",[s._v("Kafka Channel 事件存储在Kafka集群中")]),s._v(" "),t("li",[s._v("Pseudo Transaction Channel 伪事务Channel，仅用于测试，不能在生产环境使用")]),s._v(" "),t("li",[s._v("Custom Channel 自定义Channel")])]),s._v(" "),t("h3",{attrs:{id:"sink"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sink"}},[s._v("#")]),s._v(" Sink")]),s._v(" "),t("p",[s._v("获取Channel暂时保存的数据并进行处理。sink从channel中移除事件，并将其发送到下一个agent（简称下一跳）或者事件的最终目的地，比如HDFS。")]),s._v(" "),t("p",[s._v("Sink分类：")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#hdfs-sink",target:"_blank",rel:"noopener noreferrer"}},[s._v("HDFS Sink"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#hive-sink",target:"_blank",rel:"noopener noreferrer"}},[s._v("Hive Sink"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#logger-sink",target:"_blank",rel:"noopener noreferrer"}},[s._v("Logger Sink"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#avro-sink",target:"_blank",rel:"noopener noreferrer"}},[s._v("Avro Sink"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#thrift-sink",target:"_blank",rel:"noopener noreferrer"}},[s._v("Thrift Sink"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#irc-sink",target:"_blank",rel:"noopener noreferrer"}},[s._v("IRC Sink"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#file-roll-sink",target:"_blank",rel:"noopener noreferrer"}},[s._v("File Roll Sink"),t("OutboundLink")],1),s._v(" 将Events保存在本地文件系统")]),s._v(" "),t("li",[t("a",{attrs:{href:"http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#null-sink",target:"_blank",rel:"noopener noreferrer"}},[s._v("Null Sink"),t("OutboundLink")],1),s._v(" 抛弃从Channel接收的所有事件")]),s._v(" "),t("li",[t("a",{attrs:{href:"http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#hbasesinks",target:"_blank",rel:"noopener noreferrer"}},[s._v("HBaseSinks"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#morphlinesolrsink",target:"_blank",rel:"noopener noreferrer"}},[s._v("MorphlineSolrSink"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#elasticsearchsink",target:"_blank",rel:"noopener noreferrer"}},[s._v("ElasticSearchSink"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#kite-dataset-sink",target:"_blank",rel:"noopener noreferrer"}},[s._v("Kite Dataset Sink"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#kafka-sink",target:"_blank",rel:"noopener noreferrer"}},[s._v("Kafka Sink"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#http-sink",target:"_blank",rel:"noopener noreferrer"}},[s._v("HTTP Sink"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#custom-sink",target:"_blank",rel:"noopener noreferrer"}},[s._v("Custom Sink"),t("OutboundLink")],1)])]),s._v(" "),t("h2",{attrs:{id:"数据流模型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据流模型"}},[s._v("#")]),s._v(" 数据流模型")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706047.png",alt:"Agent component diagram"}})]),s._v(" "),t("p",[s._v("过程简要说明如下:\n（1）外部数据源（Web Server）将Flume可识别的 Event发送到 Source\n（2） Source收到 Event事件后存储到一个或多个Channel通道中。\n（3）Channel保留 Event直到Sink将其处理完毕。\n（4）Sink从 Channel中取出数据，并将其传输至外部存储（HDFS）。")]),s._v(" "),t("h3",{attrs:{id:"可靠性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#可靠性"}},[s._v("#")]),s._v(" 可靠性")]),s._v(" "),t("p",[s._v("事件在每个agent的channel中短暂存储，然后事件被发送到下一个agent或者最终目的地。事件只有在存储在下一个channel或者最终存储后才从当前的channel中删除。")]),s._v(" "),t("p",[s._v("Flume使用事务的办法来保证Events的可靠传递。Source和Sink分别被封装在事务中，事务由保存Event的存储或者Channel提供。这就保证了Event在数据流的点对点传输中是可靠的。在多跳的数据流中，上一跳的sink和下一跳的source均运行事务来保证数据被安全地存储到下一跳的channel中。")]),s._v(" "),t("h1",{attrs:{id:"flume安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#flume安装"}},[s._v("#")]),s._v(" Flume安装")]),s._v(" "),t("p",[s._v("Flume下载页面：http://flume.apache.org/download.html")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706048.png",alt:"image-20200323142300139"}})]),s._v(" "),t("p",[s._v("将"),t("a",{attrs:{href:"http://www.apache.org/dyn/closer.lua/flume/1.9.0/apache-flume-1.9.0-bin.tar.gz",target:"_blank",rel:"noopener noreferrer"}},[s._v(" apache-flume-1.9.0-bin.tar.gz"),t("OutboundLink")],1),s._v("下载到CentOS系统中，对其解压")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解压命令")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" xzf apache-flume-1.9.0-bin.tar.gz\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入到apache-flume-1.9.0-bin 目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" apache-flume-1.9.0-bin\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Flume使用需要依赖JDK1.8以上环境，确保已安装")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将Flume安装目录配置到PATH中，方便在任意目录使用")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/profile\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加以下内容")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_HOME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/opt/soft/jdk1.8.0_231\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JRE_HOME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/opt/soft/jdk1.8.0_231/jre\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("FLUME_HOME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/opt/soft/apache-flume-1.9.0-bin\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JAVA_HOME")]),s._v("/bin:"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JRE_HOME")]),s._v("/bin:"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$FLUME_HOME")]),s._v("/bin:\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 保存成功后刷新")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" /etc/profile\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看是否设置成功")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$FLUME_HOME")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("h1",{attrs:{id:"入门使用示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#入门使用示例"}},[s._v("#")]),s._v(" 入门使用示例")]),s._v(" "),t("h2",{attrs:{id:"案例说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#案例说明"}},[s._v("#")]),s._v(" 案例说明")]),s._v(" "),t("p",[s._v("使用Flume监听某个端口，使用Netcat向这个端口发送数据，Flume将接收到的数据打印到控制台。")]),s._v(" "),t("p",[s._v("Netcat是一款TCP/UDP测试工具，可以通过以下命令安装")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nc")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启一个服务端")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nc")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-lk")]),s._v(" localhost "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("44444")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 新建一个会话，开启一个客户端，连接端口44444")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nc")]),s._v(" localhost "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("44444")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 客户端发送数据，服务端就能接收数据")]),s._v("\nhello\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h2",{attrs:{id:"使用组件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用组件"}},[s._v("#")]),s._v(" 使用组件")]),s._v(" "),t("ul",[t("li",[t("p",[t("a",{attrs:{href:"http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#netcat-tcp-source",target:"_blank",rel:"noopener noreferrer"}},[s._v("NetCat TCP Source"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("必须属性")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"left"}},[s._v("属性名")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("默认值")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("说明")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("channels")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("–")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}})]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("type")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("–")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("netcat")])])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("bind")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("–")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("绑定的主机名或者IP地址")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("port")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("–")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("绑定端口")])])])])]),s._v(" "),t("li",[t("p",[t("a",{attrs:{href:"http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#memory-channel",target:"_blank",rel:"noopener noreferrer"}},[s._v("Memory Channel"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("必须属性")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"left"}},[s._v("属性名")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("默认值")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("说明")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("type")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("–")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("memory")])])])])])]),s._v(" "),t("li",[t("p",[t("a",{attrs:{href:"http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#logger-sink",target:"_blank",rel:"noopener noreferrer"}},[s._v("Logger Sink"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("必须属性")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"left"}},[s._v("属性名")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("默认值")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("说明")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("channel")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("–")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}})]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("type")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("–")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("logger")])])])])])])]),s._v(" "),t("h2",{attrs:{id:"添加配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#添加配置文件"}},[s._v("#")]),s._v(" 添加配置文件")]),s._v(" "),t("p",[s._v("在apache-flume-1.9.0-bin/conf目录下添加配置文件example.conf")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# example.conf: 单节点Flume配置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义agent名称为a1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置3个组件的名称")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a1.sources")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("r1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a1.sinks")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("k1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a1.channels")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("c1")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置source类型为NetCat,监听地址为本机，端口为44444")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a1.sources.r1.type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("netcat")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a1.sources.r1.bind")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("localhost")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a1.sources.r1.port")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("44444")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置sink类型为Logger")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a1.sinks.k1.type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("logger")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送给sink的Events数量最大为100")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a1.channels.c1.type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("memory")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a1.channels.c1.capacity")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("1000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a1.channels.c1.transactionCapacity")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("100")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将source和sink绑定到channel上")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a1.sources.r1.channels")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("c1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a1.sinks.k1.channel")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("c1")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br")])]),t("h2",{attrs:{id:"启动flume"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动flume"}},[s._v("#")]),s._v(" 启动flume")]),s._v(" "),t("p",[s._v("查看Flume使用命令")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("flume-ng "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("help")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("Usage: /opt/soft/apache-flume-1.9.0-bin/bin/flume-ng "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("command"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("options"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\ncommands:\n  "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("help")]),s._v("                      display this "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("help")]),s._v(" text\n  agent                     run a Flume agent\n  avro-client               run an avro Flume client\n  version                   show Flume version info\n\nglobal options:\n  --conf,-c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("conf"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("          use configs "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("conf"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" directory\n  --classpath,-C "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("cp"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("       append to the classpath\n  --dryrun,-d               "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" not actually start Flume, just print the "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v("\n  --plugins-path "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("dirs"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("     colon-separated list of plugins.d directories. See the\n                            plugins.d section "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the user guide "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v(" details.\n                            Default: "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$FLUME_HOME")]),s._v("/plugins.d\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Dproperty")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("value          sets a Java system property value\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Xproperty")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("value          sets a Java "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-X")]),s._v(" option\n\nagent options:\n  --name,-n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("          the name of this agent "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("required"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  --conf-file,-f "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("file"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("     specify a config "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("required "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-z")]),s._v(" missing"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  --zkConnString,-z "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("str"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   specify the ZooKeeper connection to use "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("required "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" missing"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  --zkBasePath,-p "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("path"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("    specify the base path "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" ZooKeeper "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" agent configs\n  --no-reload-conf          "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" not reload config "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" changed\n  --help,-h                 display "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("help")]),s._v(" text\n\navro-client options:\n  --rpcProps,-P "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("file"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   RPC client properties "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" with server connection params\n  --host,-H "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("host"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("hostname")]),s._v(" to "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("which")]),s._v(" events will be sent\n  --port,-p "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("       port of the avro "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--dirname")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("dir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        directory to stream to avro "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v("\n  --filename,-F "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("file"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   text "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" to stream to avro "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default: std input"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  --headerFile,-R "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("file"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" File containing event headers as key/value pairs on each new line\n  --help,-h              display "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("help")]),s._v(" text\n\n  Either "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--rpcProps")]),s._v(" or both "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--host")]),s._v(" and "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--port")]),s._v(" must be specified.\n\nNote that "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("conf"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" directory is specified, "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v(" it is always included first\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the classpath.\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br")])]),t("p",[s._v("启动agent")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("flume-ng agent "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--conf")]),s._v(" conf --conf-file conf/example.conf "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" a1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Dflume.root.logger")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("INFO,console\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("或者")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("flume-ng agent "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" a1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" conf "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" example.conf "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Dflume.root.logger")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("INFO,console\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706049.png",alt:"image-20200110174336210"}})]),s._v(" "),t("h2",{attrs:{id:"使用netcat测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用netcat测试"}},[s._v("#")]),s._v(" 使用Netcat测试")]),s._v(" "),t("p",[s._v("从另一个终端启动Netcat连接到44444端口，发送一些字符串")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nc")]),s._v(" localhost "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("44444")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706050.png",alt:"image-20200323153910638"}})]),s._v(" "),t("p",[s._v("观察agent控制台")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706051.png",alt:"image-20200323154036797"}})]),s._v(" "),t("p",[s._v("从这里可以看到事件由头部和字节数组组成。")]),s._v(" "),t("p",[s._v("在另外一台虚拟机通过Netcat连接，需要更改配置文件")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将绑定端口配置为IP地址，绑定为localhost或者127.0.0.1在另外一台机器上无法连接")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 绑定指定ip不行，绑定0.0.0.0可以")]),s._v("\na1.sources.r1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" netcat\na1.sources.r1.bind "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".85.132\na1.sources.r1.port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("44444")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("如果开启了防火墙，需要添加防火墙规则")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("firewall-cmd "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--zone")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("public --add-port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("44444")]),s._v("/tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--permanent")]),s._v("\nfirewall-cmd "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--reload")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"使用telnet测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用telnet测试"}},[s._v("#")]),s._v(" 使用telnet测试")]),s._v(" "),t("p",[s._v("如果没有安装telnet，检查源")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("yum list "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" telnet\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706052.png",alt:"image-20200110173530605"}})]),s._v(" "),t("p",[s._v("安装telnet")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" telnet.x86_64\nyum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" telnet-server.x86_64\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("启动telnet")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("telnet "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("44444")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("在控制台输入内容")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706053.png",alt:"image-20200110174126132"}})]),s._v(" "),t("p",[s._v("可以在flume窗口查看到消息")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706054.png",alt:"image-20200110174514218"}})]),s._v(" "),t("h1",{attrs:{id:"数据持久化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据持久化"}},[s._v("#")]),s._v(" 数据持久化")]),s._v(" "),t("p",[s._v("使用组件")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#file-channel",target:"_blank",rel:"noopener noreferrer"}},[s._v("File Channel"),t("OutboundLink")],1)])]),s._v(" "),t("p",[s._v("属性设置")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"left"}},[s._v("属性名")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("默认值")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("说明")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("type")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("–")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("file")])])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("checkpointDir")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("~/.flume/file-channel/checkpoint")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("检查点文件存放路径")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("dataDirs")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("~/.flume/file-channel/data")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("日志存储路径，多个路径使用逗号分隔. 使用不同的磁盘上的多个路径能提高file channel的性能")])])])]),s._v(" "),t("p",[s._v("添加配置文件file-channel.conf，添加一个FileChannel")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义agent名称为a1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置3个组件的名称")]),s._v("\na1.sources "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r1\na1.sinks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 多个channel使用空格分隔")]),s._v("\na1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1 c2\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置source类型为NetCat,监听地址为本机，端口为44444")]),s._v("\na1.sources.r1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" netcat\na1.sources.r1.bind "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" localhost\na1.sources.r1.port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("44444")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置sink类型为Logger")]),s._v("\na1.sinks.k1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" logger\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送给sink的Events数量最大为100")]),s._v("\na1.channels.c1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na1.channels.c1.capacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na1.channels.c1.transactionCapacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置FileChannel,checkpointDir为检查点文件存储目录，dataDirs为日志数据存储目录，")]),s._v("\na1.channels.c2.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("\na1.channels.c2.checkpointDir "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /opt/soft/flume/checkpoint\na1.channels.c2.dataDirs "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /opt/soft/flume/data\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将source和sink绑定到channel上")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# source同时绑定到c1和c2上")]),s._v("\na1.sources.r1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1 c2\na1.sinks.k1.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br")])]),t("p",[s._v("为了方便日志打印，可以将"),t("code",[s._v("-Dflume.root.logger=INFO,console")]),s._v("添加在conf的环境配置中，从模板复制一份配置")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" flume-env.sh.template flume-env.sh\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" flume-env.sh\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加JAVA_OPTS")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_OPTS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-Dflume.root.logger=INFO,console"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("启动Flume")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("flume-ng agent "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" a1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" ./ "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" file-channnel.conf\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("通过Netcat发送数据，，此时发送到c2的数据没有被消费，关闭Flume，修改配置文件")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将sink绑定到c2上")]),s._v("\na1.sinks.k1.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c2\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("重启Flume，可以看到会"),t("strong",[s._v("重新消费c2的数据")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706055.png",alt:"image-20200323164045854"}})]),s._v(" "),t("h1",{attrs:{id:"日志文件监控"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#日志文件监控"}},[s._v("#")]),s._v(" 日志文件监控")]),s._v(" "),t("h2",{attrs:{id:"案例说明-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#案例说明-2"}},[s._v("#")]),s._v(" 案例说明")]),s._v(" "),t("p",[s._v("企业中应用程序部署后会将日志写入到文件中，可以使用Flume从各个"),t("strong",[s._v("日志文件")]),s._v("将日志收集到日志中心以便于查找和分析。")]),s._v(" "),t("h2",{attrs:{id:"使用exec-soucre"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用exec-soucre"}},[s._v("#")]),s._v(" 使用Exec Soucre")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#exec-source",target:"_blank",rel:"noopener noreferrer"}},[s._v("Exec Source"),t("OutboundLink")],1)])]),s._v(" "),t("p",[s._v("Exec Source通过指定命令监控文件的变化，加粗属性为必须设置的。")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"left"}},[s._v("属性名")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("默认值")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("说明")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("channels")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("–")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}})]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("type")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("–")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("exec")])])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("command")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("–")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("要执行的命令")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("restart")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("false")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("如果执行命令挂了是否要重启")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("batchSize")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("20")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("同时往channel发送的最大行数")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("batchTimeout")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("3000")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("批量发送超时时间")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("selector.type")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("replicating")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("channel选择器replicating 或者 multiplexing")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("selector.*")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}}),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("通道选择器匹配属性")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("interceptors")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("–")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("拦截器")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("interceptors.*")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}}),s._v(" "),t("td",{staticStyle:{"text-align":"left"}})])])]),s._v(" "),t("p",[s._v("添加配置文件exec-log.conf")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义agent名称为a1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置3个组件的名称")]),s._v("\na1.sources "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r1\na1.sinks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1\na1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置source类型为exec,命令为 tail -F app.log")]),s._v("\na1.sources.r1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v("\na1.sources.r1.command "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-F")]),s._v(" app.log  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 目前放在同路径下")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置sink类型为Logger")]),s._v("\na1.sinks.k1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" logger\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送给sink的Events数量最大为100")]),s._v("\na1.channels.c1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na1.channels.c1.capacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na1.channels.c1.transactionCapacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将source和sink绑定到channel上")]),s._v("\na1.sources.r1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\na1.sinks.k1.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("p",[s._v("启动Flume")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("flume-ng agent "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" a1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" ./ "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" exec-log.conf "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Dflume.root.logger")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("INFO,console\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("通过命令更新app.log文件")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"abcdef"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" app.log\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("可以查看agent控制台接收到了最新的日志")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706056.png",alt:"image-20200323184443240"}})]),s._v(" "),t("p",[s._v("存在问题：重启Flume，会重复消费")]),s._v(" "),t("h2",{attrs:{id:"解决重复消费问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#解决重复消费问题"}},[s._v("#")]),s._v(" "),t("strong",[s._v("解决重复消费问题")])]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#taildir-source",target:"_blank",rel:"noopener noreferrer"}},[s._v("Taildir Source"),t("OutboundLink")],1),s._v("（Apache Flume 1.7.0之后才有的）")])]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"left"}},[s._v("属性名")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("默认值")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("说明")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("channels")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("–")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}})]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("type")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("–")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("TAILDIR")]),s._v(".")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("filegroups")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("–")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("可以定义多个组. 每个组里包含一序列被监控的文件")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("**filegroups.<filegroupName>**")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("–")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("被监控文件的"),t("strong",[s._v("绝对路径")]),s._v("，文件名支持正则表达式")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("positionFile")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("~/.flume/taildir_position.json")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("记录监控文件的绝对路径、上次读取位置的json文件")])])])]),s._v(" "),t("p",[s._v("新增dir-log.conf")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义agent名称为a1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置3个组件的名称")]),s._v("\na1.sources "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r1\na1.sinks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1\na1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置source类型为TAILDIR")]),s._v("\na1.sources.r1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" TAILDIR\na1.sources.r1.positionFile "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /opt/soft/flume/position.json\na1.sources.r1.filegroups "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" f1 f2\na1.sources.r1.filegroups.f1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /opt/soft/apache-flume-1.9.0-bin/conf/app.log\na1.sources.r1.filegroups.f2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /opt/soft/apache-flume-1.9.0-bin/conf/applogs/.*log\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置sink类型为Logger")]),s._v("\na1.sinks.k1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" logger\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送给sink的Events数量最大为100")]),s._v("\na1.channels.c1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na1.channels.c1.capacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na1.channels.c1.transactionCapacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将source和sink绑定到channel上")]),s._v("\na1.sources.r1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\na1.sinks.k1.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("p",[s._v("启动Flume（消费了"),t("code",[s._v("app.log")]),s._v("中的数据）")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("flume-ng agent "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" a1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" ./ "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" dir-log.conf\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("查看"),t("code",[s._v("position.json")]),s._v("文件，"),t("code",[s._v('"pos":28')])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706057.png",alt:"image-20250107170236134"}})]),s._v(" "),t("p",[s._v("通过命令更新app.log文件")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"123"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" app.log\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("此时查看"),t("code",[s._v("position.json")]),s._v("文件，"),t("code",[s._v('"pos":32')])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071711222.png",alt:"image-20250107171105143"}})]),s._v(" "),t("p",[s._v("停掉重启Flume，发现没有出现重复消费问题，可再次通过命令更新app.log文件验证")]),s._v(" "),t("p",[s._v("重复消费问题解决是因为这个position.json文件记录了被监控文件最后读取的位置")]),s._v(" "),t("p",[t("strong",[s._v("同时Taildir Source还支持目录的监控")])]),s._v(" "),t("p",[s._v("在applogs目录中新建一个文件")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071719449.png",alt:"image-20250107171933366"}})]),s._v(" "),t("p",[s._v("Flume会话已经监控到这个文件的创建了")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071722017.png",alt:"image-20250107172241980"}})]),s._v(" "),t("p",[s._v("通过命令更新1.log文件")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"12345"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".log\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("查看position.json文件")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071727368.png",alt:"image-20250107172732288"}})]),s._v(" "),t("p",[s._v("新建2.log文件")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108134554126.png",alt:"image-20250108134554126"}})]),s._v(" "),t("p",[s._v("此时Flume会监控到2.log文件的创建")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108135432383.png",alt:"image-20250108135432383"}})]),s._v(" "),t("p",[s._v("通过命令更新2.log文件")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"123"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".log\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("此时Flume")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108135121342.png",alt:"image-20250108135121342"}})]),s._v(" "),t("p",[s._v("此时position.json文件")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108135815260.png",alt:"image-20250108135815260"}})]),s._v(" "),t("h1",{attrs:{id:"多个agent模型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#多个agent模型"}},[s._v("#")]),s._v(" 多个agent模型")]),s._v(" "),t("p",[s._v("可以将多个Flume agent 程序连接在一起，其中一个agent的sink将数据发送到另一个agent的source。Avro文件格式是使用Flume通过网络发送数据的标准方法。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706058.png",alt:"image-20200324142535996"}})]),s._v(" "),t("p",[s._v("从多个Web服务器收集日志，发送到一个或多个集中处理的agent，之后再发往日志存储中心：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706059.png",alt:"image-20200324151344310"}})]),s._v(" "),t("p",[s._v("同样的日志发送到不同的目的地：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706060.png",alt:"image-20200324151408108"}})]),s._v(" "),t("p",[s._v("将前面两个示例组合应用")]),s._v(" "),t("p",[s._v("第一个agent从Netcat接收数据，增加一个channel和sink，将这个sink发送到第二个agent")]),s._v(" "),t("p",[s._v("第二个agent在监控文件变化的同时监控从sink发送来的事件，最终输出到控制台")]),s._v(" "),t("p",[s._v("使用Avro Sink，必须设置以下属性")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"left"}},[s._v("属性名")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("默认值")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("Description")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("channel")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("–")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}})]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("type")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("–")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("avro")])])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("hostname")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("–")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("绑定的主机名或者IP地址")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("port")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("–")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("监听端口")])])])]),s._v(" "),t("p",[s._v("使用Avro Source，必须设置以下属性")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"left"}},[s._v("属性名")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("默认值")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("说明")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("channels")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("–")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}})]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("type")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("–")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("avro")])])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("bind")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("–")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("绑定的主机名或者IP地址")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("port")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("–")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("监听端口")])])])]),s._v(" "),t("p",[s._v("添加agent1.conf配置文件（拷贝example.conf并修改）（agent1发送agent2）")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# agent.conf1:多个agent使用")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义agent名称为a1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置3个组件的名称，配置两个sink，两个channel")]),s._v("\na1.sources "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r1\na1.sinks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1 k2\na1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1 c2\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置source类型为NetCat，监听地址为本机，端口为44444")]),s._v("\na1.sources.r1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" netcat\na1.sources.r1.bind "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" localhost\na1.sources.r1.port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("44444")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置sink类型为Logger")]),s._v("\na1.sinks.k1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" logger\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置sink类型为Avro")]),s._v("\na1.sinks.k2.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\na1.sinks.k2.hostname "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" localhost\na1.sinks.k2.port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("55555")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送>给sink的Events数量最大为100")]),s._v("\na1.channels.c1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na1.channels.c1.capacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na1.channels.c1.transactionCapacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置第二个channel")]),s._v("\na1.channels.c2.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na1.channels.c2.capacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na1.channels.c2.transactionCapacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将source和sink绑定到channel上，c1和c2通道")]),s._v("\na1.sources.r1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1 c2\na1.sinks.k1.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sink绑定到c2")]),s._v("\na1.sinks.k2.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c2\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br")])]),t("p",[s._v("添加agent2.conf配置文件（拷贝dir-log.conf并修改）")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义agent名称为a1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置3个组件的名称，添加r2，r1用来监控日志文件，r2用来读取agent1中的sink")]),s._v("\na1.sources "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r1 r2\na1.sinks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1\na1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置source类型为TAILDIR")]),s._v("\na1.sources.r1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" TAILDIR\na1.sources.r1.positionFile "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /opt/soft/flume/position.json\na1.sources.r1.filegroups "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" f1 f2\na1.sources.r1.filegroups.f1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /opt/soft/apache-flume-1.9.0-bin/conf/app.log\na1.sources.r1.filegroups.f2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /opt/soft/apache-flume-1.9.0-bin/conf/applogs/.*log\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置source为agent1的sink")]),s._v("\na1.sources.r2.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\na1.sources.r2.bind "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" localhost\na1.sources.r2.port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("55555")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置sink类型为Logger")]),s._v("\na1.sinks.k1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" logger\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送给sink的Events数量最大为100")]),s._v("\na1.channels.c1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na1.channels.c1.capacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na1.channels.c1.transactionCapacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将source和sink绑定到channel上")]),s._v("\na1.sources.r1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\na1.sinks.k1.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将source r2 也绑定到 channel c1 上")]),s._v("\na1.sources.r2.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br")])]),t("p",[s._v("先启动agent2再启动agent1（可以先读）")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("flume-ng agent "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" a1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" ./ "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" agent2.conf\nflume-ng agent "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" a1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" ./ "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" agent1.conf\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("启动agent2")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108140448412.png",alt:"image-20250108140448412"}})]),s._v(" "),t("p",[s._v("再启动agent1")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108140549152.png",alt:"image-20250108140549152"}})]),s._v(" "),t("p",[s._v("此时agent2，显示已连接指定ip和端口")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108140635411.png",alt:"image-20250108140635411"}})]),s._v(" "),t("p",[s._v("先往app.log中写入日志，可以在agent2看到最新数据")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108140902196.png",alt:"image-20250108140902196"}})]),s._v(" "),t("p",[s._v("打开Netcat连接到44444，发送数据，可以同时在agent1和agent2看到最新数据。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108141055489.png",alt:"image-20250108141055489"}})]),s._v(" "),t("p",[s._v("agent1")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108141227550.png",alt:"image-20250108141227550"}})]),s._v(" "),t("p",[s._v("agent2")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108141138110.png",alt:"image-20250108141138110"}})]),s._v(" "),t("h1",{attrs:{id:"拦截器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#拦截器"}},[s._v("#")]),s._v(" 拦截器")]),s._v(" "),t("p",[s._v("拦截器可以"),t("strong",[s._v("修改或者丢弃")]),s._v("事件，Flume支持链式调用拦截器，拦截器定义在source中")]),s._v(" "),t("h2",{attrs:{id:"host-interceptor"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#host-interceptor"}},[s._v("#")]),s._v(" Host Interceptor")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#host-interceptor",target:"_blank",rel:"noopener noreferrer"}},[s._v("Host Interceptor"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("这个拦截器将运行agent的hostname 或者 IP地址写入到事件的headers中")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"left"}},[s._v("属性名")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("默认值")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("说明")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("type")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("–")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("host")])])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("preserveExisting")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("false")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("如果header已经存在host, 是否要保留 - true保留原始的，false写入当前机器")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("useIP")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("true")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("true为IP地址, false为 hostname.")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("hostHeader")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("host")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("header中key的名称")])])])]),s._v(" "),t("p",[s._v("添加agent3.conf（拷贝agent1.conf并修改），拦截器是添加在sources上面的（示范拦截器的配置）agent3发送到agent2")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义agent名称为a1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置3个组件的名称，配置两个sink，两个channel")]),s._v("\na1.sources "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r1\na1.sinks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1 k2\na1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1 c2\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置source类型为NetCat，监听地址为本机，端口为44444")]),s._v("\na1.sources.r1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" netcat\na1.sources.r1.bind "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" localhost\na1.sources.r1.port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("44444")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加拦截器")]),s._v("\na1.sources.r1.interceptors "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" i1\nal.sources.r1.interceptors.i1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置sink类型为Logger")]),s._v("\na1.sinks.k1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" logger\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置sink类型为Avro")]),s._v("\na1.sinks.k2.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\na1.sinks.k2.hostname "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" localhost\na1.sinks.k2.port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("55555")]),s._v(" \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送给sink的Events数量最大为100")]),s._v("\na1.channels.c1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na1.channels.c1.capacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na1.channels.c1.transactionCapacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置第二个channel")]),s._v("\na1.channels.c2.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na1.channels.c2.capacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na1.channels.c2.transactionCapacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将source和sink绑定到channel上，c1和c2通道")]),s._v("\na1.sources.r1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1 c2\na1.sinks.k1.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1 \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sink绑定到c2")]),s._v("\na1.sinks.k2.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c2\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br")])]),t("p",[s._v("启动agent3（启动之前先启动agent2，因为要发送到agent2）")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("flume-ng agent "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" a1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" ./ "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" agent2.conf\nflume-ng agent "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" a1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" ./ "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" agent3.conf\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("可以在agent2控制台看到agent3已经连接成功")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108143000294.png",alt:"image-20250108143000294"}})]),s._v(" "),t("p",[s._v("打开Netcat连接到44444，发送数据")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108143655837.png",alt:"image-20250108143655837"}})]),s._v(" "),t("p",[s._v("agent3和agent2都能看到如下：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108143616742.png",alt:"image-20250108143616742"}})]),s._v(" "),t("p",[t("strong",[s._v("同时可以使用另一台虚拟机来测试")])]),s._v(" "),t("p",[s._v("打开另外一台虚拟机，安装好Flume（虚拟机192.168.88.131）（131连130）")]),s._v(" "),t("p",[s._v("添加agent_example.conf，将数据发送到虚拟机130（agent2）上（拷贝agent3.conf并修改，相当于上述agent3连agent2）")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义agent名称为a1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置3个组件的名称，配置两个sink，两个channel")]),s._v("\na1.sources "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r1\na1.sinks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1 k2\na1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1 c2\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置source类型为NetCat，监听地址为本机(132)，端口为44444")]),s._v("\na1.sources.r1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" netcat\na1.sources.r1.bind "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" localhost\na1.sources.r1.port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("44444")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加拦截器")]),s._v("\na1.sources.r1.interceptors "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" i1\nal.sources.r1.interceptors.i1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置sink类型为Logger")]),s._v("\na1.sinks.k1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" logger\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置sink类型为Avro")]),s._v("\na1.sinks.k2.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\na1.sinks.k2.hostname "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".88.130\na1.sinks.k2.port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("55555")]),s._v(" \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送给sink的Events数量最大为100")]),s._v("\na1.channels.c1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na1.channels.c1.capacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na1.channels.c1.transactionCapacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置第二个channel")]),s._v("\na1.channels.c2.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na1.channels.c2.capacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na1.channels.c2.transactionCapacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将source和sink绑定到channel上，c1和c2通道")]),s._v("\na1.sources.r1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1 c2\na1.sinks.k1.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1 \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sink绑定到c2")]),s._v("\na1.sinks.k2.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c2\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br")])]),t("p",[s._v("上述配置就是从131中的Netcat收到数据，通过两个chanel，一个直接打印，一个发送给130虚拟机中（暂时不行）")]),s._v(" "),t("p",[s._v("这里注意需要在130上开启防火墙端口")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("firewall-cmd "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--zone")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("public --add-port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("55555")]),s._v("/tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--permanent")]),s._v("\nfirewall-cmd "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--reload")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("启动example（131上的Flume）（发送给130）")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("flume-ng agent "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" a1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" ./ "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" agent4.conf\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("可以在130的agent2控制台看到example已经连接成功")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20200324153714003.png",alt:"image-20200324153714003"}})]),s._v(" "),t("p",[s._v("在132上通过Netcat发送数据，发送的是132上的example")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nc")]),s._v(" localhost "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("44444")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("而example会发送到135上的agent2，可以在135上agent2上看到添加了headers")]),s._v(" "),t("p",[s._v("因此，使用Host Inteceptor可以把当前主机地址发送过来，从而区分这个日志或者事件从哪个主机发送过来的")]),s._v(" "),t("h2",{attrs:{id:"timestamp-interceptor"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#timestamp-interceptor"}},[s._v("#")]),s._v(" Timestamp Interceptor")]),s._v(" "),t("p",[s._v("这个拦截器将"),t("strong",[s._v("当前时间")]),s._v("写入到事件的headers中")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"left"}},[s._v("属性名")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("默认值")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("说明")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("type")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("–")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("timestamp")])])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("headerName")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("timestamp")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("header中key的名称")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("preserveExisting")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("false")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("If the timestamp already exists, should it be preserved - true or false")])])])]),s._v(" "),t("p",[s._v("再次回到agent3中的配置，修改如下，")]),s._v(" "),t("p",[s._v("再添加一个拦截器（直接拷贝来一个agent4.conf）")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("a1.sources.r1.interceptors "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" i1 i2\na1.sources.r1.interceptors.i1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("\na1.sources.r1.interceptors.i2.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" timestamp\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("启动agent4\nflume-ng agent "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" a1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" ./ "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" agent4.conf\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("此时agent2控制台显示已连接")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108152342166.png",alt:"image-20250108152342166"}})]),s._v(" "),t("p",[s._v("打开Netcat连接到44444，发送数据")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nc")]),s._v(" localhost "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("44444")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108152527595.png",alt:"image-20250108152527595"}})]),s._v(" "),t("p",[s._v("agent4控制台输出"),t("strong",[s._v("timestamp")]),s._v("日期")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108152904610.png",alt:"image-20250108152904610"}})]),s._v(" "),t("h2",{attrs:{id:"static-interceptor"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#static-interceptor"}},[s._v("#")]),s._v(" Static Interceptor")]),s._v(" "),t("p",[s._v("运行用户对所有的事件添加"),t("strong",[s._v("固定的header")])]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"left"}},[s._v("属性名")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("默认值")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("说明")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("type")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("–")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("static")])])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("preserveExisting")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("true")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("If configured header already exists, should it be preserved - true or false")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("key")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("key")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("header 中key名称")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("value")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("value")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("header 中value值")])])])]),s._v(" "),t("p",[s._v("在agent4.conf中修改即可，"),t("strong",[s._v("自定义key value")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("a1.sources.r1.interceptors "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" i1 i2 i3\na1.sources.r1.interceptors.i1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("\na1.sources.r1.interceptors.i2.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" timestamp\na1.sources.r1.interceptors.i3.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" static\na1.sources.r1.interceptors.i3.key "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" datacenter\na1.sources.r1.interceptors.i3.value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" NEW_YORK\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("打开Netcat连接到44444，发送数据")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108154253711.png",alt:"image-20250108154253711"}})]),s._v(" "),t("p",[s._v("agent4控制台输出")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108154633688.png",alt:"image-20250108154633688"}})]),s._v(" "),t("h2",{attrs:{id:"uuid-interceptor"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#uuid-interceptor"}},[s._v("#")]),s._v(" UUID Interceptor")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#uuid-interceptor",target:"_blank",rel:"noopener noreferrer"}},[s._v("UUID Interceptor"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("生成唯一ID")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108160309260.png",alt:"image-20250108160309260"}})]),s._v(" "),t("p",[s._v("在agent4.conf中修改")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("a1.sources.r1.interceptors "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" i1 i2 i3 i4\na1.sources.r1.interceptors.i1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("\na1.sources.r1.interceptors.i2.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" timestamp\na1.sources.r1.interceptors.i3.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" static\na1.sources.r1.interceptors.i3.key "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" datacenter\na1.sources.r1.interceptors.i3.value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" NEW_YORK\na1.sources.r1.interceptors.i4.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" org.apache.flume.sink.solr.morphline.UUIDInterceptor"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$Builder")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("打开Netcat连接到44444，发送数据")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108160000856.png",alt:"image-20250108160000856"}})]),s._v(" "),t("p",[s._v("agent4控制台输出")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108160104769.png",alt:"image-20250108160104769"}})]),s._v(" "),t("h2",{attrs:{id:"search-and-replace-interceptor"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#search-and-replace-interceptor"}},[s._v("#")]),s._v(" Search and Replace Interceptor")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#search-and-replace-interceptor",target:"_blank",rel:"noopener noreferrer"}},[s._v("Search and Replace Interceptor"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("查找并替换")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108160243230.png",alt:"image-20250108160243230"}})]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("a1.sources.r1.interceptors "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" i1 i2 i3 i4 i5\na1.sources.r1.interceptors.i1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("\na1.sources.r1.interceptors.i2.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" timestamp\na1.sources.r1.interceptors.i3.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" static\na1.sources.r1.interceptors.i3.key "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" datacenter\na1.sources.r1.interceptors.i3.value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" NEW_YORK\na1.sources.r1.interceptors.i4.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" org.apache.flume.sink.solr.morphline.UUIDInterceptor"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$Builder")]),s._v("\na1.sources.r1.interceptors.i5.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" search_replace\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 支持正则表达式，查找并替换，例如手机号脱敏操作（中间几位隐藏）")]),s._v("\na1.sources.r1.interceptors.i5.searchPattern "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("d"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\na1.sources.r1.interceptors.i5.replaceString "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ******\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("打开Netcat连接到44444，发送数据")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108160958778.png",alt:"image-20250108160958778"}})]),s._v(" "),t("p",[s._v("agent4控制台输出（并还是headers中，而是消息体里面做了替换）")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250108161153572.png",alt:"image-20250108161153572"}})]),s._v(" "),t("h2",{attrs:{id:"自定义拦截器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#自定义拦截器"}},[s._v("#")]),s._v(" 自定义拦截器")]),s._v(" "),t("p",[s._v("新建工程，添加pom引用")]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.apache.flume"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("flume-ng-core"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("1.9.0"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("添加自定义拦截器")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("flume"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Context")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("flume"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Event")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("flume"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("interceptor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Interceptor")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("util"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MyInterceptor")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Interceptor")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Logger")]),s._v(" logger "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LoggerFactory")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getLogger")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MyInterceptor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("initialize")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n     * 拦截单个事件\n     * @param event\n     * @return\n     */")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Event")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("intercept")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Event")]),s._v(" event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" host "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getHeaders")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"host"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        logger"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"接收到host为："')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("host"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("host"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("equals")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.85.131"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            logger"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"丢弃事件"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Event")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("intercept")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Event")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" list"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Event")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" newList "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayList")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Event")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Event")]),s._v(" event "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" list"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            event "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("intercept")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("event"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                newList"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" newList"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("close")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Builder")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Interceptor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Builder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Interceptor")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("build")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MyInterceptor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("configure")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Context")]),s._v(" context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br")])]),t("p",[s._v("将项目打成jar包后复制到Flume安装目录的lib目录中")]),s._v(" "),t("p",[s._v("修改agent2.conf（因为agent2接收从网络发送过来的数据）")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置拦截器")]),s._v("\na1.sources.r2.interceptors "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" i1\na1.sources.r2.interceptors.i1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" com.itheima.flume.interceptor.MyInterceptor"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$Builder")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("先开启131机器上的agent4")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("flume-ng agent "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" a1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" ./ "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" agent4.conf\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("再开启130机器上的agent2")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("flume-ng agent "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" a1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" ./ "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" agent2.conf\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("此时再从131发送数据过来，可以看到数据被拦截了，拦截后的数据不会进入channel，即不会被sink消费")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706068.png",alt:"image-20200324182058523"}})]),s._v(" "),t("h1",{attrs:{id:"channel选择器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#channel选择器"}},[s._v("#")]),s._v(" Channel选择器")]),s._v(" "),t("h2",{attrs:{id:"replicating-channel-selector"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#replicating-channel-selector"}},[s._v("#")]),s._v(" Replicating Channel Selector")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#replicating-channel-selector-default",target:"_blank",rel:"noopener noreferrer"}},[s._v("复制选择器"),t("OutboundLink")],1),s._v("，如果没有指定，这个为默认选择器")]),s._v(" "),t("p",[s._v("可选属性如下")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"left"}},[s._v("属性名")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("默认值")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("说明")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("selector.type")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("replicating")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("replicating")])])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("selector.optional")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("–")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("optional")])])])])]),s._v(" "),t("p",[s._v("使用案例：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("a1.sources "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r1\na1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1 c2 c3\na1.sources.r1.selector.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" replicating\na1.sources.r1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1 c2 c3\na1.sources.r1.selector.optional "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c3\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("上面的配置中，c3是一个可选的channel，写入c3失败的话会被忽略，")]),s._v(" "),t("p",[s._v("而c1和c2没有标记为可选，如果写入c1和c2失败会导致事务的失败。")]),s._v(" "),t("h2",{attrs:{id:"multiplexing-channel-selector"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#multiplexing-channel-selector"}},[s._v("#")]),s._v(" Multiplexing Channel Selector")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#multiplexing-channel-selector",target:"_blank",rel:"noopener noreferrer"}},[s._v("多路channel选择器"),t("OutboundLink")],1),s._v("，可选属性如下")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"left"}},[s._v("属性名")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("默认值")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("说明")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("selector.type")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("replicating")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("multiplexing")])])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("selector.header")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("flume.selector.header")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("键值Key")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("selector.default")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("–")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}})]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("selector.mapping.*")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("–")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("路由")])])])]),s._v(" "),t("p",[s._v("使用案例：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("a1.sources "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r1\na1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1 c2 c3 c4\na1.sources.r1.selector.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" multiplexing\na1.sources.r1.selector.header "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" state\na1.sources.r1.selector.mapping.CZ "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1 c2\na1.sources.r1.selector.mapping.US "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1 c3\na1.sources.r1.selector.default "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1 c4\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("这里通过事件的header值来判断将事件发送到哪个channel，可以配合拦截器一起使用。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建multichannel目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" multichannel\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" multichannel\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("创建agent5.conf")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义agent名称为a1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置3个组件的名称")]),s._v("\na1.sources "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r1\na1.sinks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1 k2 k3 k4\na1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1 c2 c3 c4\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置source类型为NetCat,监听地址为本机，端口为44444")]),s._v("\na1.sources.r1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" netcat\na1.sources.r1.bind "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" localhost\na1.sources.r1.port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("44444")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置sink1类型为Logger")]),s._v("\na1.sinks.k1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" logger\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置sink2,3,4类型为Avro")]),s._v("\na1.sinks.k2.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\na1.sinks.k2.hostname "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".88.130\na1.sinks.k2.port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4040")]),s._v("\n\na1.sinks.k3.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\na1.sinks.k3.hostname "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".88.130\na1.sinks.k3.port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4041")]),s._v("\n\na1.sinks.k4.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\na1.sinks.k4.hostname "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".88.130\na1.sinks.k4.port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4042")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送给sink的Events数量最大为100")]),s._v("\na1.channels.c1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na1.channels.c1.capacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na1.channels.c1.transactionCapacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n\na1.channels.c2.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na1.channels.c2.capacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na1.channels.c2.transactionCapacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n\na1.channels.c3.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na1.channels.c3.capacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na1.channels.c3.transactionCapacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n\na1.channels.c4.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na1.channels.c4.capacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na1.channels.c4.transactionCapacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将source和sink绑定到channel上")]),s._v("\na1.sources.r1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1 c2 c3 c4\na1.sinks.k1.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\na1.sinks.k2.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c2\na1.sinks.k3.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c3\na1.sinks.k4.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c4\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br")])]),t("p",[s._v("添加agent6.conf")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义agent名称为a2")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置3个组件的名称")]),s._v("\na2.sources "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r1\na2.sinks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1\na2.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置source类型为avro")]),s._v("\na2.sources.r1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\na2.sources.r1.bind "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".88.130\na2.sources.r1.port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4040")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置sink类型为logger")]),s._v("\na2.sinks.k1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" logger\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送给sink的Events数量最大为100")]),s._v("\na2.channels.c1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na2.channels.c1.capacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na2.channels.c1.transactionCapacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将source和sink绑定到channel上")]),s._v("\na2.sources.r1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\na2.sinks.k1.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br")])]),t("p",[s._v("添加agent7.conf")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义agent名称为a3")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置3个组件的名称")]),s._v("\na3.sources "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r1\na3.sinks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1\na3.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置source类型为avro")]),s._v("\na3.sources.r1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\na3.sources.r1.bind "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".88.130\na3.sources.r1.port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4041")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置sink类型为logger")]),s._v("\na3.sinks.k1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" logger\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送给sink的Events数量最大为100")]),s._v("\na3.channels.c1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na3.channels.c1.capacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na3.channels.c1.transactionCapacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将source和sink绑定到channel上")]),s._v("\na3.sources.r1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\na3.sinks.k1.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br")])]),t("p",[s._v("添加agent8.conf")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义agent名称为a4")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置3个组件的名称")]),s._v("\na4.sources "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r1\na4.sinks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1\na4.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置source类型为avro")]),s._v("\na4.sources.r1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\na4.sources.r1.bind "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".88.130\na4.sources.r1.port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4042")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置sink类型为logger")]),s._v("\na4.sinks.k1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" logger\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送给sink的Events数量最大为100")]),s._v("\na4.channels.c1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na4.channels.c1.capacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na4.channels.c1.transactionCapacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将source和sink绑定到channel上")]),s._v("\na4.sources.r1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\na4.sinks.k1.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br")])]),t("p",[s._v("启动agent6、agent7、agent8和agent5")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("flume-ng agent "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" a2 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" ./ "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" agent6.conf\nflume-ng agent "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" a3 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" ./ "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" agent7.conf\nflume-ng agent "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" a4 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" ./ "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" agent8.conf\nflume-ng agent "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" a1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" ./ "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" agent5.conf\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("使用Netcat往agent1发送消息，可以在agent2\\3\\4上看到消息")]),s._v(" "),t("p",[s._v("修改agent5.conf，配置通道选择器")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置拦截器")]),s._v("\na1.sources.r1.interceptors "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" i1\na1.sources.r1.interceptors.i1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" static\na1.sources.r1.interceptors.i1.key "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" state\na1.sources.r1.interceptors.i1.value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" CZ\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置通道选择器，如果匹配不上就走default")]),s._v("\na1.sources.r1.selector.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" multiplexing\na1.sources.r1.selector.header "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" state\na1.sources.r1.selector.mapping.CZ "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1 c2\na1.sources.r1.selector.mapping.US "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1 c3\na1.sources.r1.selector.default "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1 c4\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("运行所有agent，发送数据到agent1，可以看到只有agent2收到了数据，")]),s._v(" "),t("p",[s._v("修改拦截器的值为US，结果是agent3收到数据。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250109194557859.png",alt:"image-20250109194557859"}})]),s._v(" "),t("h1",{attrs:{id:"sink处理器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sink处理器"}},[s._v("#")]),s._v(" Sink处理器")]),s._v(" "),t("p",[s._v("通过sink来消费，如果消费端出现宕机，就会造成消息的积压，可能内存就不够了或者文件很大，那如何出现消息积压问题呢？Sink处理器")]),s._v(" "),t("p",[s._v("可以将多个sink放入到一个组中，Sink处理器能够对一个组中所有的sink进行负载均衡，在一个sink出现临时错误时进行故障转移。")]),s._v(" "),t("p",[s._v("必须设置属性：")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"left"}},[s._v("属性名")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("默认值")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("说明")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("sinks")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("–")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("组中多个sink使用空格分隔")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("processor.type")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("default")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("default")]),s._v(", "),t("code",[s._v("failover")]),s._v(" 或"),t("code",[s._v("load_balance")])])])])]),s._v(" "),t("p",[s._v("举例：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("a1.sinkgroups "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" g1\na1.sinkgroups.g1.sinks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1 k2\na1.sinkgroups.g1.processor.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" failover\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h2",{attrs:{id:"default-sink-processor"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#default-sink-processor"}},[s._v("#")]),s._v(" Default Sink Processor")]),s._v(" "),t("p",[s._v("默认的Sink处理器只支持单个Sink")]),s._v(" "),t("h2",{attrs:{id:"failover-sink-processor"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#failover-sink-processor"}},[s._v("#")]),s._v(" Failover Sink Processor")]),s._v(" "),t("p",[t("strong",[s._v("故障转移处理器")]),s._v("维护了一个带有优先级的sink列表，故障转移机制将失败的sink放入到一个冷却池中，如果sink成功发送了事件，将其放入到活跃池中，sink可以设置优先级，数字越高，优先级越高，如果一个sink发送事件失败，下一个有更高优先级的sink将被用来发送事件，比如，优先级100的比优先级80的先被使用，如果没有设置优先级，按配置文件中配置的顺序决定。设置属性如下：")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"left"}},[s._v("属性名")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("默认值")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("说明")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("sinks")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("–")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("组内多个sinks空格分隔")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("processor.type")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("default")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("failover")])])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("processor.priority.")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("–")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("优先级")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("processor.maxpenalty")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("30000")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("失败sink的最大冷却时间")])])])]),s._v(" "),t("p",[s._v("示例如下：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("a1.sinkgroups "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" g1\na1.sinkgroups.g1.sinks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1 k2\na1.sinkgroups.g1.processor.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" failover\na1.sinkgroups.g1.processor.priority.k1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\na1.sinkgroups.g1.processor.priority.k2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\na1.sinkgroups.g1.processor.maxpenalty "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("修改以上agent5.conf，直接agent9.conf")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义agent名称为a1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置3个组件的名称")]),s._v("\na1.sources "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r1\na1.sinks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1 k2 k3 k4\na1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置source类型为NetCat,监听地址为本机，端口为44444")]),s._v("\na1.sources.r1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" netcat\na1.sources.r1.bind "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" localhost\na1.sources.r1.port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("44444")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置sink组")]),s._v("\na1.sinkgroups "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" g1\na1.sinkgroups.g1.sinks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1 k2 k3 k4\na1.sinkgroups.g1.processor.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" failover\na1.sinkgroups.g1.processor.priority.k1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\na1.sinkgroups.g1.processor.priority.k2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\na1.sinkgroups.g1.processor.priority.k3 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("\na1.sinkgroups.g1.processor.priority.k4 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\na1.sinkgroups.g1.processor.maxpenalty "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置sink1类型为Logger")]),s._v("\na1.sinks.k1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" logger\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置sink2,3,4类型为Avro")]),s._v("\na1.sinks.k2.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\na1.sinks.k2.hostname "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".88.130\na1.sinks.k2.port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4040")]),s._v("\n\na1.sinks.k3.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\na1.sinks.k3.hostname "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".88.130\na1.sinks.k3.port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4041")]),s._v("\n\na1.sinks.k4.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\na1.sinks.k4.hostname "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".88.130\na1.sinks.k4.port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4042")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送给sink的Events数量最大为100")]),s._v("\na1.channels.c1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na1.channels.c1.capacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na1.channels.c1.transactionCapacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将source和sink绑定到channel上")]),s._v("\na1.sources.r1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\na1.sinks.k1.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\na1.sinks.k2.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\na1.sinks.k3.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\na1.sinks.k4.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br")])]),t("p",[s._v("启动agent6\\7\\8和agent9，通过Netcat发送消息到agent9，可以看到消息一直发送给其中一个agent（agent8优先级最高），将这个agent关闭后，消息会发送到其他agent（优先级次高）。")]),s._v(" "),t("h2",{attrs:{id:"load-balancing-sink-processor"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#load-balancing-sink-processor"}},[s._v("#")]),s._v(" Load balancing Sink Processor")]),s._v(" "),t("p",[t("strong",[s._v("负载均衡处理器")]),s._v("，可以通过"),t("strong",[s._v("轮询或者随机")]),s._v("的方式进行负载均衡，也可以通过继承AbstractSinkSelector 自定义负载均衡，设置属性如下：")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"left"}},[s._v("属性名")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("默认值")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("说明")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("processor.sinks")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("–")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("组内多个sinks空格分隔")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("processor.type")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("default")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("load_balance")])])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("processor.backoff")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("false")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("是否将失败的sink加入黑名单")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("processor.selector")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("round_robin")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("轮询机制:"),t("code",[s._v("round_robin")]),s._v(", "),t("code",[s._v("random")]),s._v(" 或者自定义")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("processor.selector.maxTimeOut")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("30000")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("黑名单有效时间（单位毫秒）")])])])]),s._v(" "),t("p",[s._v("示例如下：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("a1.sinkgroups "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" g1\na1.sinkgroups.g1.sinks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1 k2\na1.sinkgroups.g1.processor.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" load_balance\na1.sinkgroups.g1.processor.backoff "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\na1.sinkgroups.g1.processor.selector "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" round_robin\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("修改上面的agent9.conf，直接agent10.conf，将所有的sink都绑定到c1上")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义agent名称为a1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置3个组件的名称")]),s._v("\na1.sources "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r1\na1.sinks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1 k2 k3 k4\na1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置source类型为NetCat,监听地址为本机，端口为44444")]),s._v("\na1.sources.r1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" netcat\na1.sources.r1.bind "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" localhost\na1.sources.r1.port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("44444")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置sink组")]),s._v("\na1.sinkgroups "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" g1\na1.sinkgroups.g1.sinks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1 k2 k3 k4\na1.sinkgroups.g1.processor.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" load_balance\na1.sinkgroups.g1.processor.backoff "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\na1.sinkgroups.g1.processor.selector "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" round_robin\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置sink1类型为Logger")]),s._v("\na1.sinks.k1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" logger\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置sink2,3,4类型为Avro")]),s._v("\na1.sinks.k2.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\na1.sinks.k2.hostname "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".88.130\na1.sinks.k2.port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4040")]),s._v("\n\na1.sinks.k3.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\na1.sinks.k3.hostname "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".88.130\na1.sinks.k3.port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4041")]),s._v("\n\na1.sinks.k4.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\na1.sinks.k4.hostname "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".88.130\na1.sinks.k4.port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4042")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送给sink的Events数量最大为100")]),s._v("\na1.channels.c1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na1.channels.c1.capacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na1.channels.c1.transactionCapacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将source和sink绑定到channel上")]),s._v("\na1.sources.r1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\na1.sinks.k1.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\na1.sinks.k2.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\na1.sinks.k3.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\na1.sinks.k4.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br")])]),t("p",[s._v("也可以修改成随机·"),t("code",[s._v("random")]),s._v("，试下效果")]),s._v(" "),t("h1",{attrs:{id:"使用flume导入数据到hdfs"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用flume导入数据到hdfs"}},[s._v("#")]),s._v(" 使用Flume导入数据到HDFS")]),s._v(" "),t("p",[s._v("在这里安装了hadoop集群，用户名为hadoop")]),s._v(" "),t("p",[s._v("数据导出到HDFS需要使用HDFS Sink，需要配置属性如下：")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"left"}},[s._v("属性名")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("默认值")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("说明")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("channel")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("–")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}})]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("type")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("–")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("hdfs")])])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("hdfs.path")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("–")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("HDFS 文件路径 (例如 hdfs://namenode/flume/webdata/)")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("hdfs.fileType")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("SequenceFile")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("文件格式:  "),t("code",[s._v("SequenceFile")]),s._v(", "),t("code",[s._v("DataStream")]),s._v(" or "),t("code",[s._v("CompressedStream")]),s._v(" (1)DataStream 不会压缩输出文件且不用设置 codeC (2)CompressedStream 需要设置 hdfs.codeC")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("hdfs.codeC")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}}),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("压缩格式 : gzip, bzip2, lzo, lzop, snappy")])])])]),s._v(" "),t("p",[s._v("注：使用HDFS Sink需要用到Hadoop的多个包，可以在装有Hadoop的主机上运行Flume，")]),s._v(" "),t("p",[s._v("如果是单独部署的Flume，可以通过多个Agent的形式将单独部署的Flume Agent 日志数据发送到装有Hadoop的Flume Agent上。")]),s._v(" "),t("p",[s._v("创建hdfs.conf")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# agent名称为a1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置3个组件的名称")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a1.sources")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("r1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a1.sinks")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("k1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a1.channels")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("c1")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置source类型为NetCat,监听地址为本机，端口为44444")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a1.sources.r1.type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("netcat")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a1.sources.r1.bind")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("localhost")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a1.sources.r1.port")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("44444")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置sink类型为hdfs")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a1.sinks.k1.type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("hdfs")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a1.sinks.k1.hdfs.path")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("hdfs://node:8020/user/flume/logs")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a1.sinks.k1.hdfs.fileType")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("DataStream")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送给sink的Events数量最大为100")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a1.channels.c1.type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("memory")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a1.channels.c1.capacity")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("1000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a1.channels.c1.transactionCapacity")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("100")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将source和sink绑定到channel上")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a1.sources.r1.channels")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("c1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a1.sinks.k1.channel")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("c1")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("p",[s._v("启动flume")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("flume-ng agent "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" a1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" ./ "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" hdfs.conf\n\nbin/flume-ng agent "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--conf")]),s._v(" conf/ --conf-file conf/hdfs.conf "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Dfile.root.logger")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("debug,info,console "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" hdfs\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("注：如果出现"),t("code",[s._v("com.google.common.base.Preconditions.checkArgument")]),s._v(" 查看下"),t("code",[s._v("flume/lib")]),s._v("目录下")]),s._v(" "),t("p",[s._v("的"),t("code",[s._v("guava.jar")]),s._v("版本是否与"),t("code",[s._v("hadoop/share/hadoop/common/lib")]),s._v("中的版本是否一致，不一致拷贝新版")]),s._v(" "),t("p",[s._v("重新运行")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250110105658916.png",alt:"image-20250110105658916"}})]),s._v(" "),t("p",[s._v("从另一个终端启动Netcat连接到44444端口，发送一些字符串")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250110105949785.png",alt:"image-20250110105949785"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706069.png",alt:"image-20200112212041558"}})]),s._v(" "),t("p",[s._v("在后台查看")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("hadoop fs "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-cat")]),s._v(" /user/flume/messages/flume-.1578835130630\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706070.png",alt:"image-20200112212150353"}})]),s._v(" "),t("h1",{attrs:{id:"使用多个agent导出数据到hdfs"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用多个agent导出数据到hdfs"}},[s._v("#")]),s._v(" 使用多个Agent导出数据到HDFS")]),s._v(" "),t("p",[s._v("130->131")]),s._v(" "),t("p",[s._v("agent11.conf（130机器上）")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义agent名称为a1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置3个组件的名称")]),s._v("\na1.sources "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r1\na1.sinks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1\na1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置source类型为NetCat，监听地址为本机，端口为44444")]),s._v("\na1.sources.r1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" netcat\na1.sources.r1.bind "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" localhost\na1.sources.r1.port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("44444")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置sink类型为Avro")]),s._v("\na1.sinks.k1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\na1.sinks.k1.hostname "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".88.131\na1.sinks.k1.port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4040")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送给sink的Events数量最大为100")]),s._v("\na1.channels.c1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na1.channels.c1.capacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na1.channels.c1.transactionCapacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将source和sink绑定到channel上")]),s._v("\na1.sources.r1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\na1.sinks.k1.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("p",[s._v("multi-agent.conf（131机器上）")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# agent名称为a1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置3个组件的名称")]),s._v("\na1.sources "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r1\na1.sinks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1\na1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置source类型为avro")]),s._v("\na1.sources.r1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\na1.sources.r1.bind "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".88.131\na1.sources.r1.port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4040")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置sink类型为hdfs")]),s._v("\na1.sinks.k1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hdfs\na1.sinks.k1.hdfs.path "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hdfs://node:8020/user/flume/logs\na1.sinks.k1.hdfs.fileType "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" DataStream\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送")]),s._v("\n给sink的Events数量最大为100\na1.channels.c1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na1.channels.c1.capacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na1.channels.c1.transactionCapacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将source和sink绑定到channel上")]),s._v("\na1.sources.r1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\na1.sinks.k1.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br")])]),t("p",[s._v("启动agent")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("flume-ng agent "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" a1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" ./ "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" multi-agent.conf\n\nflume-ng agent "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" a1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" ./ "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" agent11.conf\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("从130机器另一个终端启动Netcat连接到44444端口，发送一些字符串")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250113114845680.png",alt:"image-20250113114845680"}})]),s._v(" "),t("p",[s._v("在131机器上可以看到")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250113114959939.png",alt:"image-20250113114959939"}})]),s._v(" "),t("p",[s._v("浏览器访问http://node:9870/，点击Utilities中的Browse the file system")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250113115334039.png",alt:"image-20250113115334039"}})]),s._v(" "),t("p",[t("code",[s._v("hadoop")]),s._v("中查看")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250113130802139.png",alt:"image-20250113130802139"}})]),s._v(" "),t("h1",{attrs:{id:"flume-sdk"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#flume-sdk"}},[s._v("#")]),s._v(" Flume SDK")]),s._v(" "),t("h2",{attrs:{id:"自定义source"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#自定义source"}},[s._v("#")]),s._v(" 自定义Source")]),s._v(" "),t("blockquote",[t("p",[s._v("想去哪里获取数据就可以自定义")])]),s._v(" "),t("p",[t("a",{attrs:{href:"https://flume.apache.org/releases/content/1.11.0/FlumeDeveloperGuide.html#source",target:"_blank",rel:"noopener noreferrer"}},[s._v("自定义Source示例"),t("OutboundLink")],1)]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MySource")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AbstractSource")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Configurable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PollableSource")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" myProp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("configure")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Context")]),s._v(" context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" myProp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getString")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"myProp"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"defaultValue"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Process the myProp value (e.g. validation, convert to another type, ...)")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Store myProp for later retrieval by process() method")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("myProp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" myProp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Initialize the connection to the external client")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" stop "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Disconnect from external client and do any additional cleanup")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// (e.g. releasing resources or nulling-out field values) ..")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Status")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("process")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("EventDeliveryException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Status")]),s._v(" status "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// This try clause includes whatever Channel/Event operations you want to do")]),s._v("\n\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Receive new data")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Event")]),s._v(" e "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getSomeData")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Store the Event into this Source's associated Channel(s)")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getChannelProcessor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("processEvent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n      status "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Status")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("READY")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Throwable")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Log exception, handle individual exceptions as needed")]),s._v("\n\n      status "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Status")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("BACKOFF")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// re-throw all Errors")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("instanceof")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Error")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Error")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      txn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("close")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" status"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br")])]),t("p",[s._v("添加MySource")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("example"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("flumedemo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("source")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("flume"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Context")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("flume"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Event")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("flume"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("EventDeliveryException")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("flume"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PollableSource")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("flume"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Configurable")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("flume"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SimpleEvent")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("flume"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("source"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AbstractSource")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n * 自定义Source\n */")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MySource")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AbstractSource")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Configurable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PollableSource")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 处理数据")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Status")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("process")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("EventDeliveryException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Status")]),s._v(" status "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 自己模拟数据来发送")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Event")]),s._v(" event "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SimpleEvent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setBody")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"data:"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBytes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 将数据存储到与Source关联的Channel中")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getChannelProcessor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("processEvent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 数据准备消费")]),s._v("\n                status "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Status")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("READY")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 休眠5秒")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 打印日志")]),s._v("\n            e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("printStackTrace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            status "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Status")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("BACKOFF")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" status"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBackOffSleepIncrement")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getMaxBackOffSleepInterval")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("configure")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Context")]),s._v(" context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br")])]),t("p",[s._v("添加完自定义Source后，然后package打包一下，复制上传到/opt/soft/flume/lib/下")]),s._v(" "),t("p",[s._v("添加mySourceAgent.conf")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义agent名称为a1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置3个组件的名称")]),s._v("\na1.sources "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r1\na1.sinks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1\na1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置source类型为mysource")]),s._v("\na1.sources.r1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" org.example.flumedemo.source.MySource\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置sink类型为Logger")]),s._v("\na1.sinks.k1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" logger\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送给sink的Events数量最大为100")]),s._v("\na1.channels.c1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na1.channels.c1.capacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na1.channels.c1.transactionCapacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将source和sink绑定到channel上")]),s._v("\na1.sources.r1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\na1.sinks.k1.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("p",[s._v("启动Flume")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("flume-ng agent "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" a1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" ./ "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" mySourceAgent.conf\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("输出结果")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250113140244503.png",alt:"image-20250113140244503"}})]),s._v(" "),t("h2",{attrs:{id:"自定义sink"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#自定义sink"}},[s._v("#")]),s._v(" 自定义Sink")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://flume.apache.org/releases/content/1.11.0/FlumeDeveloperGuide.html#sink",target:"_blank",rel:"noopener noreferrer"}},[s._v("自定义Sinkf示例"),t("OutboundLink")],1)]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MySink")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AbstractSink")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Configurable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" myProp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("configure")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Context")]),s._v(" context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" myProp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getString")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"myProp"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"defaultValue"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Process the myProp value (e.g. validation)")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Store myProp for later retrieval by process() method")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("myProp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" myProp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Initialize the connection to the external repository (e.g. HDFS) that")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// this Sink will forward Events to ..")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" stop "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Disconnect from the external respository and do any")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// additional cleanup (e.g. releasing resources or nulling-out")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// field values) ..")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Status")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("process")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("EventDeliveryException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Status")]),s._v(" status "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Start transaction")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Channel")]),s._v(" ch "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getChannel")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Transaction")]),s._v(" txn "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ch"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getTransaction")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    txn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("begin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// This try clause includes whatever Channel operations you want to do")]),s._v("\n\n      "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Event")]),s._v(" event "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ch"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("take")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Send the Event to the external repository.")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// storeSomeData(e);")]),s._v("\n\n      txn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("commit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      status "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Status")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("READY")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Throwable")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      txn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rollback")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Log exception, handle individual exceptions as needed")]),s._v("\n\n      status "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Status")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("BACKOFF")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// re-throw all Errors")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("instanceof")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Error")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Error")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" status"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br")])]),t("p",[s._v("添加MySink，可以参考LoggerSink")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("example"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("flumedemo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sink")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("flume"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("flume"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Configurable")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("flume"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sink"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AbstractSink")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("slf4j"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Logger")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("slf4j"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LoggerFactory")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MySink")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AbstractSink")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Configurable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Logger")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("LOGGER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LoggerFactory")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getLogger")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MySink")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 处理数据")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Status")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("process")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("EventDeliveryException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Status")]),s._v(" status "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 获取跟Sink绑定的Channel")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Channel")]),s._v(" ch "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getChannel")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 获取事务")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Transaction")]),s._v(" transaction "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ch"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getTransaction")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 开启事务")]),s._v("\n            transaction"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("begin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 从channel中接收数据")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Event")]),s._v(" event "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ch"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("take")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("event "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                status "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Status")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("BACKOFF")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 可以将数据发送到外部存储")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// storeSomeData(e);")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 模拟实现LoggerSink的功能")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("LOGGER")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBody")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                status "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Status")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("READY")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//提交事务")]),s._v("\n            transaction"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("commit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 事务回滚")]),s._v("\n            transaction"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rollback")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 打印异常")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("LOGGER")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("error")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getMessage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 返回失败状态")]),s._v("\n            status "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Status")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("BACKOFF")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 关闭事务")]),s._v("\n            transaction"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("close")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" status"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("configure")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Context")]),s._v(" context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br")])]),t("p",[s._v("重新package打包，上传到opt/soft/flume/lib/")]),s._v(" "),t("p",[s._v("修改上面的mySourceAgent.conf")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义agent名称为a1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置3个组件的名称")]),s._v("\na1.sources "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r1\na1.sinks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1\na1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置source类型为mysource")]),s._v("\na1.sources.r1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" com.itheima.flume.source.MySource\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置sink类型为MySink")]),s._v("\na1.sinks.k1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" com.itheima.flume.sink.MySink\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送给sink的Events数量最大为100")]),s._v("\na1.channels.c1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na1.channels.c1.capacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na1.channels.c1.transactionCapacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将source和sink绑定到channel上")]),s._v("\na1.sources.r1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\na1.sinks.k1.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("p",[s._v("启动Flume")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("flume-ng agent "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" a1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" ./ "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" mySourceAgent.conf\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("输出结果（相当于自己实现logger）")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/image-20250113143840898.png",alt:"image-20250113143840898"}})]),s._v(" "),t("h1",{attrs:{id:"flume监控"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#flume监控"}},[s._v("#")]),s._v(" Flume监控")]),s._v(" "),t("p",[s._v("Ganglia是UC Berkeley发起的一个开源集群监视项目，设计用于测量数以千计的节点。")]),s._v(" "),t("p",[s._v("Ganglia的核心包含"),t("strong",[s._v("gmond（监控守护进程）、gmetad（元数据守护进程）以及一个Web前端。")])]),s._v(" "),t("p",[s._v("主要是用来"),t("strong",[s._v("监控系统性能")]),s._v("，如：cpu 、mem、硬盘利用率， I/O负载、网络流量情况等，通过曲线很容易见到每个节点的工作状态，对合理调整、分配系统资源，提高系统整体性能起到重要作用。")]),s._v(" "),t("h2",{attrs:{id:"ganglia安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ganglia安装"}},[s._v("#")]),s._v(" Ganglia安装")]),s._v(" "),t("p",[s._v("**中心节点的安装 **")]),s._v(" "),t("ul",[t("li",[s._v("epel包的安装：yum install -y epel-release(解决不能yum安装某些安装包的问题)")]),s._v(" "),t("li",[s._v("gmetad的安装：yum install -y ganglia-gmetad")]),s._v(" "),t("li",[s._v("gmond的安装：yum install -y ganglia-gmond（监控守护进程会使用到下面的工具rrdtool）")]),s._v(" "),t("li",[s._v("rrdtool的安装：yum install -y rrdtool")]),s._v(" "),t("li",[s._v("httpd服务器的安装：yum install -y httpd（Web前端需要部署在httpd上）")]),s._v(" "),t("li",[s._v("ganglia-web及php安装：yum install -y ganglia-web php（ganglia前端是php写的）")])]),s._v(" "),t("p",[t("strong",[s._v("被监测节点的安装")])]),s._v(" "),t("ul",[t("li",[s._v("epel包的安装：yum install -y epel-release(解决不能yum安装某些安装包的问题)")]),s._v(" "),t("li",[s._v("gmond的安装：yum install -y gmond(提示找不到，感觉应该换成上面那个yum install -y ganglia-gmond)")])]),s._v(" "),t("h2",{attrs:{id:"ganglia配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ganglia配置"}},[s._v("#")]),s._v(" Ganglia配置")]),s._v(" "),t("p",[t("strong",[s._v("中心节点的配置")]),s._v("\n安装目录说明")]),s._v(" "),t("ul",[t("li",[s._v("ganglia配置文件目录：/etc/ganglia")]),s._v(" "),t("li",[s._v("rrd数据库存放目录：/var/lib/ganglia/rrds")]),s._v(" "),t("li",[s._v("ganglia-web安装目录：/usr/share/ganglia")]),s._v(" "),t("li",[s._v("ganglia-web配置目录：/etc/httpd/conf.d/ganglia.conf")])]),s._v(" "),t("p",[s._v("相关配置文件修改\n将ganglia-web的站点目录连接到httpd主站点目录")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 把 /usr/share/ganglia 链接到 /var/www/html/ 下，默认以ganglia命令")]),s._v("\n$  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" /usr/share/ganglia /var/www/html\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("修改httpd主站点目录下ganglia站点目录的访问权限\n将ganglia站点目录访问权限改为apache:apache，否则会报错")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-R")]),s._v(" apache:apache /var/www/html/ganglia\n$  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-R")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("755")]),s._v(" /var/www/html/ganglia\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("修改rrd数据库存放目录访问权限\n将rrd数据库存放目录访问权限改为nobody:nobody,否则会报错")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-R")]),s._v(" nobody:nobody /var/lib/ganglia/rrds\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("修改ganglia-web的访问权限：\n修改/etc/httpd/conf.d/ganglia.conf")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("Alias /ganglia /usr/share/ganglia\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Location /ganglia"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" \n Require all granted\n "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Require ip 10.1.2.3")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Require host example.org")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/Location"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("修改dwoo下面的权限")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("777")]),s._v(" /var/lib/ganglia/dwoo/compiled\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("777")]),s._v(" /var/lib/ganglia/dwoo/cache\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("配置/etc/ganglia/gmetad.conf")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("data_source  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my cluster"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".88.130:8649"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("注意是所有节点都加上，如master:8649 slave0x:8649"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n \nsetuid_username nobody\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("配置/etc/ganglia/gmond.conf")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("cluster "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n  name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my cluster"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \nudp_send_channel "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# the host who gather this cluster's monitoring data and send these data   to gmetad node")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注释掉多播模式的,以下出现这个都要注释掉")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#mcast_join = 239.2.11.71")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#添加单播模式的")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".88.130\n port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8649")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \nudp_recv_channel "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 0.0.0.0")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("bind")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0\n  port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8649")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \ntcp_accept_channel "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n  port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8649")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("p",[t("strong",[s._v("被监测节点的配置")]),s._v("\n配置/etc/ganglia/gmond.conf")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("cluster "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n  name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hadoop cluster"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \nudp_send_channel "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# the host who gather this cluster's monitoring data and send these data   to gmetad node")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".26.139  \n port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8649")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \nudp_recv_channel "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n  port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8649")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \ntcp_accept_channel "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n  port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8649")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("h2",{attrs:{id:"ganglia启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ganglia启动"}},[s._v("#")]),s._v(" Ganglia启动")]),s._v(" "),t("p",[t("strong",[s._v("中心节点的启动")]),s._v("\nstart httpd, gmetad, gmond")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ systemctl start httpd.service\n$ systemctl start gmetad.service\n$ systemctl start gmond.service\n$ systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" httpd.service\n$ systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" gmetad.service\n$ systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" gmond.service\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 也可以使用")]),s._v("\nsevice httpd start\nservie httpd status\n\nsevice gmetad start\nservie gmetad status\n\nsevice gmond start\nservie gmond status\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("p",[t("strong",[s._v("被监测节点的启动")]),s._v("\nstart gmond")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ systemctl start gmond.service\n$ systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" gmond.service\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("strong",[s._v("关闭selinux")])]),s._v(" "),t("p",[s._v("vi /etc/selinux/config，把SELINUX=enforcing改成SELINUX=disable；该方法需要重启机器。\n可以使用命令setenforce 0来关闭selinux而不需要重启，刷新页面，即可访问；不过此法只是权宜之计，如果想永久修改selinux设置，还是要使用第一种方法")]),s._v(" "),t("p",[t("strong",[s._v("开启防火墙")]),s._v("（外网访问需要开启端口，默认80。目前机器防火墙是关闭的）")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("firewall-cmd "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--zone")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("public --add-port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--permanent")]),s._v("\nfirewall-cmd "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--reload")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("strong",[s._v("访问网页")]),s._v("\n浏览器访问 {namenode的ip}/ganglia即可")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501071706071.png",alt:"image-20200326103901392"}})]),s._v(" "),t("h2",{attrs:{id:"添加flume监控"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#添加flume监控"}},[s._v("#")]),s._v(" 添加Flume监控")]),s._v(" "),t("p",[s._v("修改flume-env.sh配置，添加虚拟机选项")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_OPTS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-Dflume.monitoring.type=ganglia -Dflume.monitoring.hosts=192.168.88.130:8649 -Xms100m -Xmx200m"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501171510906.png",alt:"image-20250117151019808"}})]),s._v(" "),t("p",[s._v("启动flume")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("flume-ng agent "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" a1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" ./ "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" mySourceAgent.conf "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Dflume.monitoring.type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ganglia "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Dflume.monitoring.hosts")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".88.130:8649\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("查看ganglia页面")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/onetioner/img/main/PicGo1/202501171507683.png",alt:"image-20250117150708576"}})]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("字段（图表名称）")]),s._v(" "),t("th",[s._v("字段含义")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("EventPutAttemptCount")]),s._v(" "),t("td",[s._v("source尝试写入channel的事件总数量")])]),s._v(" "),t("tr",[t("td",[s._v("EventPutSuccessCount")]),s._v(" "),t("td",[s._v("成功写入channel且提交的事件总数量")])]),s._v(" "),t("tr",[t("td",[s._v("EventTakeAttemptCount")]),s._v(" "),t("td",[s._v("sink尝试从channel拉取事件的总数量。这不意味着每次事件都被返回，因为sink拉取的时候channel可能没有任何数据。")])]),s._v(" "),t("tr",[t("td",[s._v("EventTakeSuccessCount")]),s._v(" "),t("td",[s._v("sink成功读取的事件的总数量")])]),s._v(" "),t("tr",[t("td",[s._v("StartTime")]),s._v(" "),t("td",[s._v("channel启动的时间（毫秒）")])]),s._v(" "),t("tr",[t("td",[s._v("StopTime")]),s._v(" "),t("td",[s._v("channel停止的时间（毫秒）")])]),s._v(" "),t("tr",[t("td",[s._v("ChannelSize")]),s._v(" "),t("td",[s._v("目前channel中事件的总数量")])]),s._v(" "),t("tr",[t("td",[s._v("ChannelFillPercentage")]),s._v(" "),t("td",[s._v("channel占用百分比")])]),s._v(" "),t("tr",[t("td",[s._v("ChannelCapacity")]),s._v(" "),t("td",[s._v("channel的容量")])])])]),s._v(" "),t("p",[s._v("目前mySourceAgent.conf配置文件中")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# channel的容量为1000")]),s._v("\na1.channels.c1.capacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("每张图片可点击查看具体情况")])])}),[],!1,null,null,null);t.default=e.exports}}]);